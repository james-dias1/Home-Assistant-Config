---
platform: template
sensors:
  solar_energy_production_deficit:
    friendly_name: Solar Energy Production Deficit
    unit_of_measurement: kW
    icon_template: mdi:solar-panel
    value_template: >
      {%- set use = states("sensor.energy_usage_current")|float -%}
      {%- set production = states("sensor.solar_energy_production_current_kw")|float -%}
      {%- if use > production -%}
        {{ "%0.3f"|format( production - use ) }}
      {%- else -%}
        0.00
      {%- endif -%}
