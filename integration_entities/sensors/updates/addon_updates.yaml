---
platform: template
sensors:
  addon_updates:
    friendly_name: Addon Updates
    icon_template: mdi:counter
    value_template: |
      {%- set storage = namespace(addons="") %}
      {%- set addons = state_attr("sensor.addons","addons") -%}
      {%- for addon in addons -%}
        {%- if addon.installed != addon.version -%}
          {%- set storage.addons = storage.addons ~ " " ~ addon.name %}
        {%- endif -%}
      {%- endfor -%}
      {%- set storage.addons = storage.addons|trim -%}
      {%- set storage.addons = storage.addons.split(" ") if storage.addons|length > 0 else "" %}
      {{ storage.addons|count }}
    attribute_templates:
      addons: |
        {%- set storage = namespace(addons="") %}
        {%- set addons = state_attr("sensor.addons","addons") -%}
        {%- for addon in addons -%}
          {%- if addon.installed != addon.version -%}
            {%- set storage.addons = storage.addons ~ " " ~ addon.name %}
          {%- endif -%}
        {%- endfor -%}
        {%- set storage.addons = storage.addons|trim -%}
        {%- set storage.addons = storage.addons.split(" ") if storage.addons|length > 0 else "" %}
        {{ storage.addons }}
