homeassistant:
  customize:
    input_boolean.ios_notifications_enabled:
      homebridge_hidden: true
      icon: mdi:tablet-ipad
      persistent: true
      
################################################
## Switches
################################################
input_boolean:
  ios_notifications:
    name: iOS Notifications
    icon: mdi:tablet-ipad
    initial: on

################################################
## Component Settings
################################################
notify:
  - platform: ios

  ## Notification Devices
  ########################
  - platform: ios
    name: ios_brians_iphone
    target: !secret brians_iphone_pushid

  - platform: ios
    name: ios_kyles_ipad
    target: !secret kyles_ipad_pushid

  - platform: ios
    name: ios_nerenes_iphone
    target: !secret nerenes_iphone_pushid

  - platform: ios
    name: ios_lucas_ipad
    target: !secret lucas_ipad_pushid

  ## Notification Groups
  #######################
  - name: notify_brian
    platform: group
    services:
      - service: ios_brians_iphone

  - name: notify_family
    platform: group
    services:
      - service: ios_brians_iphone
      - service: ios_nerenes_iphone
      - service: ios_lucas_ipad
      - service: ios_kyles_ipad

  - name: notify_kids
    platform: group
    services:
      - service: ios_lucas_ipad
      - service: ios_kyles_ipad

  - name: notify_kyle
    platform: group
    services:
      - service: ios_kyles_ipad

  - name: notify_lucas
    platform: group
    services:
      - service: ios_lucas_ipad

  - name: notify_nerene
    platform: group
    services:
      - service: ios_nerenes_iphone

  - name: notify_parents
    platform: group
    services:
      - service: ios_brians_iphone
      - service: ios_nerenes_iphone

################################################
## Script
################################################
script:
  #test_notify_engine:
  #  - sequence:
  #    - service: script.turn_on
  #      entity_id: notify_engine
  #      data_template:
  #        title: "{{ title }}"
  #        message: "{{ message }}"
  #        engines: "web"
  
  #notify_engine:
  #  - sequence:
  #    - service: script.turn_on
  #      data_template: 
  #        #entity_id: {% set add_comma = false %}{% if engines|select("ios") %}script.notify_ios_engine{% set add_comma = true %}{% endif %}{% if add_comma %}, {% end if %}{% if engines|select("web") %}script.notify_web_engine{% endif %}
  #        entity_id: {% set engine_list = (engines|replace(",","")).split() %}{% for item in engine_list %}{{ "notify_" ~ item ~ "_engine " }}{% endfor %}
  #        title: "{{ title }}"
  #        message: "{{ message }}"

  notify_web_engine:
    sequence:
      - service: persistent_notification.create
        data_template:
          title: "{{ title }}"
          message: "{{ message }}"

  notify_ios_engine:
    sequence:
      - condition: state
        entity_id: input_boolean.ios_notifications
        state: 'on'
      
      #- service: script.notify_web_engine
      #  data_template:
      #    title: "test"
      #    message: "https://home.brianhanifin.com/local/downloads/{{ image }}"
      
      - service_template: >
          {% if who is not string %}{% set who = 'brian' %}{% endif %}
          {% if who == 'brian' %}
            notify.notify_brian
          {% elif who == 'family' %}
            notify.notify_family
          {% elif who == 'kyle' %}
            notify.notify_kyle
          {% elif who == 'lucas' %}
            notify.notify_lucas
          {% elif who == 'nerene' %}
            notify.notify_nerene
          {% elif who == 'parents' %}
            notify.notify_parents
          {% else %}
            notify.notify_brian
          {% endif %}
        data_template:
          title: "{{ title }}"
          message: "{{ message }}"
          data:
            attachment:
              url: "https://home.brianhanifin.com/local/downloads/{{ image }}"
          #  content-type: "{{ image.split('.')|last }}"
          #  hide-thumbnail: false
######################################################################################################
#### Call "notify_ios_engine" like this:
  # action:
    # service: script.notify_ios_engine
    # data_template:
      # title: 'Startup: Home Assistant is Up and Running!'
      # message: "{{ trigger.to_state.state }}"
      # who: "brian | nerene | lucas | kyle | family | parents"
      # image: "camera_image.jpg"
######################################################################################################