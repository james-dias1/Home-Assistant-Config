homeassistant:
  customize:
    input_boolean.ios_notifications_enabled:
      homebridge_hidden: true
      icon: mdi:tablet-ipad
      persistent: true
      
################################################
## Switches
################################################
input_boolean:
  ios_notifications:
    name: iOS Notifications
    icon: mdi:tablet-ipad
    initial: on

################################################
## Component Settings
################################################
notify:
  - platform: ios

  ## Notification Devices
  ########################
  - platform: ios
    name: ios_brians_iphone
    target: !secret brians_iphone_pushid

  - platform: ios
    name: ios_kyles_ipad
    target: !secret kyles_ipad_pushid

  - platform: ios
    name: ios_nerenes_iphone
    target: !secret nerenes_iphone_pushid

  - platform: ios
    name: ios_lucas_ipad
    target: !secret lucas_ipad_pushid

  ## Notification Groups
  #######################
  - name: brian
    platform: group
    services:
      - service: ios_brians_iphone

  - name: family
    platform: group
    services:
      - service: ios_brians_iphone
      - service: ios_nerenes_iphone
      - service: ios_lucas_ipad
      - service: ios_kyles_ipad

  - name: kids
    platform: group
    services:
      - service: ios_lucas_ipad
      - service: ios_kyles_ipad

  - name: kyle
    platform: group
    services:
      - service: ios_kyles_ipad

  - name: lucas
    platform: group
    services:
      - service: ios_lucas_ipad

  - name: nerene
    platform: group
    services:
      - service: ios_nerenes_iphone

  - name: parents
    platform: group
    services:
      - service: ios_brians_iphone
      - service: ios_nerenes_iphone

################################################
## Script
################################################
script:
  debug:
    sequence:
      - service: persistent_notification.create
        data_template:
          text: "{{ message }}"

#  test_notify_engine:
#    - sequence:
#      - service: script.turn_on
#        entity_id: notify_engine
#        data_template:
#          title: "test title"
#          message: "test message"
#          engines: "web,ios"
#          who: "brian"
  
#  notify_engine:
#    - sequence:
#      - service: script.turn_on
#        data_template: 
#          #entity_id: {% set add_comma = false %}{% if engines|select("ios") %}script.notify_ios{% set add_comma = true %}{% endif %}{% if add_comma %}, {% end if %}{% if engines|select("web") %}script.notify_web{% endif %}
#          entity_id: {% macro get_notification_engines(engines) -%}
#              {%- set engines = engines.split(",") -%}
#              {%- for engine in engines -%}
#                {%- if engine|trim|lower == "ios" -%}
#                  {{ "script.notify_ios " }}
#                {%- endif -%}
#                {%- if engine|trim|lower == "web" -%}
#                  {{ "script.notify_web " }}
#                {%- endif -%}
#              {%- endfor -%}
#            {%- endmacro -%}
#            {{ get_notification_engines(engines)|trim|replace(' ', ', ') }}
#          title: "{{ title }}"
#          message: "{{ message }}"
#          who: "{{ who }}"

  notify_ios:
    sequence:
      - condition: state
        entity_id: input_boolean.ios_notifications
        state: 'on'
      - service_template: >
          {% if who is not string %}{% set who = 'brian' %}{% endif %}
          {% if who == 'brian' %}
            notify.brian
          {% elif who == 'family' %}
            notify.family
          {% elif who == 'kids' %}
            notify.kids
          {% elif who == 'kyle' %}
            notify.kyle
          {% elif who == 'lucas' %}
            notify.lucas
          {% elif who == 'nerene' %}
            notify.nerene
          {% elif who == 'parents' %}
            notify.parents
          {% else %}
            notify.brian
          {% endif %}
        data_template:
          title: "{{ title }}"
          message: "{{ message }}"
          data:
            attachment:
              url: "https://hass.home.brianhanifin.com/local/downloads/{{ image }}"
          #  content-type: "{{ image.split('.')|last }}"
          #  hide-thumbnail: false

  notify_speech:
    sequence:
      - condition: state
        entity_id: input_boolean.speech_notifications
        state: 'on'
      - service: script.say
        data_template:
          media_player: media_player.living_room
          say_greeting: "false"
          message: >-
            {{ message }}

  notify_web:
    sequence:
      - service: persistent_notification.create
        data_template:
          title: "{{ title }}"
          message: "{{ message }}"

######################################################################################################
#### Call "notify_ios" like this:
  # action:
    # service: script.notify_ios
    # data_template:
      # title: 'Startup: Home Assistant is Up and Running!'
      # message: "{{ trigger.to_state.state }}"
      # who: "brian | nerene | lucas | kyle | family | parents"
      # image: "camera_image.jpg"
######################################################################################################