homeassistant:
  customize:
    input_boolean.speech_notifications:
      persistent: true

################################################
## Component Settings
################################################
media_player:
  - platform: alexa
    email: !secret email1
    password: !secret amazon_pass
    url: "amazon.com"
#media_player.echo_living_room
#media_player.echo_family_room
#media_player.echo_kitchen
#media_player.echo_play_room
#media_player.echo_master_bedroom
#media_player.echo_lucas_room
#media_player.echo_kyles_room

################################################
## Switches
################################################
input_boolean:
  speech_notifications:
    name: Speech Notifications
    icon: mdi:speaker-wireless
    initial: on

################################################
## Scripts
################################################
script:
  alexa_tts_test:
    sequence:
      - service: media_player.alexa_tts
        data_template:
          entity_id: "media_player.echo_living_room"
          message: "TTS test"

  speak_test:
    sequence:
      - service: script.speak
        data_template:
          media_player: "media_player.echo_living_room"
          message: "Speak Script Test"
          call_do_not_greet: 1

  speak:
    sequence:
      #- condition: state
      #  entity_id: input_boolean.speech_notifications
      #  state: 'on'
      - service: media_player.alexa_tts
        data_template:
          entity_id: >-
            {%- macro entity_list(entities) -%}
              {%- if entities is not string -%}
                {%- set temp = 'media_player.echo_living_room' -%}
              {%- else -%}
                {%- set temp = entities|trim|replace(' ', '') -%}
              {%- endif -%}
              {{ temp|replace(' ,',',')|replace(',',', ')|trim }}
            {%- endmacro -%}
            {{ entity_list(media_player) }}
          message: >-
            {%- if call_do_not_greet != 1 %}
              {# Midnight to 10am == morning. #}
              {%- if now().strftime('%H')|int > 0 and now().strftime('%H')|int < 10  %}
                Good morning.
              {# 10am to 5pm == afternoon #}
              {%- elif now().strftime('%H')|int >= 10 and now().strftime('%H')|int < 17 %}
                Good afternoon.
              {# 5pm - Midnight == evening #}
              {%- else %}
                Good evening.
              {%- endif %}
            {%- endif %}


            {%- if message is not none %}
              {{ message }}
            {%- endif %}