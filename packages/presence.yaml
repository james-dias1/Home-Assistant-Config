homeassistant:
  customize:
    ##### Brian's Devices
    device_tracker.brians_iphone:
      friendly_name: "Brian's Phone"
      device_class: presence
    device_tracker.brians_iphone_bluetooth:
      friendly_name: "Brian's Phone"
      device_class: presence
    devices.automatic:
      friendly_name: "Brian's Car"
      device_class: connectivity

    ##### Nerene's Devices
    device_tracker.nerenes_iphone:
      friendly_name: "Nerene's Phone"
      device_class: presence
    device_tracker.parrot_ck3100:
      friendly_name: "Nerene's Car"
      device_class: connectivity

    ##### Occupancy Sensors
    binary_sensor.bedroom_occupancy:
      device_class: occupancy
    binary_sensor.home_occupancy:
      device_class: occupancy
    binary_sensor.living_room_occupancy:
      device_class: occupancy
    binary_sensor.lucas_bedroom_occupancy:
      device_class: occupancy

    ##### Combined Occupancy Sensor (at least one person is home)
    binary_sensor.presence_home:
      friendly_name: "At Home"
      device_class: occupancy
    input_boolean.presence_home:
      friendly_name: "At Home"

    ##### Motion Sensors
    binary_sensor.kitchen_room_motion:
      friendly_name: "Kitchen"
      device_class: motion
    binary_sensor.play_room_motion:
      friendly_name: "Play Room"
      device_class: motion
    sensor.workbench_motion_detected:
      friendly_name: Workbench
      device_class: motion
    binary_sensor.ring_front_door_motion:
      name: Porch
      device_class: motion


################################################
## Component Settings
################################################
device_tracker:
  - platform: bluetooth_tracker

  #- platform: netgear
  #  host: 10.0.0.1
  #  username: !secret netgear_user
  #  password: !secret netgear_pass
  #  consider_home: 180
  #  new_device_defaults:
  #    track_new_devices: false
  #    hide_if_away: true

  - platform: nmap_tracker
    hosts:
      - 10.0.0.29   # Brian's iPhone
      - 10.0.0.35   # Nerene's iPhone
      #- 10.0.0.0/24
    consider_home: 180
    new_device_defaults:
      track_new_devices: false
      hide_if_away: true

################################################
## Sensors
################################################
binary_sensor:
  - platform: template
    sensors:
      presence_home:
        value_template: >-
          {{ is_state('input_boolean.presence_home', 'on') }}
        device_class: presence

################################################
## Switches
################################################
input_boolean:
  guest_mode:
    name: Guest Mode
    icon: mdi:account-alert
    initial: off

  presence_home:
    name: At Home
    icon: mdi:home
    initial: off

################################################
## Automation
################################################
automation:
  - alias: If Everyone Leaves Home
    trigger:
      - platform: state
        entity_id: device_tracker.brians_iphone, device_tracker.brians_iphone_bluetooth, device_tracker.nerenes_iphone
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: 'device_tracker.brians_iphone'
          state: 'away'
        - condition: state
          entity_id: 'device_tracker.brians_iphone_bluetooth'
          state: 'away'
        - condition: state
          entity_id: 'device_tracker.nerenes_iphone'
          state: 'away'
        # Only if Guest Mode is also disabled.
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'off'
      #for:
      #  minutes: 2
    action:
      - service: input_boolean.turn_off
        entity_id: input_boolean.presence_home

  - alias: If Anyone Arrives At Home
    trigger:
      - platform: state
        entity_id: device_tracker.brians_iphone, device_tracker.brians_iphone_bluetooth, device_tracker.nerenes_iphone
    condition:
      condition: or
      conditions:
        - condition: state
          entity_id: 'device_tracker.brians_iphone'
          state: 'home'
        - condition: state
          entity_id: 'device_tracker.brians_iphone_bluetooth'
          state: 'home'
        - condition: state
          entity_id: 'device_tracker.nerenes_iphone'
          state: 'home'
        # Or if Guest Mode is enabled.
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
      #for:
      #  seconds: 30
    action:
      - service: input_boolean.turn_on
        entity_id: input_boolean.presence_home