homeassistant:
  customize:
    ##### Brian's Devices
    device_tracker.brians_iphone:
      friendly_name: "Brian"
      device_class: presence
    device_tracker.brians_iphone_bluetooth:
      friendly_name: "Brian's Phone"
      device_class: connectivity
    devices.automatic:
      friendly_name: "Brian's Car"
      device_class: connectivity

    ##### Nerene's Devices
    device_tracker.nerenes_iphone:
      friendly_name: "Nerene"
      device_class: presence
    device_tracker.parrot_ck3100:
      friendly_name: "Nerene's Car"
      device_class: connectivity

    ##### Occupancy Sensors
    binary_sensor.bedroom_occupancy:
      device_class: occupancy
    binary_sensor.home_occupancy:
      device_class: occupancy
    binary_sensor.living_room_occupancy:
      device_class: occupancy
    binary_sensor.lucas_bedroom_occupancy:
      device_class: occupancy

    ##### Motion Sensors
    binary_sensor.kitchen_room_motion:
      friendly_name: "Kitchen"
      device_class: motion
    binary_sensor.play_room_motion:
      friendly_name: "Play Room"
      device_class: motion
    sensor.workbench_motion_detected:
      friendly_name: Workbench
      device_class: motion
    binary_sensor.ring_front_door_motion:
      name: Porch
      device_class: motion


################################################
## Component Settings
################################################
device_tracker:
  #- platform: bluetooth_tracker

  - platform: nmap_tracker
    hosts:
      - 10.0.0.29   # Brian's iPhone
      - 10.0.0.35   # Nerene's iPhone
      #- 10.0.0.0/24
    consider_home: 180
    new_device_defaults:
      track_new_devices: false
      hide_if_away: true

################################################
## Groups
################################################
group:
  family:
    entities:
      - device_tracker.brians_iphone
      - device_tracker.nerenes_iphone
    name: Is Anyone At Home?
    icon: mdi:home
    view: no

################################################
## Switches
################################################
input_boolean:
  guest_mode:
    name: Guest Mode
    icon: mdi:account-alert
    initial: off

  presence_home:
    name: At Home
    icon: mdi:home
    initial: off

script:
  test_arrival:
    sequence:
      - service: script.announce_arrival
        data_template:
          who: "Some guy slash lady"

  announce_arrival:
    sequence:
      - condition: state
        entity_id: input_boolean.speech_enabled
        state: 'on'
      - service: script.speech_engine
        data_template:
          message: "Hooray! {{ who }} is home!"

################################################
## Automation
################################################
automation:
  ######################################################################
  ## Announce when people come or go.
  ## Announce over all Chromecast Audios
  ######################################################################
  - alias: 'People Greeting'
    trigger:
      - platform: state
        entity_id:
          - device_tracker.brians_iphone
          - device_tracker.nerenes_iphone
        from: 'not_home'
        to: 'home'
        for: '00:02:00'
    action:
      - service: script.speech_engine
        data_template:
          personarriving: >
            {% set person = trigger.entity_id.split('.')[1]|replace('_', ' ')%}
            {%- macro greeting_sentence(person) -%}
            {{ [
            "Welcome back home " ~ person,
            "Guess who is home?" ~ person +" is!",
            person + " is now in the house.",
            "Welcome Home " ~ person + ".  We have missed you. Or at least Molly did.",
            "Our home is now complete, Rest your head and relax your feet! Welcome Back " ~ person,
            "Life is like a song, youâ€™re back where you belong. Welcome home " ~ person,
            "Hey there " ~ person + " Welcome Home!",
            "Knock Knock. Who is There? "   ~ person +" is!",
            person ~ "! You are home!",
            "I know a secret! "  ~ person +" is home!"
            ] | random }}
            {%- endmacro -%}
            {{greeting_sentence(person)}}
          call_responsibilities: 1
          call_no_announcement: 1
          call_garage_check: 1
          call_window_check: 1