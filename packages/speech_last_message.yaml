#-------------------------------------------
# @CCOSTAN
# Original Repo : https://github.com/CCOSTAN/Home-AssistantConfig
#-------------------------------------------
homeassistant:
  customize:
    input_boolean.last_message:
      friendly_name: 'Repeat Message'
      icon: mdi:repeat-once
      hidden: False
    sensor.last_message:
      state_card_mode: none

#-------------------------------------------
input_boolean:
  last_message:
    name: Last Message
    initial: off
#-------------------------------------------
sensor:
  - platform: mqtt
    state_topic: "speech/last_message"
    name: "Last Message"

##############################################################################
###  Automations -
##############################################################################
automation:
  - alias: 'Repeat Last Message'
    trigger:
      - platform: state
        entity_id: input_boolean.last_message
        to: 'on'
    action:
      #- service: tts.amazon_polly_say
      - service: media_player.alexa_tts
        entity_id:
          - media_player.living_room_speaker
          #- media_player.play_room_speaker
        data_template:
          message: >
            {{states.sensor.last_message.state}}
          cache: true
      - service: input_boolean.turn_off
        entity_id:
          - input_boolean.last_message