homeassistant:
  customize:
    binary_sensor.washer_running:
      device_class: power

################################################
## Sensors
################################################
binary_sensor:
  - platform: template
    sensors:
      washer_running:
        #value_template: "{{ states.input_boolean.washer_running.state == 'on' }}"
        value_template: "{{ states.sensor.sonoffs31_02_power.state|int > 5 }}"
        device_class: presence
        friendly_name: "Washer Running"
        icon_template: mdi:washing-machine

################################################
## Automation
################################################
automation:
  - alias: Hot Water Pump Timeout
    trigger:
      platform: state
      entity_id: switch.sonoff_pow01
      from: "off"
      to: "on"
      for:
        minutes: 5
    action:
      - service: switch.turn_off
        entity_id: switch.sonoff_pow01

  - alias: "Washing Cycle Is Complete"
    trigger:
      - platform: state
        entity_id: binary_sensor.washer_running
        from: 'on'
        to: 'off'
        for:
          seconds: 15
    action:
      - service: script.notify_speech
        data_template:
          media_player: "media_player.kitchen"
          message: "The washing cycle is complete."

      - service: script.notify_ios
        data_template:
          title: "Washing Machine"
          message: "Clothes are clean! Finshed @ {{ as_timestamp(now()) | timestamp_custom('%I:%M:%S %p %d %b %Y', true) }}"
          who: "brian"

      #- service: script.notify_web
      #  data_template:
      #    title: "Washing Machine"
      #    message: "Clothes are clean! Finshed @ {{ as_timestamp(now()) | timestamp_custom('%I:%M:%S %p %d %b %Y', true) }}"