homeassistant:
  customize:
    climate.home:
      friendly_name: Home
      icon: mdi:air-conditioner
    climate.playroom:
      friendly_name: 2nd Master
      icon: mdi:air-conditioner
    
    binary_sensor.home_occupancy:
      friendly_name: Hallway Occupancy
      icon: mdi:run

    switch.ecobee_home_fan:
      homebridge_hidden: false
    switch.ecobee_playroom_fan:
      homebridge_hidden: false

################################################
## Component Settings
################################################
ecobee:
  api_key: !secret ecobee_apikey

################################################
## Thermostat Display Panels
################################################
group:
  panel_home_thermostat:
    entities:
      - climate.home
      - switch.ecobee_home_fan
      - sensor.home_temperature
      - sensor.living_room_temperature
      - sensor.home_humidity
      - sensor.ecobee_home_hold_mode
      - sensor.ecobee_home_away_mode
      - binary_sensor.home_occupancy
      - binary_sensor.living_room_motion
    name: Home Thermostat
    icon: mdi:thermometer-lines
    control: hidden
    view: no

  panel_playroom_thermostat:
    entities:
      - climate.playroom
      - switch.ecobee_playroom_fan
      - sensor.playroom_temperature
      - sensor.playroom_humidity
      - sensor.ecobee_playroom_hold_mode
      - sensor.ecobee_playroom_away_mode
      - binary_sensor.playroom_occupancy
      - binary_sensor.play_room_motion
    name: Play Room Thermostat
    icon: mdi:thermometer-lines
    control: hidden
    view: no

################################################
## Sensors
################################################
sensor:
  - platform: template
    sensors:
      ecobee_home_fan:
        friendly_name: "Fan"
        icon_template: >-
          {% if is_state('states.climate.home.attributes.fan', 'on') %}
            mdi:fan
          {% else %}
            mdi:fan-off
          {% endif %}
        value_template: "{{ states.climate.home.attributes.fan }}"

  - platform: template
    sensors:
      ecobee_home_away_mode:
        friendly_name: "Away and Hold"
        icon_template: >-
          {% if is_state('states.climate.home.attributes.away_mode', 'on') %}
            mdi:airplane-takeoff
          {% else %}
            mdi:airplane-landing
          {% endif %}
        value_template: "{{ states.climate.home.attributes.away_mode }}"

  - platform: template
    sensors:
      ecobee_home_hold_mode:
        friendly_name: "Temp Hold Mode"
        icon_template: >-
          {% if is_state('states.climate.home.attributes.away_mode', 'on') %}
            mdi:airplane-takeoff
          {% else %}
            mdi:airplane-landing
          {% endif %}
        value_template: "{{ states.climate.home.attributes.away_mode }}"

  - platform: template
    sensors:
      ecobee_playroom_fan:
        friendly_name: "Fan"
        icon_template: >-
          {% if is_state('states.climate.playroom.attributes.fan', 'on') %}
            mdi:fan
          {% else %}
            mdi:fan-off
          {% endif %}
        value_template: "{{ states.climate.playroom.attributes.fan }}"

  - platform: template
    sensors:
      ecobee_playroom_away_mode:
        friendly_name: "Away and Hold"
        icon_template: >-
          {% if is_state('states.climate.playroom.attributes.away_mode', 'on') %}
            mdi:airplane-takeoff
          {% else %}
            mdi:airplane-landing
          {% endif %}
        value_template: "{{ states.climate.playroom.attributes.away_mode }}"

  - platform: template
    sensors:
      ecobee_playroom_hold_mode:
        friendly_name: "Temp Hold Mode"
        icon_template: >-
          {% if is_state('states.climate.playroom.attributes.away_mode', 'on') %}
            mdi:airplane-takeoff
          {% else %}
            mdi:airplane-landing
          {% endif %}
        value_template: "{{ states.climate.playroom.attributes.away_mode }}"

################################################
## Switch
################################################
switch:
  - platform: template
    switches:
      ecobee_home_fan:
        friendly_name: "Thermostat Fan"
        value_template: "{{ states.climate.home.attributes.fan }}"
        turn_on:
          - service: climate.set_fan_mode
            data:
              entity_id: climate.home
              fan_mode: "on"
        turn_off:
          - service: climate.ecobee_resume_program
            data:
              entity_id: climate.home
              resume_all: true
        #icon_template: >-
        #  {% if is_state_attr('climate.home', 'fan', 'on') %}
        #    mdi:fan
        #  {% else %}
        #    mdi:fan-off
        #  {% endif %}

  - platform: template
    switches:
      ecobee_playroom_fan:
        friendly_name: "Thermostat Fan" # [Playroom]
        value_template: "{{ states.climate.playroom.attributes.fan }}"
        turn_on:
          - service: climate.set_fan_mode
            data:
              entity_id: climate.playroom
              fan_mode: "on"
        turn_off:
          - service: climate.ecobee_resume_program
            data:
              entity_id: climate.playroom
              resume_all: true
        #icon_template: >-
        #  {% if is_state_attr('climate.playroom', 'fan', 'on') %}
        #    mdi:fan
        #  {% else %}
        #    mdi:fan-off
        #  {% endif %}

################################################
## Scripts
################################################
script:
  ecobee_away_and_hold:
    sequence:
      - service: climate.set_away_mode
        data:
          entity_id: climate.home
          away_mode: true
      - service: climate.set_away_mode
        data:
          entity_id: climate.playroom
          away_mode: true

  ecobee_resume_normal_operation:
    sequence:
      - service: climate.ecobee_resume_program
        data:
          entity_id: climate.home
          resume_all: true
      - service: climate.ecobee_resume_program
        data:
          entity_id: climate.playroom
          resume_all: true

  ecobee_temporary_away:
    sequence:
      - service: climate.set_hold_mode
        data:
          entity_id: climate.home
          hold_mode: "away"
      - service: climate.set_hold_mode
        data:
          entity_id: climate.playroom
          hold_mode: "away"