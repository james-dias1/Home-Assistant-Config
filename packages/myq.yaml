homeassistant:
  customize:
    binary_sensor.garage_state:
      device_class: garage_door

################################################
## Component Settings
################################################
cover:
  - platform: myq
    username: !secret email1
    password: !secret myq_pass
    name: garage_door
    type: liftmaster

################################################
## Sensors
################################################
binary_sensor:
  - platform: template
    sensors:
      garage_door:
        value_template: '{{ states.cover.garage_door.state }}'
        device_class: garage_door
        friendly_name: 'Garage Door'
        #icon_template: mdi:garage'{% if is_state(cover.garage_door == 'open' %}-open{% endif %}'
        #icon: mdi:garage



input_text:
  fake_garage_door:
    name: Fake Garage Door
    initial: "closed"


################################################
## Scenes
################################################
scene:
  - name: Open the Garage Door
    entities:
      cover.garage_door_opener: on
  - name: Open Garage
    entities:
      cover.garage_door_opener: on

  - name: Close the Garage Door
    entities:
      cover.garage_door_opener: off
  - name: Close Garage
    entities:
      cover.garage_door_opener: off

##############################################
## Scripts
##############################################
script:
  garage_door_warning:
    sequence:
      - service: script.notify_ios_engine
        data_template:
          value1: 'WARNING: Garage Door'
          value2: 'Your garage door is still open! You should probably close it.'
          value3: ''
          who: "parents"
      - service: script.notify_web_engine
        data_template:
            value1: 'WARNING: Garage Door'
            value2: 'Your garage door is still open! You should close it.'
            value3: ''

##############################################
## Automations
##############################################
automation:
  ##############################################
  ## Garage Entry Light Automations
  ##############################################
  - alias: Garage Door Opens
    trigger:
      - platform: state
        entity_id: cover.garage_door_opener, input_text.fake_garage_door
        from: "closed"
    #condition:
    #  - condition: state
    #    entity_id: binary_sensor.presence_home
    #    state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.garage_entry_light
      # If after 5 minutes the garage is still open, dim the light 50%.
      - delay: 0:05:00
      - condition: state
        entity_id: light.garage_entry_light
        state: 'on'
      - service: light.turn_on
        data:
          entity_id: light.garage_entry_light
          brightness_pct: 5

  - alias: Garage Door Is Closed
    trigger:
      - platform: state
        entity_id: cover.garage_door_opener, input_text.fake_garage_door
        to: "closed"
    action:
      - delay: 0:00:15
      - service: light.turn_off
        entity_id: light.garage_entry_light

  ############################################
  ## Warn us if the garage door is still open
  ############################################
  - alias: Garage Door Watchdog
    trigger:
      platform: time
      hours: 20
      minutes: 0
      seconds: 0
    condition:
      - condition: state
        entity_id: cover.garage_door_opener
        state: 'open'
    action:
      - service: script.turn_on
        entity_id: script.garage_door_open_notification