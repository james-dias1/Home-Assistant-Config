homeassistant:
  customize:
    binary_sensor.garage_state:
      device_class: garage_door
    binary_sensor.garage_state_fake:
      device_class: garage_door
    cover.garage_door:
      device_class: garage
      friendly_name: "Garage Door"

################################################
## Component Settings
################################################
cover:
  - platform: myq
    username: !secret email1
    password: !secret myq_pass
    name: garage_door
    type: liftmaster

################################################
## Sensors
################################################
binary_sensor:
  - platform: template
    sensors:
      garage_door:
        value_template: "{{ is_state('cover.garage_door', 'open') }}"
        device_class: garage_door
        friendly_name: Garage Door

  - platform: template
    sensors:
      garage_door_fake:
        value_template: "{{ is_state('input_boolean.garage_door_fake', 'on') }}"
        device_class: garage_door
        friendly_name: "FAKE Garage Door"

input_boolean:
  garage_door_fake:
    name: Fake Garage Door
    initial: off

##############################################
## Automations
##############################################
automation:
  ######################################################################
  ##  Garage Status Light
  ######################################################################
  - alias: 'Garage Closed'
    trigger:
      - platform: state
        entity_id: cover.garage_door
        to: 'closed'
      - platform: state
        entity_id: input_boolean.garage_door_fake
        to: 'off'
    action:
      - delay: 0:00:15
      - service: light.turn_off
        entity_id: light.garage_entry_light

  - alias: 'Garage Opened'
    trigger:
      - platform: state
        entity_id: cover.garage_door
        from: 'closed'
      - platform: state
        entity_id: input_boolean.garage_door_fake
        from: 'off'
    action:
      - service: light.turn_on
        data:
          entity_id: light.garage_entry_light
          brightness_pct: 75
          effect: "colorloop"
      # If after 5 minutes the garage is still open, dim the light.
      - delay: 0:05:00
      - service: light.turn_on
        data:
          entity_id: light.garage_entry_light
          brightness_pct: 20
          transition: 5

  ############################################
  ## Warn us if the garage door is still open
  ############################################
  - alias: Garage Door Watchdog
    trigger:
      platform: time
      hours: 20
      minutes: 0
      seconds: 0
    condition:
      - condition: state
        entity_id: cover.garage_door
        state: 'open'
    action:
      - service: script.notify_ios_engine
        data_template:
          title: 'WARNING: Garage Door'
          message: 'Your garage door is still open! You should probably close it.'
          who: "parents"
  
      - service: script.notify_web_engine
        data_template:
          title: 'WARNING: Garage Door'
          message: 'Your garage door is still open! You should close it.'
      
      - service: input_boolean.turn_on
        entity_id: input_boolean.alert_mode
      - service: script.speech_engine
        data_template:
          call_garage_check: 1