homeassistant:
  customize:
    binary_sensor.garage_state:
      device_class: garage_door
    cover.garage_door:
      device_class: garage
      friendly_name: "Garage Door"

################################################
## Component Settings
################################################
cover:
  - platform: myq
    username: !secret email1
    password: !secret myq_pass
    name: garage_door
    type: liftmaster

################################################
## Sensors
################################################
binary_sensor:
  - platform: template
    sensors:
      garage_door:
        value_template: >
          {% if is_state('cover.garage_door', 'closed')
             or is_state('input_boolean.garage_door_fake', 'off') -%}
            {{ "false" }}
          {%- else %}
            {{ "true" }}
          {%- endif %}
        device_class: garage_door
        friendly_name: Garage Door


input_boolean:
  garage_door_fake:
    name: Fake Garage Door
    initial: off

##############################################
## Automations
##############################################
automation:
  ######################################################################
  ##  Garage Status Light
  ######################################################################
  - alias: 'Garage Closed'
    trigger:
      - platform: state
        entity_id: binary_sensor.garage_door
        from: 'on'
        to: 'off'
    action:
      - delay: "0:00:15"
      - service: light.turn_off
        entity_id: light.garage_entry_light

  - alias: 'Garage Opened'
    trigger:
      - platform: state
        entity_id: binary_sensor.garage_door
        from: 'off'
        to: 'on'
    action:
      - service: light.turn_on
        data:
          entity_id: light.garage_entry_light
          brightness_pct: 75
          effect: "colorloop"
      # If after 5 minutes the garage is still open, dim the light.
      - delay: "0:05:00"
      - service: light.turn_on
        data:
          entity_id: light.garage_entry_light
          brightness_pct: 20
          transition: 5

  - alias: Make sure light doesn't stay on after garage is closed
    trigger:
      platform: time
      minutes: '/05'
      seconds: 00
    action:
      - condition: state
        entity_id: cover.garage_door
        state:    'closed'
      - service:   light.turn_off
        entity_id: light.garage_entry_light