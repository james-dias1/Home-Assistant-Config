[{"id":"754c564.7b83828","type":"tab","label":"Event Reminders","disabled":false,"info":""},{"id":"450e6ab5.73fe64","type":"tab","label":"Front Door","disabled":true,"info":""},{"id":"ca5c607e.6b2b18","type":"tab","label":"Garage Door","disabled":false,"info":""},{"id":"f6fd4470.cafc38","type":"tab","label":"Watch Dogs","disabled":false,"info":""},{"id":"1f7e758c.1055ea","type":"tab","label":"XPresence","disabled":true,"info":"Extended presence detection:\n\n* Just Arrived\n* Home\n* Just Left\n* Away\n* Extended Away\n\nBased on Phil Hawthorne's [Making Home Assistantâ€™s Presence Detection not so Binary](https://philhawthorne.com/making-home-assistants-presence-detection-not-so-binary/)\nand Mauricio Bonani's [Node-RED version](https://bonani.tech/making-home-assistants-presence-detection-not-so-binary-node-red-version/)."},{"id":"a14a13fb.20e7d8","type":"tab","label":"functions","disabled":false,"info":""},{"id":"da29b66a.c6921","type":"tab","label":"x","disabled":false,"info":""},{"id":"802c46.337debb8","type":"tab","label":"Zigbee2MQTT Admin Panel","disabled":false,"info":""},{"id":"effe3391.1f5438","type":"tab","label":"WLED Dashboard","disabled":false,"info":""},{"id":"ab8451a6.1fc278","type":"tab","label":"WLED RGB Alexa Effects","disabled":false,"info":""},{"id":"ed91e3e9.60bbe8","type":"tab","label":"WLED RGB Lights","disabled":false,"info":""},{"id":"9aecea9b.7bb228","type":"subflow","name":"Network Map","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[],"env":[]},{"id":"88552b3a.cd1c38","type":"subflow","name":"Pairing Notifications","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"cc5eb152.bae948","type":"subflow","name":"Devices","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"f1f40d54.5f1248","type":"subflow","name":"Status","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"84c89.e1805b77","type":"subflow","name":"Logging Level","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"b719d888.34b5","type":"subflow","name":"Remove Device","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"7b73f2f9.14c47c","type":"subflow","name":"Permit Join","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"ffc576d7.bdba3","type":"subflow","name":"Rename Device","info":"","category":"Zigbee2MQTT Admin Panel","in":[],"out":[]},{"id":"6aa0e47a.29857c","type":"mqtt-broker","z":"","name":"Mosquitto","broker":"a0d7b954-mqtt","port":"1883","clientid":"node-red","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"nodered/status","birthQos":"0","birthRetain":"false","birthPayload":"online","closeTopic":"nodered/status","closeQos":"0","closeRetain":"false","closePayload":"disconnected","willTopic":"nodered/status","willQos":"0","willRetain":"false","willPayload":"offline"},{"id":"71cca0bd.6fe0a","type":"server","z":"","name":"Home Assistant","legacy":false,"hassio":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true},{"id":"70840d2c.2700ac","type":"light-scheduler-settings","z":"","name":"home","latitude":"32.854105","longitude":"-117.0051645"},{"id":"9d75b900.c4f26","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"e5f18c9c.735378","type":"ui_group","z":"cc5eb152.bae948","name":"Devices","tab":"3fdfd9fc.8be646","order":1,"disp":true,"width":"12","collapse":false},{"id":"22aa6664.93efb2","type":"ui_group","z":"","name":"Status","tab":"3fdfd9fc.8be646","order":2,"disp":true,"width":"6","collapse":false},{"id":"758357a2.e967f8","type":"ui_group","z":"84c89.e1805b77","name":"Logging Level","tab":"3fdfd9fc.8be646","order":4,"disp":true,"width":"6","collapse":false},{"id":"85824c1a.db3278","type":"ui_group","z":"b719d888.34b5","name":"Remove Device","tab":"3fdfd9fc.8be646","order":5,"disp":true,"width":"6","collapse":false},{"id":"c033bd67.6dafe","type":"mqtt-broker","z":"","name":"MQTT","broker":"a0d7b954-mqtt","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"domoticz/bridge/state","birthQos":"0","birthRetain":"false","birthPayload":"online","closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"47090788.3f9c68","type":"ui_group","z":"","name":"Permit Join","tab":"3fdfd9fc.8be646","order":3,"disp":true,"width":"6","collapse":false},{"id":"aa9d7177.a5ace8","type":"ui_group","z":"","name":"Rename Device","tab":"3fdfd9fc.8be646","order":6,"disp":true,"width":"6","collapse":false},{"id":"af50487a.2e1738","type":"mqtt-broker","z":"","name":"MQTT","broker":"a0d7b954-mqtt","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"3fdfd9fc.8be646","type":"ui_tab","z":"","name":"Zigbee2MQTT Admin Panel","icon":"dashboard"},{"id":"cf0b0799.ae4248","type":"ui_group","z":"","name":"Presets","tab":"c28db6b0.3816a8","order":2,"disp":true,"width":"6","collapse":true},{"id":"36e34f8c.02bee","type":"server","z":"","name":"Home Assistant","legacy":false,"hassio":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true},{"id":"b5a5da99.d05b48","type":"mqtt-broker","z":"","name":"MQTT","broker":"a0d7b954-mqtt","port":"1883","clientid":"Node-Red","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"b32c84f8.f27068","type":"ui_group","z":"","name":"Settings","tab":"c28db6b0.3816a8","order":3,"disp":true,"width":"6","collapse":true},{"id":"40a83076.892118","type":"ui_group","z":"","name":"Colors","tab":"c28db6b0.3816a8","order":4,"disp":true,"width":"6","collapse":false},{"id":"aa33085.6e462f8","type":"ui_group","z":"","name":"Power","tab":"c28db6b0.3816a8","order":1,"disp":true,"width":"6","collapse":false},{"id":"f4b4a6be.c69f38","type":"ui_group","z":"","name":"Info","tab":"c28db6b0.3816a8","order":5,"disp":true,"width":"6","collapse":true},{"id":"c28db6b0.3816a8","type":"ui_tab","z":"","name":"Deck Lights RGB WLED","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"b7a2558e.8e59d","type":"server","z":"","name":"Home Assistant","legacy":false,"hassio":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true},{"id":"79d48640.3119d8","type":"mqtt-broker","z":"","name":"MQTT","broker":"192.168.110.10 ","port":"1883","clientid":"Node-Red","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"34de6e23.40e69a","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":340,"wires":[["ca8809c5.c63148"]],"l":false},{"id":"26fbc3ff.ce2d74","type":"function","z":"450e6ab5.73fe64","name":"set_state","func":"var state = {\n    'state': msg.payload,\n    'brightness': msg.data.attributes.brightness||0\n}\nflow.set(\"entry_light_state\",state);\nmsg.data = null\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":180,"wires":[["d56ee077.72a65"]]},{"id":"74e5190c.a3a1d","type":"function","z":"450e6ab5.73fe64","name":"entry light: old_state","func":"msg.payload = flow.get(\"entry_light_state\");\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":420,"wires":[["ff2d1e93.330348"]]},{"id":"ff2d1e93.330348","type":"switch","z":"450e6ab5.73fe64","name":"","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":true,"outputs":2,"x":390,"y":420,"wires":[["efd758b3.1a9b18"],["b7eb3298.b985a8"]]},{"id":"9b87404.80f3d4","type":"comment","z":"450e6ab5.73fe64","name":"Turn porch + entry lights to full brightness when unlocked.","info":"","x":230,"y":140,"wires":[]},{"id":"964404f4.6b395","type":"function","z":"450e6ab5.73fe64","name":"porch light: old_state","func":"msg.payload = flow.get(\"porch_light_state\");\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":500,"wires":[["8b7031f5.eb7288"]]},{"id":"8b7031f5.eb7288","type":"switch","z":"450e6ab5.73fe64","name":"","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":true,"outputs":2,"x":390,"y":500,"wires":[["f91ebc0c.726e1"],["6a4e3836.fff1e8"]]},{"id":"e0f5717e.4c6ee","type":"function","z":"450e6ab5.73fe64","name":"set_state","func":"var rgb = msg.data.attributes.rgb_color||\"\"\nvar state = {\n    'state': msg.payload, \n    'brightness': msg.data.attributes.brightness||0,\n    'color_temp': msg.data.attributes.color_temp||\"\",\n    'rgb_color': rgb.toString()\n}\nflow.set(\"porch_light_state\",state);\n\nmsg.payload = state\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":240,"wires":[["fd6008a8.b29698"]]},{"id":"205b4ae3.02aab6","type":"comment","z":"ca5c607e.6b2b18","name":"Turn garage door notificaiton lights on when it opens.","info":"","x":220,"y":20,"wires":[]},{"id":"1071a5.8c709e5b","type":"comment","z":"450e6ab5.73fe64","name":"Restore the porch + entry lights to their previous states.","info":"","x":220,"y":380,"wires":[]},{"id":"df8a9ce5.1ec16","type":"inject","z":"ca5c607e.6b2b18","name":"5m","topic":"","payload":"true","payloadType":"bool","repeat":"300","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":380,"wires":[["fe3f6676.83f7d"]]},{"id":"7de72f13.1b095","type":"comment","z":"ca5c607e.6b2b18","name":"Restore the garage notification lights to their previous states.","info":"","x":240,"y":180,"wires":[]},{"id":"c68d075.1c68f78","type":"link out","z":"ca5c607e.6b2b18","name":"","links":["f7563356.ef229"],"x":655,"y":360,"wires":[]},{"id":"6023431.e9f7f3c","type":"debug","z":"da29b66a.c6921","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":360,"wires":[]},{"id":"3e559c98.244a24","type":"debug","z":"da29b66a.c6921","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":310,"y":660,"wires":[]},{"id":"3def1843.de0268","type":"mqtt in","z":"da29b66a.c6921","name":"","topic":"speech/last_message","qos":"2","broker":"6aa0e47a.29857c","x":120,"y":660,"wires":[["3e559c98.244a24"]]},{"id":"4b78e8da.64ba68","type":"debug","z":"da29b66a.c6921","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":370,"y":740,"wires":[]},{"id":"45211d6f.92612c","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":740,"wires":[["53904ad5.e90fbc"]],"l":false},{"id":"6af78adb.ea63fc","type":"switch","z":"ca5c607e.6b2b18","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":true,"outputs":2,"x":410,"y":380,"wires":[["f59068df.e1b4e","f66baed.feca35"],[]]},{"id":"8700c95e.69cec","type":"link out","z":"ca5c607e.6b2b18","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":715,"y":80,"wires":[]},{"id":"7d215503.c3568c","type":"inject","z":"ca5c607e.6b2b18","name":"Test Garage OPEN","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":570,"y":80,"wires":[["8700c95e.69cec"]]},{"id":"45e89160.faee58","type":"link out","z":"ca5c607e.6b2b18","name":"","links":["f7563356.ef229"],"x":715,"y":120,"wires":[]},{"id":"33675c80.8bb244","type":"inject","z":"ca5c607e.6b2b18","name":"Test Garage CLOSED","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":580,"y":120,"wires":[["45e89160.faee58","58a8e0b1.36d0f"]]},{"id":"dc672aa5.6b1d1","type":"link in","z":"a14a13fb.20e7d8","name":"flash_hue_lights","links":["8688db4a.98e478","b2f5300d.e5abe"],"x":35,"y":540,"wires":[["1b3d5990.34cde6"]]},{"id":"83fc7716.83fdc","type":"delay","z":"a14a13fb.20e7d8","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":540,"wires":[["29abbeeb.066392"]]},{"id":"98889258.bc24c","type":"delay","z":"a14a13fb.20e7d8","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":530,"y":540,"wires":[["3cb3ccfe.66fa1c"]]},{"id":"a9b91064.7ab3b8","type":"comment","z":"a14a13fb.20e7d8","name":"flash_hue_lights","info":"","x":100,"y":500,"wires":[]},{"id":"24801f3e.31b7b8","type":"comment","z":"a14a13fb.20e7d8","name":"notification_lights","info":"","x":100,"y":140,"wires":[]},{"id":"b2f5300d.e5abe","type":"link out","z":"a14a13fb.20e7d8","name":"","links":["dc672aa5.6b1d1"],"x":515,"y":180,"wires":[]},{"id":"8f1fda29.143998","type":"link in","z":"a14a13fb.20e7d8","name":"notification_lights","links":["d4b696cd.ee40c","8700c95e.69cec","c7477549.b13398","759647b.d226bb8","5898afa4.9c9f3","61b4602f.3055","1200fcb3.1714cb","5dc4c79c.fc5c1","fd1778d.2525a88","53bec38a.05aa54","98600f40.c202f","146331e7.f474a6","270466e5.778baa","f0a8155e.8dae78","bc522b6f.e7fd88","54660064.0c351","4c946240.54f4ac","26e74323.4a222c","5b33a563.305094","b41cdf91.036fe","5384b2c3.2ff5b4"],"x":35,"y":200,"wires":[["54a2d423.65546c","70960eb2.7936"]]},{"id":"d4b696cd.ee40c","type":"link out","z":"ca5c607e.6b2b18","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":155,"y":120,"wires":[]},{"id":"1e7d23cc.444c1c","type":"comment","z":"a14a13fb.20e7d8","name":"notification_lights_restore","info":"","x":130,"y":320,"wires":[]},{"id":"f7563356.ef229","type":"link in","z":"a14a13fb.20e7d8","name":"notification_lights_restore","links":["c68d075.1c68f78","c7bab392.8a157","45e89160.faee58","843043a9.581cc","315f1430.bfbdcc","4ffaa679.9c6c78","5b57de32.eca4f8"],"x":35,"y":380,"wires":[["17489a33.40c76e","70237bfd.d4357c"]]},{"id":"c7bab392.8a157","type":"link out","z":"ca5c607e.6b2b18","name":"","links":["f7563356.ef229"],"x":275,"y":220,"wires":[]},{"id":"c535e63.77b2318","type":"comment","z":"ca5c607e.6b2b18","name":"notification_lights","info":"","x":270,"y":120,"wires":[]},{"id":"5eef6c3.80fd294","type":"comment","z":"ca5c607e.6b2b18","name":"notification_lights_restore","info":"","x":410,"y":220,"wires":[]},{"id":"ccf338cd.045f18","type":"comment","z":"ca5c607e.6b2b18","name":"notification_lights_restore","info":"","x":790,"y":360,"wires":[]},{"id":"bedaa953.86b0c","type":"comment","z":"754c564.7b83828","name":"School","info":"","x":70,"y":160,"wires":[]},{"id":"f6bdcc9a.b82948","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":390,"y":200,"wires":[["5898afa4.9c9f3","aaa53789.dbaea8","3f0cbd40.1f4fa2"]]},{"id":"aaa53789.dbaea8","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":550,"y":200,"wires":[["1c195dd.256f3a2"]]},{"id":"5898afa4.9c9f3","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":515,"y":160,"wires":[]},{"id":"f32cfa02.47e04","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":620,"y":160,"wires":[]},{"id":"c96df73a.4e8d48","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":390,"y":320,"wires":[["61b4602f.3055","4ac48397.09f92c","ae53fcca.5960d"]]},{"id":"4ac48397.09f92c","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":550,"y":320,"wires":[["342ae7e2.f1247"]]},{"id":"61b4602f.3055","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":515,"y":280,"wires":[]},{"id":"4a83e75.42c4d18","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":620,"y":280,"wires":[]},{"id":"1d3a99f4.3c1a06","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":790,"y":320,"wires":[["6a86b056.e316a8"]]},{"id":"cef7c005.d546c","type":"comment","z":"754c564.7b83828","name":"Art","info":"","x":70,"y":560,"wires":[]},{"id":"c864b41d.98e718","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":600,"wires":[["eb9b0206.ec8e68","d64e41c.876bb4","1200fcb3.1714cb"]]},{"id":"eb9b0206.ec8e68","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":600,"wires":[["61f8d35f.50f2ac"]]},{"id":"1200fcb3.1714cb","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":355,"y":560,"wires":[]},{"id":"243e3d67.26caea","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":460,"y":560,"wires":[]},{"id":"8c828c31.c024e","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":720,"wires":[["7bfd24ee.c1618c","2ca5381.1732bc8","5dc4c79c.fc5c1"]]},{"id":"7bfd24ee.c1618c","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":720,"wires":[["fb220d5f.6d6eb"]]},{"id":"5dc4c79c.fc5c1","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":355,"y":680,"wires":[]},{"id":"6a2e1a34.4a0fe4","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":460,"y":680,"wires":[]},{"id":"8c3c0880.b4525","type":"comment","z":"754c564.7b83828","name":"Counseling","info":"","x":90,"y":820,"wires":[]},{"id":"4adf6584.3bd4d4","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":860,"wires":[["7f116965.8e9198","1055b4f3.5f87db","fd1778d.2525a88"]]},{"id":"7f116965.8e9198","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":860,"wires":[["d3710798.53a65"]]},{"id":"fd1778d.2525a88","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":355,"y":820,"wires":[]},{"id":"dd21d269.320398","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":460,"y":820,"wires":[]},{"id":"14e66f25.06c2c9","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":980,"wires":[["21e7f0c7.92487","ffc905d1.347b4","53bec38a.05aa54"]]},{"id":"21e7f0c7.92487","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":980,"wires":[["784e6f23.1308e8"]]},{"id":"53bec38a.05aa54","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":355,"y":940,"wires":[]},{"id":"54b22ea7.1c759","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":460,"y":940,"wires":[]},{"id":"fac0ae5c.057ce","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":630,"y":980,"wires":[["baea09c3.32077"]]},{"id":"ecc9572b.40b54","type":"delay","z":"ca5c607e.6b2b18","name":"5s","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":190,"y":260,"wires":[["c7bab392.8a157","bfa887ff.983ae","58a8e0b1.36d0f"]]},{"id":"dca570f8.9590f8","type":"comment","z":"ca5c607e.6b2b18","name":"notification_lights","info":"","x":830,"y":80,"wires":[]},{"id":"59483621.11b0f8","type":"comment","z":"ca5c607e.6b2b18","name":"notification_lights_restore","info":"","x":850,"y":120,"wires":[]},{"id":"be39d7dd.494038","type":"function","z":"450e6ab5.73fe64","name":"clear_state","func":"var rgb = msg.data.attributes.rgb_color||\"\"\nvar state = {\n    'state': \"off\", \n    'brightness': \"0\",\n    'color_temp': \"\",\n    'rgb_color': \"\"\n}\nflow.set(\"entry_light_state\",state);\n\nmsg.payload = state\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":420,"wires":[[]]},{"id":"8b27bef1.58ea","type":"function","z":"450e6ab5.73fe64","name":"clear_state","func":"var rgb = msg.data.attributes.rgb_color||\"\"\nvar state = {\n    'state': \"off\", \n    'brightness': \"0\",\n    'color_temp': \"\",\n    'rgb_color': \"\"\n}\nflow.set(\"porch_light_state\",state);\n\nmsg.payload = state\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":500,"wires":[[]]},{"id":"be213986.1cad","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":400,"wires":[["4eb652b2.514f14"]],"l":false},{"id":"ac367463.e8c26","type":"switch","z":"da29b66a.c6921","name":"not light.3a*","property":"payload.entity_id","propertyType":"msg","rules":[{"t":"cont","v":"light.3a","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":400,"wires":[[],["2ef73736.1d556"]]},{"id":"2ef73736.1d556","type":"join","z":"da29b66a.c6921","name":"","mode":"auto","build":"array","property":"payload.entity_id","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":450,"y":400,"wires":[["24c667d5.effd48","a4b9f7c4.475b3"]]},{"id":"c6f7fd73.d9dee","type":"link in","z":"a14a13fb.20e7d8","name":"get_lights_on","links":["1200fcb3.1714cb","146331e7.f474a6","1c785aa4.b578d5","270466e5.778baa","53bec38a.05aa54","54660064.0c351","5898afa4.9c9f3","5dc4c79c.fc5c1","61b4602f.3055","8700c95e.69cec","98600f40.c202f","d4b696cd.ee40c","f0a8155e.8dae78","fd1778d.2525a88","4c946240.54f4ac","26e74323.4a222c","5b33a563.305094","b41cdf91.036fe","5384b2c3.2ff5b4"],"x":35,"y":60,"wires":[["6b718b2d.610504"]]},{"id":"19133fbe.0c9b08","type":"comment","z":"a14a13fb.20e7d8","name":"get_lights_on","info":"","x":90,"y":20,"wires":[]},{"id":"7576a9c0.14ad48","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":520,"wires":[["1c785aa4.b578d5","bbc4f7e1.58001"]],"l":false},{"id":"72b53231.7e102c","type":"debug","z":"da29b66a.c6921","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":410,"y":520,"wires":[]},{"id":"1c785aa4.b578d5","type":"link out","z":"da29b66a.c6921","name":"","links":["c6f7fd73.d9dee"],"x":115,"y":500,"wires":[]},{"id":"8abbc0ff.14768","type":"function","z":"da29b66a.c6921","name":"get_lights_on","func":"msg = global.get(\"lights_on\");\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":540,"wires":[["cf7d4f8f.53a558","72b53231.7e102c"]]},{"id":"99106076.8ae068","type":"comment","z":"da29b66a.c6921","name":"lights_on","info":"","x":200,"y":500,"wires":[]},{"id":"bbc4f7e1.58001","type":"delay","z":"da29b66a.c6921","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":150,"y":540,"wires":[["8abbc0ff.14768"]]},{"id":"cf7d4f8f.53a558","type":"function","z":"da29b66a.c6921","name":"clear_state","func":"global.set(\"lights_on\",\"\");\nmsg = global.get(\"lights_on\");\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":560,"wires":[[]]},{"id":"dbbcfa3.d320c88","type":"function","z":"da29b66a.c6921","name":"get_lights_on","func":"msg = global.get(\"lights_on\");\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":600,"wires":[["7c60c820.6cf37"]]},{"id":"7c60c820.6cf37","type":"debug","z":"da29b66a.c6921","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":310,"y":600,"wires":[]},{"id":"9e25e76e.731bc","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":600,"wires":[["dbbcfa3.d320c88"]],"l":false},{"id":"1b3d5990.34cde6","type":"delay","z":"a14a13fb.20e7d8","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":130,"y":540,"wires":[["493700ea.15c01"]]},{"id":"24c667d5.effd48","type":"debug","z":"da29b66a.c6921","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":570,"y":460,"wires":[]},{"id":"bf6954a7.00fae","type":"server-state-changed","z":"ca5c607e.6b2b18","name":"'open'","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"cover.garage_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"open","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":false,"x":70,"y":100,"wires":[[],["50f0117a.626be","d4b696cd.ee40c"]]},{"id":"af3f1886.af36f8","type":"server-state-changed","z":"ca5c607e.6b2b18","name":"'closed'","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"cover.garage_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"closed","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":false,"x":70,"y":260,"wires":[[],["ecc9572b.40b54"]]},{"id":"3e263fab.ea5108","type":"api-call-service","z":"da29b66a.c6921","name":"off","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_off","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":510,"y":320,"wires":[[]]},{"id":"ca8809c5.c63148","type":"api-call-service","z":"da29b66a.c6921","name":"update: lights_on","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"turn_on","entityId":"script.lights_on_update","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":190,"y":340,"wires":[["cf52e137.624de8"]]},{"id":"d56ee077.72a65","type":"api-call-service","z":"450e6ab5.73fe64","name":"full brightness","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_on","entityId":"light.entry_light","data":"{\"brightness\":\"255\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":600,"y":180,"wires":[[]]},{"id":"efd758b3.1a9b18","type":"api-call-service","z":"450e6ab5.73fe64","name":"restore brightness","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_on","entityId":"light.entry_light","data":"{\"brightness\":\"{{payload.brightness}}\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":570,"y":400,"wires":[["be39d7dd.494038"]]},{"id":"b7eb3298.b985a8","type":"api-call-service","z":"450e6ab5.73fe64","name":"restore off state","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_off","entityId":"light.entry_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":560,"y":440,"wires":[["be39d7dd.494038"]]},{"id":"fd6008a8.b29698","type":"api-call-service","z":"450e6ab5.73fe64","name":"full brightness","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_on","entityId":"light.porch","data":"{\"brightness\":\"255\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":600,"y":240,"wires":[[]]},{"id":"f91ebc0c.726e1","type":"api-call-service","z":"450e6ab5.73fe64","name":"restore brightness","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_on","entityId":"light.porch","data":"{\"brightness\":\"{{payload.brightness}}\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":570,"y":480,"wires":[["8b27bef1.58ea"]]},{"id":"6a4e3836.fff1e8","type":"api-call-service","z":"450e6ab5.73fe64","name":"restore off state","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_off","entityId":"light.porch","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":560,"y":520,"wires":[["8b27bef1.58ea"]]},{"id":"112870f4.8e9d87","type":"api-call-service","z":"450e6ab5.73fe64","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Front Door\",\"message\":\"Unlocked: entry lights at full brightness\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":240,"y":300,"wires":[[]]},{"id":"bb0e68f6.537748","type":"api-call-service","z":"450e6ab5.73fe64","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Front Door\",\"message\":\"Locked: restore entry lights state\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":220,"y":560,"wires":[[]]},{"id":"bfa887ff.983ae","type":"api-call-service","z":"ca5c607e.6b2b18","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Garage Door\",\"message\":\"Closed\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":320,"y":260,"wires":[[]]},{"id":"f66baed.feca35","type":"api-call-service","z":"ca5c607e.6b2b18","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Garage Door\",\"message\":\"5 minute timeout\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":540,"y":400,"wires":[[]]},{"id":"50f0117a.626be","type":"api-call-service","z":"ca5c607e.6b2b18","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Garage Door\",\"message\":\"Open\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":200,"y":80,"wires":[[]]},{"id":"58a8e0b1.36d0f","type":"api-call-service","z":"ca5c607e.6b2b18","name":"iOS Notification","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_mobile","entityId":"","data":"{\"title\":\"CLOSED\",\"message\":\"The garage door is closed.\",\"who\":\"parents\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":340,"y":300,"wires":[[]]},{"id":"493700ea.15c01","type":"api-call-service","z":"a14a13fb.20e7d8","name":"flash","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_on","entityId":"","data":"{\"flash\":\"short\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":230,"y":540,"wires":[["83fc7716.83fdc"]]},{"id":"29abbeeb.066392","type":"api-call-service","z":"a14a13fb.20e7d8","name":"flash","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_on","entityId":"","data":"{\"flash\":\"short\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":430,"y":540,"wires":[["98889258.bc24c"]]},{"id":"3cb3ccfe.66fa1c","type":"api-call-service","z":"a14a13fb.20e7d8","name":"flash","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_on","entityId":"","data":"{\"flash\":\"short\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":630,"y":540,"wires":[[]]},{"id":"54a2d423.65546c","type":"api-call-service","z":"a14a13fb.20e7d8","name":"garage entry light: color_loop, 75% brightness","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_on","entityId":"light.garage_entry","data":"{\"brightness\":\"191\",\"effect\":\"colorloop\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":280,"y":180,"wires":[["b2f5300d.e5abe"]]},{"id":"17489a33.40c76e","type":"api-call-service","z":"a14a13fb.20e7d8","name":"garage entry: OFF","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_off","entityId":"light.garage_entry","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":190,"y":360,"wires":[[]]},{"id":"1c195dd.256f3a2","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"It's almost time to leave for school. ... Please brush your hair ... and pack your supplies in the car.\",\"media_player\":\"group.alexa_downstairs\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":660,"y":200,"wires":[[]]},{"id":"3f0cbd40.1f4fa2","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Event Reminders\",\"message\":\"School\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":560,"y":240,"wires":[[]]},{"id":"342ae7e2.f1247","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"It is time to get in the car. ... Grab your things and go.\",\"media_player\":\"group.alexa_downstairs\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":660,"y":320,"wires":[["1d3a99f4.3c1a06"]]},{"id":"ae53fcca.5960d","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Event Reminders\",\"message\":\"School\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":560,"y":360,"wires":[[]]},{"id":"6a86b056.e316a8","type":"api-call-service","z":"754c564.7b83828","name":"Goodbye Routine","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"goodbye_routine","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":930,"y":320,"wires":[[]]},{"id":"61f8d35f.50f2ac","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"Kyle, ... it's almost time to leave for art. ... Please start wrapping up.\",\"media_player\":\"group.alexa_downstairs\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":500,"y":600,"wires":[[]]},{"id":"d64e41c.876bb4","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Event Reminders\",\"message\":\"Art\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":400,"y":640,"wires":[[]]},{"id":"fb220d5f.6d6eb","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"Kyle ... it is time to get in the car. Let's go.\",\"media_player\":\"group.alexa_downstairs\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":500,"y":720,"wires":[[]]},{"id":"2ca5381.1732bc8","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Event Reminders\",\"message\":\"Art\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":400,"y":760,"wires":[[]]},{"id":"d3710798.53a65","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"It's almost time to leave for counseling. ... Please start wrapping up what you are doing.\",\"media_player\":\"group.alexa_downstairs\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":500,"y":860,"wires":[[]]},{"id":"1055b4f3.5f87db","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Event Reminders\",\"message\":\"Counseling\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":400,"y":900,"wires":[[]]},{"id":"784e6f23.1308e8","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"It is time to get in the car. Let's go.\",\"media_player\":\"group.alexa_downstairs\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":500,"y":980,"wires":[["fac0ae5c.057ce"]]},{"id":"ffc905d1.347b4","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Event Reminders\",\"message\":\"Counseling\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":400,"y":1020,"wires":[[]]},{"id":"baea09c3.32077","type":"api-call-service","z":"754c564.7b83828","name":"Goodbye Routine","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"goodbye_routine","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":770,"y":980,"wires":[[]]},{"id":"a4b9f7c4.475b3","type":"api-call-service","z":"da29b66a.c6921","name":"off","server":"71cca0bd.6fe0a","version":"1","service_domain":"light","service":"turn_off","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":590,"y":400,"wires":[[]]},{"id":"c73f2d79.9ba418","type":"trigger-state","z":"450e6ab5.73fe64","name":"locked","server":"71cca0bd.6fe0a","entityid":"lock.front_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"zw84gf9o1do","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"unlocked"},{"id":"pive1wk276d","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"locked"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":70,"y":500,"wires":[["964404f4.6b395","74e5190c.a3a1d","bb0e68f6.537748"],[]]},{"id":"44a299e6.036eb","type":"trigger-state","z":"450e6ab5.73fe64","name":"unlocked","server":"71cca0bd.6fe0a","entityid":"lock.front_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"cfev1052maw","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"locked"},{"id":"01gmr6s7g0n2","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"unlocked"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":80,"y":240,"wires":[["1daad02c.93d5d8","ead9322c.47eb1","112870f4.8e9d87"],[]]},{"id":"cf52e137.624de8","type":"api-current-state","z":"da29b66a.c6921","name":"get: lights_on","server":"71cca0bd.6fe0a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"variable.lights_on","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":360,"y":340,"wires":[["6023431.e9f7f3c","3e263fab.ea5108"]]},{"id":"1daad02c.93d5d8","type":"api-current-state","z":"450e6ab5.73fe64","name":"entry light: current_state","server":"71cca0bd.6fe0a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"light.entry_light","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":290,"y":180,"wires":[["26fbc3ff.ce2d74"]]},{"id":"ead9322c.47eb1","type":"api-current-state","z":"450e6ab5.73fe64","name":"porch light: current_state","server":"71cca0bd.6fe0a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"light.porch","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":290,"y":240,"wires":[["e0f5717e.4c6ee"]]},{"id":"f59068df.e1b4e","type":"api-current-state","z":"ca5c607e.6b2b18","name":"door closed?","server":"71cca0bd.6fe0a","version":"1","outputs":2,"halt_if":"closed","halt_if_type":"str","halt_if_compare":"is_not","override_topic":true,"entity_id":"cover.garage_door","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":550,"y":360,"wires":[[],["c68d075.1c68f78"]]},{"id":"fe3f6676.83f7d","type":"api-current-state","z":"ca5c607e.6b2b18","name":"garage entry on?","server":"71cca0bd.6fe0a","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"light.garage_entry","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":250,"y":380,"wires":[[],["6af78adb.ea63fc"]]},{"id":"53904ad5.e90fbc","type":"api-current-state","z":"da29b66a.c6921","name":"get: weather.home","server":"71cca0bd.6fe0a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"weather.home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":190,"y":740,"wires":[["4b78e8da.64ba68"]]},{"id":"4eb652b2.514f14","type":"ha-get-entities","z":"da29b66a.c6921","server":"71cca0bd.6fe0a","name":"get_lights_on","rules":[{"property":"state","logic":"is","value":"on","valueType":"str"},{"property":"entity_id","logic":"starts_with","value":"light.","valueType":"str"},{"property":"entity_id","logic":"is_not","value":"light.dummy","valueType":"str"},{"property":"entity_id","logic":"is_not","value":"light.entry","valueType":"str"},{"property":"entity_id","logic":"is_not","value":"light.hue","valueType":"str"},{"property":"entity_id","logic":"is_not","value":"light.living_room","valueType":"str"},{"property":"entity_id","logic":"does_not_include","value":"garage_entry","valueType":"str"},{"property":"entity_id","logic":"does_not_include","value":"gateway_light","valueType":"str"},{"property":"entity_id","logic":"does_not_include","value":"shoe_closet","valueType":"str"},{"property":"entity_id","logic":"does_not_include","value":"nightlight","valueType":"str"},{"property":"entity_id","logic":"does_not_include","value":"_group","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":170,"y":400,"wires":[["ac367463.e8c26"]]},{"id":"fd03bd48.31be7","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":1,\"mod\":420},\"end\":{\"dow\":1,\"mod\":435}},{\"start\":{\"dow\":2,\"mod\":420},\"end\":{\"dow\":2,\"mod\":435}},{\"start\":{\"dow\":3,\"mod\":420},\"end\":{\"dow\":3,\"mod\":435}},{\"start\":{\"dow\":4,\"mod\":420},\"end\":{\"dow\":4,\"mod\":435}},{\"start\":{\"dow\":5,\"mod\":420},\"end\":{\"dow\":5,\"mod\":435}}]","topic":"","name":"M-F @ 7:00","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":90,"y":200,"wires":[["f6bdcc9a.b82948"]]},{"id":"6ace99c4.bb9f58","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":1,\"mod\":435},\"end\":{\"dow\":1,\"mod\":450}},{\"start\":{\"dow\":2,\"mod\":435},\"end\":{\"dow\":2,\"mod\":450}},{\"start\":{\"dow\":3,\"mod\":435},\"end\":{\"dow\":3,\"mod\":450}},{\"start\":{\"dow\":4,\"mod\":435},\"end\":{\"dow\":4,\"mod\":450}},{\"start\":{\"dow\":5,\"mod\":435},\"end\":{\"dow\":5,\"mod\":450}}]","topic":"","name":"M-F @ 7:15","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":90,"y":320,"wires":[["c96df73a.4e8d48"]]},{"id":"38440bfd.7b0934","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":2,\"mod\":900},\"end\":{\"dow\":2,\"mod\":915}}]","topic":"","name":"Tue @ 3:00","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":90,"y":600,"wires":[[]]},{"id":"c2d767a.571ad18","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":2,\"mod\":915},\"end\":{\"dow\":2,\"mod\":930}}]","topic":"","name":"Tue @ 3:15","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":90,"y":720,"wires":[[]]},{"id":"d418a8da.2c4b","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":3,\"mod\":945},\"end\":{\"dow\":3,\"mod\":960}}]","topic":"","name":"Wed @ 3:45 ","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":90,"y":860,"wires":[[]]},{"id":"5423260a.3b7508","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":3,\"mod\":960},\"end\":{\"dow\":3,\"mod\":975}}]","topic":"","name":"Wed @ 4:00","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":90,"y":980,"wires":[[]]},{"id":"ded5cbb.3fb45b8","type":"comment","z":"754c564.7b83828","name":"Lucas Homework Review","info":"","x":130,"y":420,"wires":[]},{"id":"e3b596f.1d3ca68","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":390,"y":460,"wires":[["98600f40.c202f","df2df3a9.21ef6","58e8e279.ec0fdc"]]},{"id":"df2df3a9.21ef6","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":550,"y":460,"wires":[["e3e0a377.d6812"]]},{"id":"98600f40.c202f","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":515,"y":420,"wires":[]},{"id":"e99342bf.d9463","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":620,"y":420,"wires":[]},{"id":"e3e0a377.d6812","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"Lucas... it is time to review your homework. Please bring it to mom or dad.\",\"media_player\":\"group.alexa_downstairs\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":660,"y":460,"wires":[[]]},{"id":"58e8e279.ec0fdc","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Event Reminders\",\"message\":\"Lucas Homework Review\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":560,"y":500,"wires":[[]]},{"id":"4f66f10f.43b808","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":1,\"mod\":1080},\"end\":{\"dow\":1,\"mod\":1095}},{\"start\":{\"dow\":2,\"mod\":1080},\"end\":{\"dow\":2,\"mod\":1095}},{\"start\":{\"dow\":4,\"mod\":1080},\"end\":{\"dow\":4,\"mod\":1095}},{\"start\":{\"dow\":5,\"mod\":1080},\"end\":{\"dow\":5,\"mod\":1095}},{\"start\":{\"dow\":3,\"mod\":1110},\"end\":{\"dow\":3,\"mod\":1125}}]","topic":"","name":"M-F @ 18:00/18:30","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":110,"y":460,"wires":[[]]},{"id":"332a3b13.51b6e4","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":780,"wires":[["c76c0e0d.dc2c78"]],"l":false},{"id":"7ba688fd.c0bd6","type":"debug","z":"da29b66a.c6921","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":390,"y":780,"wires":[]},{"id":"c76c0e0d.dc2c78","type":"api-render-template","z":"da29b66a.c6921","name":"last_alexa","server":"71cca0bd.6fe0a","template":"{%- for entity in states.media_player -%}\n  {%- if state_attr(entity.entity_id, 'last_called') == True -%}\n    {{ entity.entity_id }}\n  {%- endif -%}\n{%- endfor -%}","x":160,"y":780,"wires":[["7ba688fd.c0bd6"]]},{"id":"901b5b6a.9da4a8","type":"comment","z":"1f7e758c.1055ea","name":"Extended presence detection","info":"* Just Arrived\n* Home\n* Just Left\n* Away\n* Extended Away\n\nBased on Phil Hawthorne's [Making Home Assistantâ€™s Presence Detection not so Binary](https://philhawthorne.com/making-home-assistants-presence-detection-not-so-binary/)\nand Mauricio Bonani's [Node-RED version](https://bonani.tech/making-home-assistants-presence-detection-not-so-binary-node-red-version/).","x":140,"y":20,"wires":[]},{"id":"cced679b.610298","type":"server-state-changed","z":"da29b66a.c6921","name":"Brian","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"device_tracker.life360_brian","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":70,"y":920,"wires":[["40d3b8e1.d646c","bc9d0fc5.89f7"]]},{"id":"9772b158.3ff6a8","type":"server-state-changed","z":"da29b66a.c6921","name":"Nerene","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"device_tracker.life360_nerene","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":70,"y":960,"wires":[["40d3b8e1.d646c","bc9d0fc5.89f7"]]},{"id":"7792bcfa.9dee44","type":"server-state-changed","z":"da29b66a.c6921","name":"Eric","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"device_tracker.eric","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":70,"y":1020,"wires":[["214ba782.bd66d","bc9d0fc5.89f7"]]},{"id":"1d4b7faf.697f1","type":"server-state-changed","z":"da29b66a.c6921","name":"Sandy","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"device_tracker.sandy","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":70,"y":1060,"wires":[["214ba782.bd66d","bc9d0fc5.89f7"]]},{"id":"76c9acae.47dcbc","type":"server-state-changed","z":"da29b66a.c6921","name":"Heather","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"device_tracker.eric","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":70,"y":1100,"wires":[["214ba782.bd66d","bc9d0fc5.89f7"]]},{"id":"40d3b8e1.d646c","type":"link out","z":"da29b66a.c6921","name":"presence_hanifins","links":[],"x":235,"y":940,"wires":[]},{"id":"214ba782.bd66d","type":"link out","z":"da29b66a.c6921","name":"presence_goezs","links":[],"x":235,"y":1060,"wires":[]},{"id":"bc9d0fc5.89f7","type":"link out","z":"da29b66a.c6921","name":"presence_residents","links":["26e52f90.e382b","e7f82493.934508","2f16aaf0.59386e","f73e6dcf.78cd6"],"x":195,"y":1000,"wires":[]},{"id":"5c6b4b2b.24147c","type":"comment","z":"da29b66a.c6921","name":"presence","info":"","x":80,"y":880,"wires":[]},{"id":"81041078.b5c34","type":"comment","z":"da29b66a.c6921","name":"presence_hanifins","info":"","x":350,"y":940,"wires":[]},{"id":"903baec7.e75f58","type":"comment","z":"da29b66a.c6921","name":"presence_goezs","info":"","x":340,"y":1060,"wires":[]},{"id":"d155b3c7.791ce","type":"comment","z":"da29b66a.c6921","name":"presence_residents","info":"","x":350,"y":1000,"wires":[]},{"id":"c2cdfaa1.afeec8","type":"trigger-state","z":"da29b66a.c6921","name":"","server":"71cca0bd.6fe0a","entityid":"^input_boolean\\.(brian|nerene)$","entityidfiltertype":"regex","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":230,"y":1200,"wires":[["cb2f509d.479a68","8ec1b08e.e57a7"],[]]},{"id":"5cd629cb.54f8a8","type":"server-state-changed","z":"da29b66a.c6921","name":"","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"^input_boolean\\.(brian|nerene)$","entityidfiltertype":"regex","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":200,"y":1360,"wires":[[]]},{"id":"3b951d6.3fe8662","type":"server-state-changed","z":"da29b66a.c6921","name":"","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"^input_boolean\\.(eric|sandy|heather)$","entityidfiltertype":"regex","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":220,"y":1400,"wires":[[]]},{"id":"cb2f509d.479a68","type":"link out","z":"da29b66a.c6921","name":"presence_hanifins_regex","links":[],"x":455,"y":1180,"wires":[]},{"id":"d10a38a3.1bc798","type":"link out","z":"da29b66a.c6921","name":"presence_goezs_regex","links":[],"x":455,"y":1260,"wires":[]},{"id":"8ec1b08e.e57a7","type":"link out","z":"da29b66a.c6921","name":"presence_residents_regex","links":["26e52f90.e382b"],"x":455,"y":1220,"wires":[]},{"id":"4997c95d.683fb8","type":"comment","z":"da29b66a.c6921","name":"presence_hanifins_regex","info":"","x":590,"y":1180,"wires":[]},{"id":"e38598c3.db4068","type":"comment","z":"da29b66a.c6921","name":"presence_goezs_regex","info":"","x":580,"y":1260,"wires":[]},{"id":"eb8c2760.31ac5","type":"comment","z":"da29b66a.c6921","name":"presence_residents_regex","info":"","x":590,"y":1220,"wires":[]},{"id":"be8ca44f.5209a8","type":"trigger-state","z":"da29b66a.c6921","name":"","server":"71cca0bd.6fe0a","entityid":"^input_boolean\\.(eric|sandy|heather)$","entityidfiltertype":"regex","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":210,"y":1240,"wires":[["8ec1b08e.e57a7","d10a38a3.1bc798"],[]]},{"id":"2cf8b60.d5968ca","type":"api-call-service","z":"1f7e758c.1055ea","name":"set_home","server":"71cca0bd.6fe0a","version":"1","service_domain":"input_select","service":"select_option","entityId":"input_select.{{topic}}","data":"{\"option\":\"Home\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1660,"y":40,"wires":[[]]},{"id":"5c8599e8.8d939","type":"trigger","z":"1f7e758c.1055ea","op1":"","op2":"{\"payload\":{\"data\":{\"option\":\"\"}}}","op1type":"nul","op2type":"json","duration":"10","extend":false,"units":"min","reset":"","bytopic":"topic","name":"wait_10_minutes","x":1490,"y":40,"wires":[["2cf8b60.d5968ca"]]},{"id":"fa9f34b5.15d73","type":"api-call-service","z":"1f7e758c.1055ea","name":"set_just_arrived","server":"71cca0bd.6fe0a","version":"1","service_domain":"input_select","service":"select_option","entityId":"input_select.{{topic}}","data":"{\"option\":\"Just Arrived\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1300,"y":20,"wires":[["5c8599e8.8d939"]]},{"id":"a178b00f.8b989","type":"change","z":"1f7e758c.1055ea","name":"reset_timeout","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":100,"wires":[["5c8599e8.8d939","70a8a4ab.868dbc"]]},{"id":"4cbf078f.c86f58","type":"switch","z":"1f7e758c.1055ea","name":"not_just_left","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Just Left","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":20,"wires":[["b31ed07a.60a6c8"],[]]},{"id":"b31ed07a.60a6c8","type":"switch","z":"1f7e758c.1055ea","name":"not_home","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Home","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1140,"y":20,"wires":[["fa9f34b5.15d73"]]},{"id":"70a8a4ab.868dbc","type":"trigger","z":"1f7e758c.1055ea","op1":"","op2":"{\"payload\":{\"data\":{\"option\":\"\"}}}","op1type":"nul","op2type":"json","duration":"24","extend":false,"units":"hr","reset":"","bytopic":"topic","name":"24 Hrs","x":2110,"y":80,"wires":[["1189313c.0d383f"]]},{"id":"440c847e.6fc77c","type":"api-current-state","z":"1f7e758c.1055ea","name":"get_curr_state","server":"71cca0bd.6fe0a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":800,"y":120,"wires":[["a178b00f.8b989","3a5891d5.05a1fe","c221d093.ce0f8"]]},{"id":"80dbc994.261ca8","type":"api-current-state","z":"1f7e758c.1055ea","name":"get_curr_state","server":"71cca0bd.6fe0a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":800,"y":40,"wires":[["4cbf078f.c86f58","c5974507.9b3fb8"]]},{"id":"c5974507.9b3fb8","type":"change","z":"1f7e758c.1055ea","name":"reset_timeout","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":60,"wires":[["70a8a4ab.868dbc","6003d40.f12e82c"]]},{"id":"513f21d2.27e4c8","type":"api-call-service","z":"1f7e758c.1055ea","name":"set_away","server":"71cca0bd.6fe0a","version":"1","service_domain":"input_select","service":"select_option","entityId":"input_select.{{topic}}","data":"{\"option\":\"Away\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1980,"y":120,"wires":[["70a8a4ab.868dbc"]]},{"id":"1189313c.0d383f","type":"api-call-service","z":"1f7e758c.1055ea","name":"set_extended_away","server":"71cca0bd.6fe0a","version":"1","service_domain":"input_select","service":"select_option","entityId":"input_select.{{topic}}","data":"{\"option\":\"Extended Away\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":2260,"y":80,"wires":[[]]},{"id":"6003d40.f12e82c","type":"trigger","z":"1f7e758c.1055ea","op1":"","op2":"{\"payload\":{\"data\":{\"option\":\"\"}}}","op1type":"nul","op2type":"json","duration":"10","extend":false,"units":"min","reset":"","bytopic":"topic","name":"wait_10_minutes","x":1510,"y":120,"wires":[["513f21d2.27e4c8"]]},{"id":"51e84b72.ce3a04","type":"template","z":"1f7e758c.1055ea","name":"set_entity_id","field":"payload.entity_id","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"input_select.{{topic}}","output":"str","x":650,"y":120,"wires":[["440c847e.6fc77c"]]},{"id":"3a5891d5.05a1fe","type":"switch","z":"1f7e758c.1055ea","name":"not_away","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Away","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":960,"y":140,"wires":[["ffa15cdb.d7186"]]},{"id":"3028fba0.f6959c","type":"template","z":"1f7e758c.1055ea","name":"set_entity_id","field":"payload.entity_id","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"input_select.{{topic}}","output":"str","x":649,"y":40,"wires":[["80dbc994.261ca8"]]},{"id":"ffa15cdb.d7186","type":"api-call-service","z":"1f7e758c.1055ea","name":"set_just_left","server":"71cca0bd.6fe0a","version":"1","service_domain":"input_select","service":"select_option","entityId":"input_select.{{topic}}","data":"{\"option\":\"Just Left\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1310,"y":140,"wires":[["6003d40.f12e82c"]]},{"id":"9ed9e366.0342c8","type":"switch","z":"1f7e758c.1055ea","name":"simple_presence","property":"status","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":450,"y":80,"wires":[["3028fba0.f6959c","590eda84.d2ac64"],["51e84b72.ce3a04","590eda84.d2ac64"]]},{"id":"839786c4.5142f8","type":"change","z":"1f7e758c.1055ea","name":"format_data","rules":[{"t":"move","p":"payload","pt":"msg","to":"status","tot":"msg"},{"t":"change","p":"topic","pt":"msg","from":"person.","fromt":"str","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":80,"wires":[["9ed9e366.0342c8"]]},{"id":"191b2fbd.001dd","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1120,"wires":[["c864df3a.4c42c"]]},{"id":"c956ce48.416678","type":"delay","z":"754c564.7b83828","name":"15s","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1260,"wires":[["315f1430.bfbdcc"]]},{"id":"146331e7.f474a6","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":355,"y":1080,"wires":[]},{"id":"270466e5.778baa","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":355,"y":1220,"wires":[]},{"id":"74a78217.9d163c","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":460,"y":1080,"wires":[]},{"id":"acd80fa2.c8ddc","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":460,"y":1220,"wires":[]},{"id":"e8b914f.512cbe8","type":"comment","z":"754c564.7b83828","name":"notification_lights_restore","info":"","x":590,"y":1260,"wires":[]},{"id":"315f1430.bfbdcc","type":"link out","z":"754c564.7b83828","name":"","links":["f7563356.ef229"],"x":455,"y":1260,"wires":[]},{"id":"c864df3a.4c42c","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"It's almost bed time Kyle. Wrap up your activities and be ready to head upstairs.\",\"media_player\":\"media_player.play_room\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":500,"y":1120,"wires":[[]]},{"id":"cd8e4572.87d3","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"Goodnight Kyle. It is time to go to bed.\",\"media_player\":\"media_player.play_room\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":500,"y":1300,"wires":[["a8e21553.be76b8"]]},{"id":"a426567c.82897","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Bedtime\",\"message\":\"Start: Announce it almost bedtime\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":400,"y":1160,"wires":[[]]},{"id":"95eb378b.7bcad","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Bedtime\",\"message\":\"End: Announce time to go to bed\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":400,"y":1340,"wires":[[]]},{"id":"34120dd6.d3e852","type":"api-call-service","z":"754c564.7b83828","name":"iOS Notification","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"notify_mobile","entityId":"","data":"{\"title\":\"Bedtime\",\"message\":\"The boys were reminded to go to bed.\",\"who\":\"brian\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":420,"y":1380,"wires":[[]]},{"id":"5d2e42f6.8f424c","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":1,\"mod\":1215},\"end\":{\"dow\":1,\"mod\":1230}},{\"start\":{\"dow\":2,\"mod\":1215},\"end\":{\"dow\":2,\"mod\":1230}},{\"start\":{\"dow\":3,\"mod\":1215},\"end\":{\"dow\":3,\"mod\":1230}},{\"start\":{\"dow\":4,\"mod\":1215},\"end\":{\"dow\":4,\"mod\":1230}},{\"start\":{\"dow\":0,\"mod\":1215},\"end\":{\"dow\":0,\"mod\":1230}}]","topic":"","name":"8:15","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":70,"y":1120,"wires":[["1a49b928.b1bd57"]]},{"id":"3ddcdcb0.d737cc","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":0,\"mod\":1230},\"end\":{\"dow\":0,\"mod\":1245}},{\"start\":{\"dow\":4,\"mod\":1230},\"end\":{\"dow\":4,\"mod\":1245}},{\"start\":{\"dow\":3,\"mod\":1230},\"end\":{\"dow\":3,\"mod\":1245}},{\"start\":{\"dow\":2,\"mod\":1230},\"end\":{\"dow\":2,\"mod\":1245}},{\"start\":{\"dow\":1,\"mod\":1230},\"end\":{\"dow\":1,\"mod\":1245}}]","topic":"","name":"8:30","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":70,"y":1300,"wires":[["ca6acd4f.cd4e88"]]},{"id":"8d6fea10.000d08","type":"comment","z":"754c564.7b83828","name":"Bedtime: Weekday, Kyle","info":"","x":130,"y":1080,"wires":[]},{"id":"a8e21553.be76b8","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":630,"y":1300,"wires":[["1c2e7832.8f6678"]]},{"id":"1c2e7832.8f6678","type":"api-call-service","z":"754c564.7b83828","name":"Goodbye Routine","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"goodbye_routine","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":770,"y":1300,"wires":[[]]},{"id":"3a708edd.184302","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1300,"wires":[["cd8e4572.87d3"]]},{"id":"73b25693.b2d368","type":"comment","z":"754c564.7b83828","name":"Buddy's Medicine","info":"","x":110,"y":20,"wires":[]},{"id":"b00bcc60.e79cc","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":590,"y":60,"wires":[["eced5a7e.ce05f8"]]},{"id":"f0a8155e.8dae78","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":555,"y":20,"wires":[]},{"id":"ed1d96e.3280de8","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":660,"y":20,"wires":[]},{"id":"eced5a7e.ce05f8","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"Buddy needs his medicine. Please check to see some were made up for the day.\",\"media_player\":\"group.alexa_downstairs\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":700,"y":60,"wires":[[]]},{"id":"c8a76a.887b0098","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Event Reminders\",\"message\":\"Buddy's Medicine\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":600,"y":100,"wires":[[]]},{"id":"d0ae3017.9ba","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":1,\"mod\":540},\"end\":{\"dow\":1,\"mod\":555}},{\"start\":{\"dow\":1,\"mod\":600},\"end\":{\"dow\":1,\"mod\":615}},{\"start\":{\"dow\":2,\"mod\":540},\"end\":{\"dow\":2,\"mod\":555}},{\"start\":{\"dow\":2,\"mod\":600},\"end\":{\"dow\":2,\"mod\":615}},{\"start\":{\"dow\":3,\"mod\":600},\"end\":{\"dow\":3,\"mod\":615}},{\"start\":{\"dow\":3,\"mod\":540},\"end\":{\"dow\":3,\"mod\":555}},{\"start\":{\"dow\":4,\"mod\":540},\"end\":{\"dow\":4,\"mod\":555}},{\"start\":{\"dow\":4,\"mod\":600},\"end\":{\"dow\":4,\"mod\":615}},{\"start\":{\"dow\":5,\"mod\":600},\"end\":{\"dow\":5,\"mod\":615}},{\"start\":{\"dow\":5,\"mod\":540},\"end\":{\"dow\":5,\"mod\":555}},{\"start\":{\"dow\":6,\"mod\":540},\"end\":{\"dow\":6,\"mod\":555}},{\"start\":{\"dow\":6,\"mod\":600},\"end\":{\"dow\":6,\"mod\":615}},{\"start\":{\"dow\":0,\"mod\":540},\"end\":{\"dow\":0,\"mod\":555}},{\"start\":{\"dow\":0,\"mod\":600},\"end\":{\"dow\":0,\"mod\":615}}]","topic":"","name":"8:30, 9:30am","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":90,"y":60,"wires":[[]]},{"id":"83bf9a01.9a15b8","type":"switch","z":"754c564.7b83828","name":"not 'Today'","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"Today","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":60,"wires":[["f0a8155e.8dae78","b00bcc60.e79cc","c8a76a.887b0098"],[]]},{"id":"ff82072f.1e84d","type":"trigger-state","z":"f6fd4470.cafc38","name":"Status Change","server":"71cca0bd.6fe0a","entityid":"binary_sensor.side_yard_status","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"habool","x":100,"y":280,"wires":[["4da13ff3.716af8"],["4da13ff3.716af8"]]},{"id":"d5907f75.c189f8","type":"comment","z":"f6fd4470.cafc38","name":"Irrigation Status Monitor","info":"","x":120,"y":240,"wires":[]},{"id":"e5788c51.b1151","type":"api-call-service","z":"f6fd4470.cafc38","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"binary_sensor.side_yard_status","data":"{\"name\":\"Node-RED > Watch Dogs\",\"message\":\"Irrigation unit is offline\",\"domain\":\"binary_sensor\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":780,"y":260,"wires":[[]]},{"id":"1aa3d544.8116a3","type":"api-call-service","z":"f6fd4470.cafc38","name":"iOS Notification","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_ios","entityId":"","data":"{\"title\":\"Irrigation Controller\",\"message\":\"The irrigation unit is offline. Please correct this soon.\",\"who\":\"brian\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":800,"y":220,"wires":[[]]},{"id":"4da13ff3.716af8","type":"switch","z":"f6fd4470.cafc38","name":"","property":"payload","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":true,"outputs":2,"x":250,"y":280,"wires":[["d6cd2ae2.eb2788"],["f2da2139.6e2b4"]]},{"id":"f2da2139.6e2b4","type":"api-call-service","z":"f6fd4470.cafc38","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"binary_sensor.side_yard_status","data":"{\"name\":\"Node-RED > Watch Dogs\",\"message\":\"Irrigation unit is online\",\"domain\":\"binary_sensor\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":780,"y":300,"wires":[[]]},{"id":"6d93290c.c1b71","type":"api-current-state","z":"f6fd4470.cafc38","name":"current status","server":"71cca0bd.6fe0a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"binary_sensor.side_yard_status","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":500,"y":260,"wires":[["972118e.8756468"]]},{"id":"d6cd2ae2.eb2788","type":"delay","z":"f6fd4470.cafc38","name":"15m","pauseType":"delay","timeout":"15","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":370,"y":260,"wires":[["6d93290c.c1b71"]]},{"id":"972118e.8756468","type":"switch","z":"f6fd4470.cafc38","name":"","property":"payload","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":true,"outputs":2,"x":630,"y":260,"wires":[["1aa3d544.8116a3","e5788c51.b1151"],["f2da2139.6e2b4"]]},{"id":"8166a2e2.0c4628","type":"comment","z":"f6fd4470.cafc38","name":"Nightly maintenance","info":"","x":110,"y":20,"wires":[]},{"id":"a22ea3c1.fcfa1","type":"light-scheduler","z":"f6fd4470.cafc38","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":1,\"mod\":135},\"end\":{\"dow\":1,\"mod\":150}},{\"start\":{\"dow\":2,\"mod\":135},\"end\":{\"dow\":2,\"mod\":150}},{\"start\":{\"dow\":3,\"mod\":135},\"end\":{\"dow\":3,\"mod\":150}},{\"start\":{\"dow\":4,\"mod\":135},\"end\":{\"dow\":4,\"mod\":150}},{\"start\":{\"dow\":5,\"mod\":135},\"end\":{\"dow\":5,\"mod\":150}},{\"start\":{\"dow\":6,\"mod\":135},\"end\":{\"dow\":6,\"mod\":150}},{\"start\":{\"dow\":0,\"mod\":135},\"end\":{\"dow\":0,\"mod\":150}}]","topic":"","name":"2:15am","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":80,"y":60,"wires":[["7ecc7142.6d01c"]]},{"id":"b1a76038.d9c3","type":"api-call-service","z":"f6fd4470.cafc38","name":"update medicine statuses","server":"71cca0bd.6fe0a","version":"1","service_domain":"homeassistant","service":"update_entity","entityId":"sensor.medicine_buddy_given_today","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":430,"y":40,"wires":[[]]},{"id":"7ecc7142.6d01c","type":"switch","z":"f6fd4470.cafc38","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":true,"outputs":2,"x":250,"y":60,"wires":[["b1a76038.d9c3"],["8c515997.03f5a"]]},{"id":"ec414630.7a01b","type":"api-call-service","z":"f6fd4470.cafc38","name":"restart home assistant","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"turn_on","entityId":"script.restart_hass","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":420,"y":100,"wires":[[]]},{"id":"6b322c3.275ea54","type":"comment","z":"f6fd4470.cafc38","name":"Dog Water Bowl","info":"","x":100,"y":400,"wires":[]},{"id":"3f489bbc.248774","type":"delay","z":"f6fd4470.cafc38","name":"2m","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":370,"y":440,"wires":[["d9de7267.3695e"]]},{"id":"d9de7267.3695e","type":"api-current-state","z":"f6fd4470.cafc38","name":"current state","server":"71cca0bd.6fe0a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.dog_water_bowl","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":490,"y":440,"wires":[["602b4b59.646fb4"]]},{"id":"ae758851.3d6838","type":"api-call-service","z":"f6fd4470.cafc38","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"binary_sensor.dog_water_bowl","data":"{\"name\":\"Node-RED > Watch Dogs\",\"message\":\"WATER BOWL EMPTY\",\"domain\":\"binary_sensor\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":760,"y":480,"wires":[[]]},{"id":"8578f100.9c36b8","type":"api-call-service","z":"f6fd4470.cafc38","name":"iOS Notification","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_ios","entityId":"","data":"{\"title\":\"WATER BOWL EMPTY\",\"message\":\"The dogs water bowl is empty!\\nPlease refill it soon.\",\"who\":\"brian\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":780,"y":440,"wires":[[]]},{"id":"661ffaf6.0cd43c","type":"api-call-service","z":"f6fd4470.cafc38","name":"Announce","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"The dogs water bowl is empty! ... Please refill it soon.\",\"media_player\":\"group.alexa_downstairs\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1020,"y":400,"wires":[[]]},{"id":"602b4b59.646fb4","type":"switch","z":"f6fd4470.cafc38","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"else"}],"checkall":"true","repair":true,"outputs":2,"x":610,"y":440,"wires":[["8578f100.9c36b8","ae758851.3d6838","d784ade8.50fa3"],[]]},{"id":"a570b19a.61e9d8","type":"switch","z":"f6fd4470.cafc38","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"else"}],"checkall":"true","repair":true,"outputs":2,"x":250,"y":440,"wires":[["3f489bbc.248774"],[]]},{"id":"aba95a6.10234a8","type":"server-state-changed","z":"450e6ab5.73fe64","name":"Ring Camera","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"camera.porch","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":90,"y":740,"wires":[[]]},{"id":"71a19c87.3d32bc","type":"comment","z":"450e6ab5.73fe64","name":"function: ring_video_download","info":"","x":350,"y":740,"wires":[]},{"id":"9a0eb802.3bed","type":"server-events","z":"450e6ab5.73fe64","name":"download failed","server":"71cca0bd.6fe0a","event_type":"downloader_download_failed","x":100,"y":920,"wires":[["d811e3ed.4d82d8"]]},{"id":"d811e3ed.4d82d8","type":"api-call-service","z":"450e6ab5.73fe64","name":"notification","server":"71cca0bd.6fe0a","version":"1","service_domain":"persistent_notification","service":"create","entityId":"","data":"{\"message\":\"An automated download has failed.\",\"title\":\"Download Failed\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":270,"y":920,"wires":[[]]},{"id":"3c5bc5c5.ebd532","type":"comment","z":"450e6ab5.73fe64","name":"Notify if a download fails.","info":"","x":130,"y":880,"wires":[]},{"id":"8c515997.03f5a","type":"delay","z":"f6fd4470.cafc38","name":"5m","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":610,"y":65,"wires":[["6fc5c28c.db39dc"]]},{"id":"6fc5c28c.db39dc","type":"api-call-service","z":"f6fd4470.cafc38","name":"Turn off TVs","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"turn_on","entityId":"script.tv_family_room_off, script.tv_living_room_off","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":730,"y":65,"wires":[[]]},{"id":"8727f4a3.261368","type":"switch","z":"a14a13fb.20e7d8","name":"old video url is a string","property":"data.old_state.attributes.video_url","propertyType":"msg","rules":[{"t":"istype","v":"string","vt":"string"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":180,"y":940,"wires":[["5ad279b1.9a1f"],["63912be2.c432ac"]]},{"id":"5ad279b1.9a1f","type":"switch","z":"a14a13fb.20e7d8","name":"new video url is a string","property":"data.new_state.attributes.video_url","propertyType":"msg","rules":[{"t":"istype","v":"string","vt":"string"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":920,"wires":[["3a62c788.a49928"],["114b6fc3.eaaeb"]]},{"id":"63912be2.c432ac","type":"change","z":"a14a13fb.20e7d8","name":"set old url to a string","rules":[{"t":"set","p":"data.old_state.attributes.video_url","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":960,"wires":[["5ad279b1.9a1f"]]},{"id":"3a62c788.a49928","type":"change","z":"a14a13fb.20e7d8","name":"","rules":[{"t":"set","p":"old","pt":"msg","to":"$match(data.old_state.attributes.video_url, /\\/(\\d+)\\/(\\d+)\\.mp4\\?/)","tot":"jsonata"},{"t":"set","p":"new","pt":"msg","to":"$match(data.new_state.attributes.video_url, /\\/(\\d+)\\/(\\d+)\\.mp4\\?/)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":920,"wires":[["e5c254e6.b814d8"]]},{"id":"114b6fc3.eaaeb","type":"change","z":"a14a13fb.20e7d8","name":"set new url to a string","rules":[{"t":"set","p":"data.new_state.attributes.video_url","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":960,"wires":[["3a62c788.a49928"]]},{"id":"e5c254e6.b814d8","type":"switch","z":"a14a13fb.20e7d8","name":"","property":"(old.groups[0] = new.groups[0]) and (old.groups[1] = new.groups[1])","propertyType":"jsonata","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":850,"y":920,"wires":[["fe5923bf.1a689","96405edd.ba6ad8"]]},{"id":"fe5923bf.1a689","type":"change","z":"a14a13fb.20e7d8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t   \"data\":{\t       \"url\": data.new_state.attributes.video_url,\t       \"subdir\": topic,\t       \"filename\": $join([new.groups[0], \"_\", new.groups[1], \".mp4\"])\t   }\t}","tot":"jsonata"},{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"data","pt":"msg"},{"t":"delete","p":"new","pt":"msg"},{"t":"delete","p":"old","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":920,"wires":[["7739ab73.b309bc"]]},{"id":"96405edd.ba6ad8","type":"debug","z":"a14a13fb.20e7d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":990,"y":960,"wires":[]},{"id":"7739ab73.b309bc","type":"api-call-service","z":"a14a13fb.20e7d8","name":"","server":"71cca0bd.6fe0a","version":"1","service_domain":"downloader","service":"download_file","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1230,"y":920,"wires":[["8e3f6660.634e88"]]},{"id":"8e3f6660.634e88","type":"debug","z":"a14a13fb.20e7d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1410,"y":920,"wires":[]},{"id":"6e006c43.b4a39c","type":"link in","z":"a14a13fb.20e7d8","name":"ring_video_download","links":["800943e0.5cd488"],"x":35,"y":940,"wires":[["8727f4a3.261368"]]},{"id":"cdbbe93.4e41a98","type":"comment","z":"a14a13fb.20e7d8","name":"ring_video_download","info":"","x":120,"y":900,"wires":[]},{"id":"800943e0.5cd488","type":"link out","z":"450e6ab5.73fe64","name":"","links":["6e006c43.b4a39c"],"x":195,"y":740,"wires":[]},{"id":"29f1ef16.f15b28","type":"comment","z":"450e6ab5.73fe64","name":"Ring Camera New Video Clip","info":"","x":140,"y":700,"wires":[]},{"id":"99102c76.134d28","type":"fs-file-lister","z":"450e6ab5.73fe64","name":"","start":"/","pattern":"*","path":true,"single":false,"depth":0,"stat":false,"x":240,"y":820,"wires":[[]]},{"id":"648a3509.1fd7cc","type":"inject","z":"450e6ab5.73fe64","name":">","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":820,"wires":[["99102c76.134d28"]]},{"id":"377ba0c0.98792","type":"server-state-changed","z":"f6fd4470.cafc38","name":"Status Change","server":"71cca0bd.6fe0a","version":"1","entityidfilter":"binary_sensor.dog_water_bowl","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"x":100,"y":440,"wires":[[]]},{"id":"d784ade8.50fa3","type":"api-render-template","z":"f6fd4470.cafc38","name":"8am-8pm?","server":"71cca0bd.6fe0a","template":"{%- set hour    = states(\"sensor.time\").split(':')[0] | int -%}\n{%- set minutes = states(\"sensor.time\").split(':')[1] | int -%}\n{{ (hour >=  8 and hour <  20) }}","x":770,"y":400,"wires":[["494ab6fc.a2e6c"]]},{"id":"494ab6fc.a2e6c","type":"switch","z":"f6fd4470.cafc38","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":890,"y":400,"wires":[["661ffaf6.0cd43c"],[]]},{"id":"659bb2c1.d2024c","type":"delay","z":"f6fd4470.cafc38","name":"5m","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":870,"y":65,"wires":[["271961cf.f3487e"]]},{"id":"271961cf.f3487e","type":"api-call-service","z":"f6fd4470.cafc38","name":"Turn off TVs","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"turn_on","entityId":"script.tv_family_room_off, script.tv_living_room_off","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":990,"y":65,"wires":[[]]},{"id":"6b29d51b.fe28f4","type":"api-current-state","z":"754c564.7b83828","name":"schoolday?","server":"71cca0bd.6fe0a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"binary_sensor.schoolday","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":250,"y":160,"wires":[[]]},{"id":"2c4c9c85.afae54","type":"api-current-state","z":"754c564.7b83828","name":"schoolday?","server":"71cca0bd.6fe0a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"binary_sensor.schoolday","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":250,"y":280,"wires":[[]]},{"id":"132f3dd0.44c112","type":"api-current-state","z":"754c564.7b83828","name":"schoolday?","server":"71cca0bd.6fe0a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"binary_sensor.schoolday","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":330,"y":420,"wires":[[]]},{"id":"f7060adf.d94768","type":"api-render-template","z":"754c564.7b83828","name":"is_weekday_and_holiday?","server":"71cca0bd.6fe0a","template":"{{  states.binary_sensor.weekday.state \nand states.binary_sensor.holiday.state }}","x":130,"y":1220,"wires":[[]]},{"id":"1a49b928.b1bd57","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":1120,"wires":[["146331e7.f474a6","191b2fbd.001dd","a426567c.82897"]]},{"id":"ca6acd4f.cd4e88","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":1300,"wires":[["270466e5.778baa","c956ce48.416678","3a708edd.184302","95eb378b.7bcad","34120dd6.d3e852"]]},{"id":"54fe20a9.b8d468","type":"debug","z":"da29b66a.c6921","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":370,"y":700,"wires":[]},{"id":"50c3787c.539ce8","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":700,"wires":[["e6bee514.db8168"]],"l":false},{"id":"e6bee514.db8168","type":"api-current-state","z":"da29b66a.c6921","name":"get: weather.dark_sky","server":"71cca0bd.6fe0a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"weather.dark_sky","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":200,"y":700,"wires":[["54fe20a9.b8d468"]]},{"id":"95a106a3.e2a2c8","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":820,"wires":[["62af295b.2b08b"]],"l":false},{"id":"62af295b.2b08b","type":"api-render-template","z":"da29b66a.c6921","name":"sensor.last_message","server":"71cca0bd.6fe0a","template":"{{ states('sensor.last_message') }}","x":200,"y":820,"wires":[["ddb29500.27d12"]]},{"id":"ddb29500.27d12","type":"debug","z":"da29b66a.c6921","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":370,"y":820,"wires":[]},{"id":"5b9bf1b6.99f048","type":"api-current-state","z":"754c564.7b83828","name":"get_day","server":"71cca0bd.6fe0a","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"sensor.medicine_buddy_given_today","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":240,"y":60,"wires":[["83bf9a01.9a15b8"]]},{"id":"37cf5217.bacdf6","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":6,\"mod\":540},\"end\":{\"dow\":6,\"mod\":555}},{\"start\":{\"dow\":0,\"mod\":540},\"end\":{\"dow\":0,\"mod\":555}},{\"start\":{\"dow\":6,\"mod\":570},\"end\":{\"dow\":6,\"mod\":585}},{\"start\":{\"dow\":0,\"mod\":570},\"end\":{\"dow\":0,\"mod\":585}},{\"start\":{\"dow\":0,\"mod\":600},\"end\":{\"dow\":0,\"mod\":615}},{\"start\":{\"dow\":6,\"mod\":600},\"end\":{\"dow\":6,\"mod\":615}},{\"start\":{\"dow\":6,\"mod\":630},\"end\":{\"dow\":6,\"mod\":645}},{\"start\":{\"dow\":0,\"mod\":630},\"end\":{\"dow\":0,\"mod\":645}}]","topic":"","name":"Weekend @ 9:00","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":110,"y":2220,"wires":[["42f3fcd1.03c4ac"]]},{"id":"42f3fcd1.03c4ac","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":260,"y":2220,"wires":[["54660064.0c351","a3317d26.2d6538","5d81a037.076508"]]},{"id":"54660064.0c351","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":365,"y":2180,"wires":[]},{"id":"a3317d26.2d6538","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":2220,"wires":[["66deb3c3.ea35b4"]]},{"id":"5d81a037.076508","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Event Reminders\",\"message\":\"Weekend Responsibilities\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":410,"y":2260,"wires":[[]]},{"id":"66deb3c3.ea35b4","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"say","entityId":"","data":"{\"say_greeting\":\"true\",\"say_responsibilities\":\"true\",\"media_player\":\"media_player.play_room\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":510,"y":2220,"wires":[[]]},{"id":"2cf512f5.9066be","type":"comment","z":"754c564.7b83828","name":"Weekend Responsibilities","info":"","x":140,"y":2180,"wires":[]},{"id":"3b800f03.56d7b","type":"cast-to-client","z":"da29b66a.c6921","name":"Jetsons Doorbell","url":"http://10.0.0.56:8123/local/audio/jetsons-doorbell.mp3","contentType":"audio/mp3","message":"","language":"en","ip":"10.0.0.27","port":"","volume":"20","x":190,"y":100,"wires":[[]]},{"id":"8254bacb.2f7708","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":100,"wires":[["3b800f03.56d7b"]],"l":false},{"id":"246b55f5.080862","type":"cast-to-client","z":"450e6ab5.73fe64","name":"Jetsons Doorbell","url":"http://10.0.0.56:8123/local/audio/jetsons-doorbell.mp3","contentType":"audio/mp3","message":"","language":"en","ip":"10.0.0.27","port":"","volume":"20","x":310,"y":60,"wires":[[]]},{"id":"bf3bbc88.eaf0f","type":"trigger-state","z":"450e6ab5.73fe64","name":"doorbell pressed","server":"71cca0bd.6fe0a","entityid":"binary_sensor.ring_front_door_ding","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"d8cgof7qnal","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"true"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"habool","x":110,"y":60,"wires":[[],[]]},{"id":"1ec59b47.db4a5d","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":160,"wires":[["6d88630d.8a2d0c"]],"l":false},{"id":"1adef664.8bfe12","type":"debug","z":"da29b66a.c6921","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":430,"y":160,"wires":[]},{"id":"6d88630d.8a2d0c","type":"api-current-state","z":"da29b66a.c6921","name":"","server":"71cca0bd.6fe0a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.last_alexa","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":230,"y":160,"wires":[["1adef664.8bfe12"]]},{"id":"a1a0fc87.42032","type":"trigger-state","z":"1f7e758c.1055ea","name":"presence_change","server":"71cca0bd.6fe0a","entityid":"^person\\.(brian|nerene|eric|sandy|heather)$","entityidfiltertype":"regex","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":110,"y":80,"wires":[["839786c4.5142f8"],[]]},{"id":"590eda84.d2ac64","type":"debug","z":"1f7e758c.1055ea","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":680,"y":220,"wires":[]},{"id":"7a94a210.35fa0c","type":"inject","z":"1f7e758c.1055ea","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":140,"wires":[["c192c945.8d7c48"]]},{"id":"c192c945.8d7c48","type":"api-current-state","z":"1f7e758c.1055ea","name":"","server":"71cca0bd.6fe0a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"person.brian","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":260,"y":140,"wires":[["839786c4.5142f8"]]},{"id":"c221d093.ce0f8","type":"debug","z":"1f7e758c.1055ea","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":890,"y":220,"wires":[]},{"id":"b76c321f.3686e8","type":"inject","z":"754c564.7b83828","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1360,"wires":[["ca6acd4f.cd4e88"]]},{"id":"b0990a98.da5ad8","type":"inject","z":"754c564.7b83828","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1180,"wires":[["1a49b928.b1bd57"]]},{"id":"ead40a89.42d788","type":"comment","z":"450e6ab5.73fe64","name":"A futuristic door chime for a futuristic house!","info":"","x":190,"y":20,"wires":[]},{"id":"b50edaf7.4ed138","type":"api-current-state","z":"1f7e758c.1055ea","name":"get_curr_state","server":"71cca0bd.6fe0a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1700,"y":160,"wires":[["23f41484.bb3acc"]]},{"id":"23f41484.bb3acc","type":"debug","z":"1f7e758c.1055ea","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1830,"y":220,"wires":[]},{"id":"a38c77bd.4bf858","type":"function","z":"a14a13fb.20e7d8","name":"set_global.lights_on","func":"global.set(\"lights_on\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":60,"wires":[[]]},{"id":"6b718b2d.610504","type":"api-call-service","z":"a14a13fb.20e7d8","name":"update: lights_on","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"turn_on","entityId":"script.lights_on_update","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":170,"y":60,"wires":[["2b5f7c2d.837954"]]},{"id":"94bebd9c.e5473","type":"api-current-state","z":"a14a13fb.20e7d8","name":"get: lights_on","server":"71cca0bd.6fe0a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"variable.lights_on","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":430,"y":60,"wires":[["a38c77bd.4bf858"]]},{"id":"2b5f7c2d.837954","type":"delay","z":"a14a13fb.20e7d8","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":310,"y":60,"wires":[["94bebd9c.e5473"]]},{"id":"c64ec2f0.977b5","type":"link out","z":"a14a13fb.20e7d8","name":"","links":["d2b56b6f.7d24b","6ed5f486.7257ec"],"x":695,"y":220,"wires":[]},{"id":"f58feb99.ba1ca8","type":"api-call-service","z":"a14a13fb.20e7d8","name":"family_room_table_lamp","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_on","entityId":"light.family_room_table_lamp","data":"{\"brightness\":\"128\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":550,"y":220,"wires":[["c64ec2f0.977b5"]]},{"id":"8af3ffd8.009c98","type":"switch","z":"a14a13fb.20e7d8","name":"","property":"payload.brightness","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":true,"outputs":2,"x":330,"y":420,"wires":[["4f43823c.ce4d9c"],["b65d90e8.954d38"]]},{"id":"d686f6f.9855188","type":"api-call-service","z":"a14a13fb.20e7d8","name":"match state","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_on","entityId":"light.family_room_table_lamp","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":475,"y":400,"wires":[["f089a4e7.040f"]],"icon":"font-awesome/fa-toggle-on","l":false},{"id":"fa07dfcd.0f6d3","type":"inject","z":"a14a13fb.20e7d8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":440,"wires":[["70237bfd.d4357c","17489a33.40c76e"]],"l":false},{"id":"a056eb26.c9c908","type":"comment","z":"f6fd4470.cafc38","name":"hass/status offline timeout","info":"","x":130,"y":140,"wires":[]},{"id":"7330f347.4f2544","type":"debug","z":"1f7e758c.1055ea","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1610,"y":220,"wires":[]},{"id":"89c6b4dc.7021e8","type":"interval-length","z":"f6fd4470.cafc38","format":"mills","bytopic":false,"minimum":"","maximum":"","window":"","timeout":false,"msgTimeout":"30","minimumunit":"secs","maximumunit":"secs","windowunit":"secs","msgTimeoutUnit":"secs","reset":false,"startup":true,"msgField":"payload","timestampField":"timestamp","repeatTimeout":false,"name":"","x":260,"y":180,"wires":[[],["a956f041.b4da48"]]},{"id":"c8cccda0.8ea338","type":"mqtt out","z":"f6fd4470.cafc38","name":"hass/status = offline","topic":"hass/status","qos":"0","retain":"","broker":"6aa0e47a.29857c","x":580,"y":180,"wires":[]},{"id":"a956f041.b4da48","type":"change","z":"f6fd4470.cafc38","name":"offline","rules":[{"t":"set","p":"payload","pt":"msg","to":"offline","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":180,"wires":[["c8cccda0.8ea338"]]},{"id":"e46db517.67b088","type":"function","z":"a14a13fb.20e7d8","name":"set_curr_state","func":"var state = {\n    'state': msg.payload, \n    'brightness': msg.data.attributes.brightness||0\n}\nflow.set(\"family_room_table_lamp_state\",state);\n\nmsg.payload = state\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":220,"wires":[["f58feb99.ba1ca8"]]},{"id":"70960eb2.7936","type":"api-current-state","z":"a14a13fb.20e7d8","name":"get_current_state","server":"71cca0bd.6fe0a","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"light.family_room_table_lamp","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":190,"y":220,"wires":[["e46db517.67b088"]]},{"id":"70237bfd.d4357c","type":"function","z":"a14a13fb.20e7d8","name":"get_prev_state","func":"msg.payload = flow.get(\"family_room_table_lamp_state\");\nreturn msg;","outputs":1,"noerr":0,"x":180,"y":420,"wires":[["8af3ffd8.009c98"]]},{"id":"aec3d5e.ad53fa8","type":"inject","z":"a14a13fb.20e7d8","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":260,"wires":[["70960eb2.7936","54a2d423.65546c"]],"l":false},{"id":"d2b56b6f.7d24b","type":"link in","z":"a14a13fb.20e7d8","name":"flash_standard_lights","links":["c64ec2f0.977b5"],"x":35,"y":640,"wires":[["6892b42f.ddd094"]]},{"id":"14f4778c.0bebf8","type":"api-call-service","z":"da29b66a.c6921","name":"off","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_off","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":515,"y":240,"wires":[["c84a90ac.b74868"]],"icon":"font-awesome/fa-toggle-off","l":false},{"id":"59c1aec.ce8e75","type":"inject","z":"da29b66a.c6921","name":">","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":55,"y":240,"wires":[["af33eb81.ceae08"]],"l":false},{"id":"af33eb81.ceae08","type":"api-call-service","z":"da29b66a.c6921","name":"table_lamp","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_on","entityId":"light.family_room_table_lamp","data":"{\"brightness\":\"191\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":170,"y":240,"wires":[["bc3e2596.5f94c","89fe6516.a1bba8"]]},{"id":"bc3e2596.5f94c","type":"debug","z":"da29b66a.c6921","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":275,"y":200,"wires":[],"l":false},{"id":"7e49908.1eab7f","type":"delay","z":"da29b66a.c6921","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":475,"y":240,"wires":[["14f4778c.0bebf8"]],"l":false},{"id":"89fe6516.a1bba8","type":"change","z":"da29b66a.c6921","name":"strip","rules":[{"t":"delete","p":"payload.data.brightness","pt":"msg"},{"t":"delete","p":"payload.service","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":240,"wires":[["7e49908.1eab7f"]]},{"id":"c84a90ac.b74868","type":"debug","z":"da29b66a.c6921","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":535,"y":200,"wires":[],"l":false},{"id":"1cab4d82.67f802","type":"delay","z":"a14a13fb.20e7d8","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":135,"y":640,"wires":[["7b52be40.244ce8"]],"l":false},{"id":"7b52be40.244ce8","type":"api-call-service","z":"a14a13fb.20e7d8","name":"off","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_off","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":175,"y":640,"wires":[["80aee210.243088"]],"icon":"font-awesome/fa-toggle-off","l":false},{"id":"6892b42f.ddd094","type":"change","z":"a14a13fb.20e7d8","name":"strip","rules":[{"t":"delete","p":"payload.data.brightness","pt":"msg"},{"t":"delete","p":"payload.service","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":95,"y":640,"wires":[["1cab4d82.67f802"]],"l":false},{"id":"6f2ced54.de7fcc","type":"delay","z":"a14a13fb.20e7d8","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":275,"y":640,"wires":[["5af6cd49.c84034"]],"l":false},{"id":"5af6cd49.c84034","type":"api-call-service","z":"a14a13fb.20e7d8","name":"on","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_on","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":315,"y":640,"wires":[["afb4e23.f2d97a"]],"icon":"font-awesome/fa-toggle-on","l":false},{"id":"80aee210.243088","type":"change","z":"a14a13fb.20e7d8","name":"strip","rules":[{"t":"delete","p":"payload.service","pt":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"128","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":235,"y":640,"wires":[["6f2ced54.de7fcc"]],"l":false},{"id":"2ac9c86d.a6b26","type":"comment","z":"a14a13fb.20e7d8","name":"flash_standard_lights","info":"","x":120,"y":600,"wires":[]},{"id":"60939e23.bf72c8","type":"delay","z":"a14a13fb.20e7d8","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":415,"y":640,"wires":[["ac3e2475.12aee8"]],"l":false},{"id":"ac3e2475.12aee8","type":"api-call-service","z":"a14a13fb.20e7d8","name":"off","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_off","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":455,"y":640,"wires":[["be12a617.1d885"]],"icon":"font-awesome/fa-toggle-off","l":false},{"id":"afb4e23.f2d97a","type":"change","z":"a14a13fb.20e7d8","name":"strip","rules":[{"t":"delete","p":"payload.service","pt":"msg"},{"t":"delete","p":"payload.data.brightness","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":375,"y":640,"wires":[["60939e23.bf72c8"]],"l":false},{"id":"e89d394a.4197e8","type":"delay","z":"a14a13fb.20e7d8","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":555,"y":640,"wires":[["81414d55.ec1018"]],"l":false},{"id":"81414d55.ec1018","type":"api-call-service","z":"a14a13fb.20e7d8","name":"on","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_on","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":595,"y":640,"wires":[["4c698171.1cce8"]],"icon":"font-awesome/fa-toggle-on","l":false},{"id":"be12a617.1d885","type":"change","z":"a14a13fb.20e7d8","name":"strip","rules":[{"t":"delete","p":"payload.service","pt":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"128","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":515,"y":640,"wires":[["e89d394a.4197e8"]],"l":false},{"id":"5d0e3a83.5417d4","type":"delay","z":"a14a13fb.20e7d8","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":695,"y":640,"wires":[["1e4ed646.f8fe72"]],"l":false},{"id":"1e4ed646.f8fe72","type":"api-call-service","z":"a14a13fb.20e7d8","name":"off","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_off","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":735,"y":640,"wires":[["319bf059.30eb2"]],"icon":"font-awesome/fa-toggle-off","l":false},{"id":"4c698171.1cce8","type":"change","z":"a14a13fb.20e7d8","name":"strip","rules":[{"t":"delete","p":"payload.service","pt":"msg"},{"t":"delete","p":"payload.data.brightness","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":655,"y":640,"wires":[["5d0e3a83.5417d4"]],"l":false},{"id":"fc15652c.fb7d2","type":"delay","z":"a14a13fb.20e7d8","name":"1s","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":835,"y":640,"wires":[["58129443.e63f94"]],"l":false},{"id":"58129443.e63f94","type":"api-call-service","z":"a14a13fb.20e7d8","name":"on","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_on","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":875,"y":640,"wires":[[]],"icon":"font-awesome/fa-toggle-on","l":false},{"id":"319bf059.30eb2","type":"change","z":"a14a13fb.20e7d8","name":"strip","rules":[{"t":"delete","p":"payload.service","pt":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"128","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":795,"y":640,"wires":[["fc15652c.fb7d2"]],"l":false},{"id":"b65d90e8.954d38","type":"change","z":"a14a13fb.20e7d8","name":"strip","rules":[{"t":"delete","p":"payload.state","pt":"msg"},{"t":"delete","p":"payload.brightness","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":415,"y":440,"wires":[["e8208645.9b688"]],"l":false},{"id":"e8208645.9b688","type":"api-call-service","z":"a14a13fb.20e7d8","name":"off","server":"71cca0bd.6fe0a","version":1,"service_domain":"light","service":"turn_off","entityId":"light.family_room_table_lamp","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":475,"y":440,"wires":[["f089a4e7.040f"]],"icon":"font-awesome/fa-toggle-off","l":false},{"id":"4f43823c.ce4d9c","type":"change","z":"a14a13fb.20e7d8","name":"strip","rules":[{"t":"delete","p":"payload.state","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":415,"y":400,"wires":[["d686f6f.9855188"]],"l":false},{"id":"f089a4e7.040f","type":"function","z":"a14a13fb.20e7d8","name":"clear_state","func":"var state = {\n    'state': \"off\", \n    'brightness': \"0\"\n}\nflow.set(\"dining_room_table_lamp_state\",state);\n\nmsg.payload = state\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":420,"wires":[[]]},{"id":"d358ab64.a8605","type":"mqtt in","z":"9aecea9b.7bb228","name":"zigbee2mqtt/out","topic":"zigbee2mqtt/bridge/networkmap/graphviz","qos":"2","broker":"c033bd67.6dafe","x":120,"y":140,"wires":[["4fc1847d.b20edc"]]},{"id":"f010b309.128098","type":"http in","z":"9aecea9b.7bb228","name":"","url":"/adminpanelapi/networkmap/graphviz","method":"get","upload":false,"swaggerDoc":"","x":200,"y":200,"wires":[["1130597.c9b89a7"]]},{"id":"ce8a0adf.0d08c8","type":"http response","z":"9aecea9b.7bb228","name":"","x":610,"y":200,"wires":[]},{"id":"1130597.c9b89a7","type":"function","z":"9aecea9b.7bb228","name":"get from flow","func":"var networkmap = flow.get('networkmap');\n\nmsg.payload = networkmap;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":200,"wires":[["ce8a0adf.0d08c8"]]},{"id":"c47cfe6d.effe9","type":"inject","z":"9aecea9b.7bb228","name":"","topic":"","payload":"graphviz","payloadType":"str","repeat":"30","crontab":"","once":true,"onceDelay":0.1,"x":120,"y":80,"wires":[["6183c060.5f69e"]]},{"id":"4fc1847d.b20edc","type":"function","z":"9aecea9b.7bb228","name":"store in flow","func":"flow.set('networkmap',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":140,"wires":[[]]},{"id":"6183c060.5f69e","type":"mqtt out","z":"9aecea9b.7bb228","name":"zigbee2mqtt/in","topic":"zigbee2mqtt/bridge/networkmap","qos":"","retain":"","broker":"af50487a.2e1738","x":280,"y":80,"wires":[]},{"id":"21bb4db2.c41e4a","type":"http in","z":"9aecea9b.7bb228","name":"","url":"/adminpanelapi/networkmap/viz/:engine","method":"get","upload":false,"swaggerDoc":"","x":210,"y":260,"wires":[["5bfb25f5.2068ac"]]},{"id":"d0aba0bf.b0d978","type":"http response","z":"9aecea9b.7bb228","name":"","statusCode":"","headers":{},"x":810,"y":260,"wires":[]},{"id":"b670afd9.ca1408","type":"function","z":"9aecea9b.7bb228","name":"generate viz html","func":"var html = `<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>NetworkMap</title>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js\"></script>\n    <script src='https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.5.0/dist/svg-pan-zoom.min.js'></script>\n    <style>\n    svg {\n      width: 100% !important;\n      height: 100% !important;\n      min-width: 100% !important;\n      min-height: 80% !important;\n    }\n    </style>\n  </head>\n  <body>\n    <div id=\"output\"></div>\n    \n    <script>\n        var graphData = '${(flow.get('networkmap')).replace(/(\\r\\n|\\n|\\r)/gm,\"\")}';\n        var vizOptions = { format: 'svg', engine: '${msg.engine}'}\n        var graph = document.querySelector(\"#output\");\n        var svg = graph.querySelector(\"svg\");\n        if (svg) {\n          graph.removeChild(svg);\n        }        \n\n        var viz = new Viz();\n\n        viz.renderSVGElement(graphData, vizOptions)\n          .then(function(svg) {\n            svg.id = \"svg_output\";\n            graph.appendChild(svg);              \n            \n            panZoom = svgPanZoom(svg, {\n              zoomEnabled: true,\n              controlIconsEnabled: true,\n              contain: true,\n              center: true,\n              minZoom: 0.1\n            });\n\n            svg.addEventListener('paneresize', function(e) {\n              panZoom.resize();\n            }, false);\n            window.addEventListener('resize', function(e) {\n              panZoom.resize();\n            });\n          })\n          .catch(error => {\n            // Create a new Viz instance (@see Caveats page for more info)\n            viz = new Viz();\n  \n            // Possibly display the error\n            console.error(error);\n          });\n    </script>\n  </body>\n</html>\n`\n\nmsg.payload = html;\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":260,"wires":[["d0aba0bf.b0d978"]]},{"id":"5bfb25f5.2068ac","type":"function","z":"9aecea9b.7bb228","name":"set engine","func":"var availableEngines = ['circo', 'dot', 'fdp', 'neato', 'osage', 'twopi']\nif(availableEngines.includes(msg.req.params.engine)) { msg.engine = msg.req.params.engine }\nelse { msg.engine = 'dot' }\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":260,"wires":[["b670afd9.ca1408"]]},{"id":"93d919e8.7ea708","type":"mqtt in","z":"88552b3a.cd1c38","name":"zigbee2mqtt/logging","topic":"zigbee2mqtt/bridge/log","qos":"2","broker":"c033bd67.6dafe","x":290,"y":140,"wires":[["3a1a1c1c.fa2f9c"]]},{"id":"3a1a1c1c.fa2f9c","type":"json","z":"88552b3a.cd1c38","name":"","property":"payload","action":"","pretty":false,"x":450,"y":140,"wires":[["2a130e55.dcffb2","9a13e8c1.93bfe8","569df6f4.110338"]]},{"id":"928251dd.b4c3d8","type":"ui_toast","z":"88552b3a.cd1c38","position":"top right","displayTime":"30","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":950,"y":80,"wires":[]},{"id":"2a130e55.dcffb2","type":"function","z":"88552b3a.cd1c38","name":"Notification","func":"if(msg.payload.type == \"pairing\" && msg.payload.message == \"connecting with device\") {\n\nmsg.payload = (\"A device is attempting to pair...\");\n\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":750,"y":80,"wires":[["928251dd.b4c3d8"]]},{"id":"77175e77.b4f72","type":"comment","z":"88552b3a.cd1c38","name":"Notification","info":"","x":110,"y":140,"wires":[]},{"id":"e87d9710.bc39e8","type":"comment","z":"88552b3a.cd1c38","name":"Pairing","info":"","x":590,"y":80,"wires":[]},{"id":"2d4ebc81.f732dc","type":"ui_toast","z":"88552b3a.cd1c38","position":"top right","displayTime":"10","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":950,"y":200,"wires":[]},{"id":"9a13e8c1.93bfe8","type":"function","z":"88552b3a.cd1c38","name":"Notification","func":"if(msg.payload.type == \"device_connected\") {\n\nmsg.payload = (\"Device paired successfully: \" + msg.payload.message);\n\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":750,"y":200,"wires":[["2d4ebc81.f732dc"]]},{"id":"a2322e22.64113","type":"comment","z":"88552b3a.cd1c38","name":"Paired","info":"","x":590,"y":200,"wires":[]},{"id":"a82b25f7.123598","type":"ui_toast","z":"88552b3a.cd1c38","position":"top right","displayTime":"30","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":1030,"y":140,"wires":[]},{"id":"569df6f4.110338","type":"function","z":"88552b3a.cd1c38","name":"Notification","func":"if(msg.payload.type == \"pairing\" && msg.payload.message == \"device incoming\") {\n\nmsg.payload = (\"A device is incoming or repairing...\");\n\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":830,"y":140,"wires":[["a82b25f7.123598"]]},{"id":"28f23892.0900d","type":"comment","z":"88552b3a.cd1c38","name":"Incoming or Repairing","info":"","x":640,"y":140,"wires":[]},{"id":"d5f5e231.1cc11","type":"mqtt in","z":"cc5eb152.bae948","name":"zigbee2mqtt/out devices","topic":"zigbee2mqtt/bridge/log","qos":"2","broker":"c033bd67.6dafe","x":350,"y":140,"wires":[["d06294d0.a9049"]]},{"id":"b797d555.ea278","type":"ui_template","z":"cc5eb152.bae948","group":"e5f18c9c.735378","name":"","order":0,"width":"12","height":"12","format":"<table>\n<tr>\n    <td><B><U>Name:</U></B></td>\n    <td><B><U>ieeeAddr:</U></B></td>\n    <td><B><U>Model:</U></B></td>\n    <td><B><U>Type:</U></B></td>\n</tr>\n  <tr ng-repeat=\"obj in msg.payload.message\">\n    <td>{{ obj.friendly_name }}</td>\n    <td>{{ obj.ieeeAddr }}</td>\n    <td>{{ obj.model }}</td>\n    <td>{{ obj.type }}</td>\n  </tr>\n\n</table>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":660,"y":140,"wires":[[]]},{"id":"5a6186f4.ed4ae8","type":"mqtt out","z":"cc5eb152.bae948","name":"zigbee2mqtt/in devices","topic":"zigbee2mqtt/bridge/config/devices","qos":"","retain":"","broker":"c033bd67.6dafe","x":580,"y":60,"wires":[]},{"id":"3c6afc66.7021c4","type":"inject","z":"cc5eb152.bae948","name":"Request Device List","topic":"","payload":"","payloadType":"date","repeat":"4","crontab":"","once":true,"onceDelay":0.1,"x":360,"y":60,"wires":[["5a6186f4.ed4ae8"]]},{"id":"9d05e053.0988c8","type":"comment","z":"cc5eb152.bae948","name":"Request Device List","info":"","x":130,"y":60,"wires":[]},{"id":"e7ef5c6e.08c0d","type":"comment","z":"cc5eb152.bae948","name":"Receive Device List","info":"","x":130,"y":140,"wires":[]},{"id":"d06294d0.a9049","type":"json","z":"cc5eb152.bae948","name":"","property":"payload","action":"","pretty":false,"x":530,"y":140,"wires":[["b797d555.ea278","a5d98509.344068","d94534e3.1e426"]]},{"id":"52c510c3.a41538","type":"http in","z":"cc5eb152.bae948","name":"","url":"/adminpanelapi/devicelist","method":"get","upload":false,"swaggerDoc":"","x":530,"y":220,"wires":[["c3f47a5e.14ff58"]]},{"id":"a5d98509.344068","type":"function","z":"cc5eb152.bae948","name":"Store Data","func":"flow.set('devicelist',msg.payload);","outputs":1,"noerr":0,"x":310,"y":220,"wires":[[]]},{"id":"f6f1671b.a5ef1","type":"http response","z":"cc5eb152.bae948","name":"","x":870,"y":220,"wires":[]},{"id":"c3f47a5e.14ff58","type":"function","z":"cc5eb152.bae948","name":"Get Data","func":"var devicelist = flow.get('devicelist');\nmsg.payload = devicelist;\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":220,"wires":[["f6f1671b.a5ef1"]]},{"id":"a949dc3.64ec92","type":"comment","z":"cc5eb152.bae948","name":"HTTP JSON API","info":"","x":120,"y":220,"wires":[]},{"id":"d94534e3.1e426","type":"function","z":"cc5eb152.bae948","name":"Store Globally","func":"global.set('zigbee2mqttdevicelist',msg.payload.message);\nreturn msg;","outputs":1,"noerr":0,"x":890,"y":120,"wires":[[]]},{"id":"f17225e7.9dbce8","type":"mqtt in","z":"f1f40d54.5f1248","name":"zigbee2mqtt/bridge state","topic":"zigbee2mqtt/bridge/state","qos":"2","broker":"c033bd67.6dafe","x":270,"y":80,"wires":[["ab9ba848.0b2b3"]]},{"id":"ab9ba848.0b2b3","type":"function","z":"f1f40d54.5f1248","name":"Format Data","func":"flow.set('bridgestate',msg.payload);\nvar bridgestate = flow.get('bridgestate');\nmsg.payload = bridgestate;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":80,"wires":[["7d13277e.0b486"]]},{"id":"df602664.3e4c88","type":"ui_template","z":"f1f40d54.5f1248","group":"22aa6664.93efb2","name":"","order":0,"width":"6","height":"2","format":"<style>\n    {{msg.style}}\n</style>\n\n<table>\n  <tr>\n    <td>Bridge</td>\n    <td>{{msg.payload.bridgestate}}</td>\n  </tr>\n  <tr>\n    <td>Devices</td>\n    <td>{{msg.payload.numberofdevices}}</td>\n  </tr>\n</table>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":660,"y":140,"wires":[[]]},{"id":"20c1e42b.452db4","type":"function","z":"f1f40d54.5f1248","name":"Format Data","func":"var bridgestate = flow.get('bridgestate');\nvar devicelist = global.get('zigbee2mqttdevicelist');\nmsg.payload = {}\nmsg.payload.bridgestate = bridgestate;\nmsg.payload.numberofdevices = devicelist.length;\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":140,"wires":[["df602664.3e4c88"]]},{"id":"65fe1b3a.93113c","type":"inject","z":"f1f40d54.5f1248","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":true,"onceDelay":0.1,"x":350,"y":140,"wires":[["20c1e42b.452db4"]]},{"id":"7d13277e.0b486","type":"debug","z":"f1f40d54.5f1248","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":610,"y":80,"wires":[]},{"id":"575e40ae.795e18","type":"comment","z":"f1f40d54.5f1248","name":"Get state","info":"","x":80,"y":80,"wires":[]},{"id":"2bf35c43.6207c4","type":"comment","z":"f1f40d54.5f1248","name":"Update Web UI on Interval","info":"","x":130,"y":140,"wires":[]},{"id":"8bcd3b41.c63958","type":"http in","z":"f1f40d54.5f1248","name":"","url":"/adminpanelapi/state","method":"get","upload":false,"swaggerDoc":"","x":270,"y":220,"wires":[["f441fb81.2aba6"]]},{"id":"e361f297.b0d8c8","type":"http response","z":"f1f40d54.5f1248","name":"","x":590,"y":220,"wires":[]},{"id":"f441fb81.2aba6","type":"function","z":"f1f40d54.5f1248","name":"Get Data","func":"var bridgestate = flow.get('bridgestate');\nmsg.payload = bridgestate;\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":220,"wires":[["e361f297.b0d8c8"]]},{"id":"d2c13c57.948e78","type":"comment","z":"f1f40d54.5f1248","name":"HTTP API","info":"","x":80,"y":220,"wires":[]},{"id":"7f2ddb8e.be40ac","type":"ui_dropdown","z":"84c89.e1805b77","name":"","label":"","place":"Select option","group":"758357a2.e967f8","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"Info","value":"info","type":"str"},{"label":"Debug","value":"debug","type":"str"},{"label":"Warn","value":"warn","type":"str"},{"label":"Error","value":"error","type":"str"}],"payload":"","topic":"","x":120,"y":60,"wires":[["608d442c.e81244"]]},{"id":"608d442c.e81244","type":"mqtt out","z":"84c89.e1805b77","name":"zigbee2mqtt/in Logging Level","topic":"zigbee2mqtt/bridge/config/log_level","qos":"","retain":"","broker":"af50487a.2e1738","x":380,"y":60,"wires":[]},{"id":"c62325cb.0ef8b8","type":"ui_text_input","z":"b719d888.34b5","name":"","label":"Device Name","group":"85824c1a.db3278","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":"5","topic":"","x":300,"y":60,"wires":[["1c0cc924.cc5f87"]]},{"id":"3decc5c7.b9fc32","type":"mqtt out","z":"b719d888.34b5","name":"zigbee2mqtt/in Remove","topic":"zigbee2mqtt/bridge/config/remove","qos":"","retain":"","broker":"af50487a.2e1738","x":1190,"y":60,"wires":[]},{"id":"d1f4127d.f26c6","type":"function","z":"b719d888.34b5","name":"Format Data","func":"flow.set('remove',msg.payload.remove);","outputs":1,"noerr":0,"x":650,"y":60,"wires":[[]]},{"id":"1c0cc924.cc5f87","type":"change","z":"b719d888.34b5","name":"change msg old","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.remove","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":60,"wires":[["d1f4127d.f26c6"]]},{"id":"c1bd3fc.fcd5ec","type":"function","z":"b719d888.34b5","name":"Format Data","func":"var remove = flow.get('remove');\nif (typeof remove !== 'undefined' && remove !== null && remove !== \"\"){\nmsg.payload = remove;\n\nreturn msg;\n}","outputs":1,"noerr":0,"x":970,"y":60,"wires":[["3decc5c7.b9fc32"]]},{"id":"5efde380.427af4","type":"ui_button","z":"b719d888.34b5","name":"","group":"85824c1a.db3278","order":5,"width":0,"height":0,"passthru":false,"label":"Remove","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":820,"y":60,"wires":[["c1bd3fc.fcd5ec","d05c948b.bacac8"]]},{"id":"b75a2ed6.74246","type":"comment","z":"b719d888.34b5","name":"Remove Device","info":"","x":120,"y":60,"wires":[]},{"id":"4cb4e2c3.98d39c","type":"mqtt in","z":"b719d888.34b5","name":"zigbee2mqtt/logging","topic":"zigbee2mqtt/bridge/log","qos":"2","broker":"c033bd67.6dafe","x":290,"y":120,"wires":[["e9be07b6.ac669"]]},{"id":"e9be07b6.ac669","type":"json","z":"b719d888.34b5","name":"","property":"payload","action":"","pretty":false,"x":450,"y":120,"wires":[["5e36f348.0257fc"]]},{"id":"6d73c8c6.ffea78","type":"ui_toast","z":"b719d888.34b5","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":790,"y":120,"wires":[]},{"id":"5e36f348.0257fc","type":"function","z":"b719d888.34b5","name":"Notification","func":"if(msg.payload.type == 'device_removed') {\nvar remove = flow.get('remove');\nif (typeof remove !== 'undefined' && remove !== null && remove !== \"\"){\nmsg.payload = (\"Deviced removed: \" + msg.payload.message);\n\n// Reset field\n//remove = \"\";\n//flow.set('remove',msg.payload.message);\n\nreturn msg;\n}\n}\n\n","outputs":1,"noerr":0,"x":590,"y":120,"wires":[["6d73c8c6.ffea78"]]},{"id":"33a337ea.a99fb8","type":"comment","z":"b719d888.34b5","name":"Notification","info":"","x":110,"y":120,"wires":[]},{"id":"120dc2bd.079e1d","type":"ui_toast","z":"b719d888.34b5","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":1210,"y":120,"wires":[]},{"id":"d05c948b.bacac8","type":"function","z":"b719d888.34b5","name":"Notification","func":"var remove = flow.get('remove');\nif (typeof remove === 'undefined' || remove === null || remove === \"\"){\nmsg.payload = \"Enter a device to remove\";\n\nreturn msg;\n}","outputs":1,"noerr":0,"x":1010,"y":120,"wires":[["120dc2bd.079e1d"]]},{"id":"c53dc909.fb6f58","type":"ui_dropdown","z":"7b73f2f9.14c47c","name":"","label":"","place":"Select option","group":"47090788.3f9c68","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"Allow","value":"true","type":"str"},{"label":"Deny","value":"false","type":"str"}],"payload":"","topic":"","x":90,"y":40,"wires":[["e814d6a5.fc619","7e743962.320648"]]},{"id":"e814d6a5.fc619","type":"mqtt out","z":"7b73f2f9.14c47c","name":"zigbee2mqtt/in Join","topic":"zigbee2mqtt/bridge/config/permit_join","qos":"","retain":"","broker":"af50487a.2e1738","x":270,"y":40,"wires":[]},{"id":"113fcf29.45ac41","type":"ui_toast","z":"7b73f2f9.14c47c","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":450,"y":100,"wires":[]},{"id":"7e743962.320648","type":"function","z":"7b73f2f9.14c47c","name":"Notification","func":"if (typeof msg.payload !== 'undefined' && msg.payload !== null && msg.payload !== \"\"){\nif (msg.payload == \"false\"){\n    msg.payload = \"Permit join: Deny\";\n}\nif (msg.payload == \"true\"){\n    msg.payload = \"Permit join: Allow\";\n}\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":250,"y":100,"wires":[["113fcf29.45ac41"]]},{"id":"1449efb.66a101","type":"ui_text_input","z":"ffc576d7.bdba3","name":"","label":"Old Name","group":"aa9d7177.a5ace8","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":"5","topic":"","x":120,"y":140,"wires":[["1e891dc9.d3d84a"]]},{"id":"4ac4a023.593698","type":"ui_text_input","z":"ffc576d7.bdba3","name":"","label":"New Name","group":"aa9d7177.a5ace8","order":4,"width":0,"height":0,"passthru":true,"mode":"text","delay":"5","topic":"","x":130,"y":200,"wires":[["dcb37b9.e65c388"]]},{"id":"c87da057.903b38","type":"mqtt out","z":"ffc576d7.bdba3","name":"zigbee2mqtt/in Rename","topic":"zigbee2mqtt/bridge/config/rename","qos":"","retain":"","broker":"af50487a.2e1738","x":1010,"y":140,"wires":[]},{"id":"fd25eda8.46656","type":"function","z":"ffc576d7.bdba3","name":"Format Data","func":"flow.set('oldname',msg.payload.old);","outputs":1,"noerr":0,"x":470,"y":140,"wires":[[]]},{"id":"1e891dc9.d3d84a","type":"change","z":"ffc576d7.bdba3","name":"change msg old","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.old","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":140,"wires":[["fd25eda8.46656"]]},{"id":"dcb37b9.e65c388","type":"change","z":"ffc576d7.bdba3","name":"change msg new","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.new","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":200,"wires":[["24666ba.be22e14"]]},{"id":"ec897b42.5b9e58","type":"function","z":"ffc576d7.bdba3","name":"Format Data","func":"var oldname = flow.get('oldname');\nvar newname = flow.get('newname');\n\nif (typeof oldname !== 'undefined' && oldname !== null && oldname !== \"\" && typeof newname !== 'undefined' && newname !== null && newname !== \"\"){\nmsg.payload = {\"old\": oldname, \"new\": newname}\n\n// Reset fields\noldname = \"\";\nnewname = \"\";\nflow.set('oldname',msg.payload.old);\nflow.set('newname',msg.payload.new);\n\nreturn msg;\n}","outputs":1,"noerr":0,"x":790,"y":140,"wires":[["c87da057.903b38"]]},{"id":"24666ba.be22e14","type":"function","z":"ffc576d7.bdba3","name":"Format Data","func":"flow.set('newname',msg.payload.new);","outputs":1,"noerr":0,"x":490,"y":200,"wires":[[]]},{"id":"c4321555.5cfdc","type":"ui_button","z":"ffc576d7.bdba3","name":"","group":"aa9d7177.a5ace8","order":5,"width":0,"height":0,"passthru":false,"label":"Rename","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":640,"y":140,"wires":[["ec897b42.5b9e58","bd639ad1.ea854"]]},{"id":"a1164de9.9ec1e8","type":"ui_toast","z":"ffc576d7.bdba3","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":850,"y":200,"wires":[]},{"id":"bd639ad1.ea854","type":"function","z":"ffc576d7.bdba3","name":"Notification","func":"var oldname = flow.get('oldname');\nvar newname = flow.get('newname');\n\nif (typeof oldname !== 'undefined' && oldname !== null && oldname !== \"\" && typeof newname !== 'undefined' && newname !== null && newname !== \"\"){\nmsg.payload = (\"Rename Device: \" + oldname + \" to \" + newname);\nreturn msg;\n} else {\nmsg.payload = \"Enter device to rename\";\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":670,"y":200,"wires":[["a1164de9.9ec1e8"]]},{"id":"6cba577.040f1a8","type":"subflow:ffc576d7.bdba3","z":"802c46.337debb8","name":"","x":120,"y":120,"wires":[]},{"id":"343f6d35.40cff2","type":"subflow:7b73f2f9.14c47c","z":"802c46.337debb8","name":"","x":100,"y":80,"wires":[]},{"id":"eb58e9ee.59ebf","type":"subflow:b719d888.34b5","z":"802c46.337debb8","name":"","x":120,"y":160,"wires":[]},{"id":"15b60356.9bc0e5","type":"comment","z":"802c46.337debb8","name":"Function","info":"","x":100,"y":40,"wires":[]},{"id":"78ab87.3d8a4478","type":"subflow:84c89.e1805b77","z":"802c46.337debb8","name":"","x":110,"y":200,"wires":[]},{"id":"4027821f.ce102c","type":"subflow:f1f40d54.5f1248","z":"802c46.337debb8","name":"","x":90,"y":240,"wires":[]},{"id":"fb6add54.0d2ea8","type":"subflow:cc5eb152.bae948","z":"802c46.337debb8","name":"","x":90,"y":280,"wires":[]},{"id":"aa62bcdb.e233d8","type":"comment","z":"802c46.337debb8","name":"Other","info":"","x":350,"y":40,"wires":[]},{"id":"9da0ebbe.26398","type":"subflow:88552b3a.cd1c38","z":"802c46.337debb8","name":"","x":390,"y":80,"wires":[]},{"id":"364936ee.25642a","type":"subflow:9aecea9b.7bb228","z":"802c46.337debb8","name":"","env":[],"x":370,"y":140,"wires":[]},{"id":"122c7241.d9eaae","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":1,"width":1,"height":1,"passthru":false,"label":"1","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"","x":850,"y":60,"wires":[["3298641.a8fac9c"]]},{"id":"29847b64.a86bd4","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":2,"width":1,"height":1,"passthru":false,"label":"2","tooltip":"","color":"","bgcolor":"","icon":"","payload":"2","payloadType":"str","topic":"","x":850,"y":100,"wires":[["3298641.a8fac9c"]]},{"id":"85ad15af.ba9d18","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":3,"width":1,"height":1,"passthru":false,"label":"3","tooltip":"","color":"","bgcolor":"","icon":"","payload":"3","payloadType":"str","topic":"","x":850,"y":140,"wires":[["3298641.a8fac9c"]]},{"id":"e52295b.7df89e8","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":4,"width":1,"height":1,"passthru":false,"label":"4","tooltip":"","color":"","bgcolor":"","icon":"","payload":"4","payloadType":"str","topic":"","x":850,"y":180,"wires":[["3298641.a8fac9c"]]},{"id":"9c5e54b7.03d7f8","type":"server-state-changed","z":"effe3391.1f5438","name":"effect","server":"36e34f8c.02bee","version":1,"entityidfilter":"input_select.effect_list","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":50,"y":400,"wires":[["bdaaa3aa.442008"]]},{"id":"2006f541.71c8ca","type":"mqtt out","z":"effe3391.1f5438","name":"","topic":"wled/all/api","qos":"0","retain":"","broker":"b5a5da99.d05b48","x":430,"y":120,"wires":[]},{"id":"6d4572c9.20442c","type":"server-state-changed","z":"effe3391.1f5438","name":"speed","server":"36e34f8c.02bee","version":1,"entityidfilter":"input_number.ledspeed","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":50,"y":100,"wires":[["ed45753a.b2c27","9008cb93.d950e"]]},{"id":"ed45753a.b2c27","type":"template","z":"effe3391.1f5438","name":"Speed","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SX={{payload}}","output":"str","x":230,"y":100,"wires":[["2006f541.71c8ca"]]},{"id":"da1de62f.aefae8","type":"server-state-changed","z":"effe3391.1f5438","name":"intensity","server":"36e34f8c.02bee","version":1,"entityidfilter":"input_number.ledintensity","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":60,"y":160,"wires":[["4292ab63.b7752c","2078fa66.f52a56"]]},{"id":"4292ab63.b7752c","type":"template","z":"effe3391.1f5438","name":"Intensity","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"IX={{payload}}","output":"str","x":240,"y":160,"wires":[["2006f541.71c8ca"]]},{"id":"15d73d9d.f1df8a","type":"template","z":"effe3391.1f5438","name":"palette","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"FP={{payload}}","output":"str","x":390,"y":320,"wires":[["bbed3aaf.b18ac8"]]},{"id":"3298641.a8fac9c","type":"template","z":"effe3391.1f5438","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL={{payload}}","output":"str","x":1010,"y":280,"wires":[["f5c7ce26.cadd3"]]},{"id":"bdaaa3aa.442008","type":"function","z":"effe3391.1f5438","name":"Parse EffectList","func":"var str = msg.payload;\nmsg.payload = str[0].split(\" \");\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":400,"wires":[["5e542aa8.fe8314"]]},{"id":"5e542aa8.fe8314","type":"template","z":"effe3391.1f5438","name":"effect","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"FX={{payload}}","output":"str","x":390,"y":400,"wires":[["bbed3aaf.b18ac8"]]},{"id":"32503c8e.5e8bd4","type":"server-state-changed","z":"effe3391.1f5438","name":"pallette","server":"36e34f8c.02bee","version":1,"entityidfilter":"input_select.palette_list","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":50,"y":320,"wires":[["c06efa72.ab2ea"]]},{"id":"c06efa72.ab2ea","type":"function","z":"effe3391.1f5438","name":"Parse pallette list","func":"var str = msg.payload;\nmsg.payload = str[0].split(\" \");\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":320,"wires":[["15d73d9d.f1df8a"]]},{"id":"88fa6edf.d5ab5","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":5,"width":1,"height":1,"passthru":false,"label":"5","tooltip":"","color":"","bgcolor":"","icon":"","payload":"5","payloadType":"str","topic":"","x":850,"y":220,"wires":[["3298641.a8fac9c"]]},{"id":"b386ca9d.03e58","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":6,"width":1,"height":1,"passthru":false,"label":"6","tooltip":"","color":"","bgcolor":"","icon":"","payload":"6","payloadType":"str","topic":"","x":850,"y":260,"wires":[["3298641.a8fac9c"]]},{"id":"7911fb34.772c84","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":7,"width":1,"height":1,"passthru":false,"label":"7","tooltip":"","color":"","bgcolor":"","icon":"","payload":"7","payloadType":"str","topic":"","x":850,"y":300,"wires":[["3298641.a8fac9c"]]},{"id":"94df3b52.a2557","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":8,"width":1,"height":1,"passthru":false,"label":"8","tooltip":"","color":"","bgcolor":"","icon":"","payload":"8","payloadType":"str","topic":"","x":850,"y":340,"wires":[["3298641.a8fac9c"]]},{"id":"e6f70b61.91b8c8","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":9,"width":1,"height":1,"passthru":false,"label":"9","tooltip":"","color":"","bgcolor":"","icon":"","payload":"9","payloadType":"str","topic":"","x":850,"y":380,"wires":[["3298641.a8fac9c"]]},{"id":"b895f4c7.923798","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":10,"width":1,"height":1,"passthru":false,"label":"10","tooltip":"","color":"","bgcolor":"","icon":"","payload":"10","payloadType":"str","topic":"","x":850,"y":420,"wires":[["3298641.a8fac9c"]]},{"id":"a24dcbeb.28db28","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":11,"width":1,"height":1,"passthru":false,"label":"11","tooltip":"","color":"","bgcolor":"","icon":"","payload":"11","payloadType":"str","topic":"","x":850,"y":460,"wires":[["3298641.a8fac9c"]]},{"id":"44439755.c013b","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":12,"width":1,"height":1,"passthru":false,"label":"12","tooltip":"","color":"","bgcolor":"","icon":"","payload":"12","payloadType":"str","topic":"","x":850,"y":500,"wires":[["3298641.a8fac9c"]]},{"id":"b5b023b6.971558","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":13,"width":1,"height":1,"passthru":false,"label":"13","tooltip":"","color":"","bgcolor":"","icon":"","payload":"13","payloadType":"str","topic":"","x":850,"y":540,"wires":[["3298641.a8fac9c"]]},{"id":"5a62bb8d.902c6c","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":14,"width":1,"height":1,"passthru":false,"label":"14","tooltip":"","color":"","bgcolor":"","icon":"","payload":"14","payloadType":"str","topic":"","x":850,"y":580,"wires":[["3298641.a8fac9c"]]},{"id":"9c8f61ad.24eda","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":15,"width":1,"height":1,"passthru":false,"label":"15","tooltip":"","color":"","bgcolor":"","icon":"","payload":"15","payloadType":"str","topic":"","x":850,"y":620,"wires":[["3298641.a8fac9c"]]},{"id":"7884bf80.05a9","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":16,"width":1,"height":1,"passthru":false,"label":"16","tooltip":"","color":"","bgcolor":"","icon":"","payload":"16","payloadType":"str","topic":"","x":850,"y":660,"wires":[["3298641.a8fac9c"]]},{"id":"9008cb93.d950e","type":"ui_slider","z":"effe3391.1f5438","name":"","label":"Speed","tooltip":"","group":"b32c84f8.f27068","order":3,"width":0,"height":0,"passthru":true,"outs":"end","topic":"","min":0,"max":"255","step":1,"x":230,"y":60,"wires":[["ed45753a.b2c27"]]},{"id":"752cdac1.db297c","type":"server-state-changed","z":"effe3391.1f5438","name":"brightness","server":"36e34f8c.02bee","version":1,"entityidfilter":"input_select.ledpaletttelist","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":280,"y":900,"wires":[["bd57eda1.b2fd68"]]},{"id":"aa637817.a7b2a8","type":"mqtt in","z":"effe3391.1f5438","name":"","topic":"wled/all/v","qos":"2","datatype":"auto","broker":"b5a5da99.d05b48","x":60,"y":1240,"wires":[["6293691e.f82ee","aff64e69.15d69"]]},{"id":"6293691e.f82ee","type":"xml","z":"effe3391.1f5438","name":"","property":"payload","attr":"","chr":"","x":290,"y":1240,"wires":[["d8ac1fa3.2a2db8","1eeb1775.5810e9","e1ff815e.a32a58","a841e447.7cb37","a8c3abd3.e5e948","96ed0226.ce84e","af2cd986.97954","bd684e72.f42b98","4480d46c.8c9884","b987e302.39968","c78750e3.5be2c8","8d1d2520.c8a808","558ba440.90fa44","7e7b986c.74854","a861fb38.b2dde8"]]},{"id":"d8ac1fa3.2a2db8","type":"change","z":"effe3391.1f5438","name":"Speed","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.vs.sx[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":980,"wires":[["26906675.8981c2"]]},{"id":"1eeb1775.5810e9","type":"change","z":"effe3391.1f5438","name":"Intensity","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.vs.ix[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":1040,"wires":[["efaadb16.581e4"]]},{"id":"26906675.8981c2","type":"api-call-service","z":"effe3391.1f5438","name":"speed","server":"36e34f8c.02bee","version":1,"service_domain":"input_number","service":"set_value","entityId":"input_number.ledspeed","data":"{\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":650,"y":980,"wires":[[]]},{"id":"efaadb16.581e4","type":"api-call-service","z":"effe3391.1f5438","name":"intensity","server":"36e34f8c.02bee","version":1,"service_domain":"input_number","service":"set_value","entityId":"input_number.ledintensity","data":"{\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":660,"y":1040,"wires":[[]]},{"id":"2078fa66.f52a56","type":"ui_slider","z":"effe3391.1f5438","name":"","label":"Intensity","tooltip":"","group":"b32c84f8.f27068","order":4,"width":0,"height":0,"passthru":true,"outs":"end","topic":"","min":0,"max":"255","step":1,"x":240,"y":200,"wires":[["4292ab63.b7752c"]]},{"id":"bd57eda1.b2fd68","type":"ui_slider","z":"effe3391.1f5438","name":"","label":"brightness","tooltip":"","group":"b32c84f8.f27068","order":5,"width":0,"height":0,"passthru":true,"outs":"end","topic":"","min":0,"max":10,"step":1,"x":470,"y":900,"wires":[[]]},{"id":"59e903c8.bed354","type":"ui_colour_picker","z":"effe3391.1f5438","name":"","label":"Primary Color","group":"40a83076.892118","format":"hex","outformat":"string","showSwatch":true,"showPicker":true,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":false,"square":"false","dynOutput":"false","order":1,"width":0,"height":0,"passthru":true,"topic":"","x":140,"y":800,"wires":[["eed634b9.abbe18"]]},{"id":"aba32249.995dd8","type":"ui_dropdown","z":"effe3391.1f5438","name":"","label":"Effect","tooltip":"Choose the Color/Animation Effect","place":"Solid","group":"b32c84f8.f27068","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"Solid","value":0,"type":"num"},{"label":"Blink","value":1,"type":"num"},{"label":"Breathe","value":2,"type":"num"},{"label":"Wipe","value":3,"type":"num"},{"label":"Wipe Random","value":4,"type":"num"},{"label":"Random Colors","value":5,"type":"num"},{"label":"Sweep","value":6,"type":"num"},{"label":"Dynamic","value":7,"type":"num"},{"label":"Colorloop","value":8,"type":"num"},{"label":"Rainbow","value":9,"type":"num"},{"label":"Scan","value":10,"type":"num"},{"label":"Dual Scan","value":11,"type":"num"},{"label":"Fade","value":12,"type":"num"},{"label":"Chase","value":13,"type":"num"},{"label":"Chase Rainbow","value":14,"type":"num"},{"label":"Running","value":15,"type":"num"},{"label":"Saw","value":16,"type":"num"},{"label":"Twinkle","value":17,"type":"num"},{"label":"Dissolve","value":18,"type":"num"},{"label":"Dissolve Rnd","value":19,"type":"num"},{"label":"Sparkle","value":20,"type":"num"},{"label":"Dark Sparkle","value":21,"type":"num"},{"label":"Sparkle+","value":22,"type":"num"},{"label":"Strobe","value":23,"type":"num"},{"label":"Strobe Rainbow","value":24,"type":"num"},{"label":"Mega Strobe","value":25,"type":"num"},{"label":"Blink Rainbow","value":26,"type":"num"},{"label":"Android","value":27,"type":"num"},{"label":"Chase","value":28,"type":"num"},{"label":"Chase Random","value":29,"type":"num"},{"label":"Chase Rainbow","value":30,"type":"num"},{"label":"Chase Flash","value":31,"type":"num"},{"label":"Chase Flash Rnd","value":32,"type":"num"},{"label":"Rainbow Runner","value":33,"type":"num"},{"label":"Colorful","value":34,"type":"num"},{"label":"Traffic Light","value":35,"type":"num"},{"label":"Sweep Random","value":36,"type":"num"},{"label":"Running 2","value":37,"type":"num"},{"label":"Red & Blue","value":38,"type":"num"},{"label":"Stream","value":39,"type":"num"},{"label":"Scanner","value":40,"type":"num"},{"label":"Lighthouse","value":41,"type":"num"},{"label":"Fireworks","value":42,"type":"num"},{"label":"Rain","value":43,"type":"num"},{"label":"MerryChristmas","value":44,"type":"num"},{"label":"Fire Flicker","value":45,"type":"num"},{"label":"Gradient","value":46,"type":"num"},{"label":"Loading","value":47,"type":"num"},{"label":"In Out","value":48,"type":"num"},{"label":"In In","value":49,"type":"num"},{"label":"Out Out","value":50,"type":"num"},{"label":"Out In","value":51,"type":"num"},{"label":"Circus","value":52,"type":"num"},{"label":"Halloween","value":53,"type":"num"},{"label":"Tri Chase","value":54,"type":"num"},{"label":"Tri Wipe","value":55,"type":"num"},{"label":"TriFade","value":56,"type":"num"},{"label":"Lightning","value":57,"type":"num"},{"label":"ICU","value":58,"type":"num"},{"label":"Multi Comet","value":59,"type":"num"},{"label":"Dual Scanner","value":60,"type":"num"},{"label":"Stream 2","value":61,"type":"num"},{"label":"Oscillate","value":62,"type":"num"},{"label":"Pride 2015","value":63,"type":"num"},{"label":"Juggle","value":64,"type":"num"},{"label":"Palette","value":65,"type":"num"},{"label":"Fire 2012","value":66,"type":"num"},{"label":"Color waves","value":67,"type":"num"},{"label":"BPM","value":68,"type":"num"},{"label":"Fill Noise","value":69,"type":"num"},{"label":"Noise 1","value":70,"type":"num"},{"label":"Noise 2","value":71,"type":"num"},{"label":"Noise 3","value":72,"type":"num"},{"label":"Noise 4","value":73,"type":"num"},{"label":"Colortwinkle","value":74,"type":"num"},{"label":"Lake","value":75,"type":"num"},{"label":"Meteor","value":76,"type":"num"},{"label":"SmoothMeteor","value":77,"type":"num"},{"label":"Railway","value":78,"type":"num"},{"label":"Ripple","value":79,"type":"num"},{"label":" Twinklefox","value":80,"type":"num"}],"payload":"","topic":"","x":390,"y":440,"wires":[["5e542aa8.fe8314"]]},{"id":"adebdd87.dc2628","type":"ui_dropdown","z":"effe3391.1f5438","name":"","label":"Pallette","tooltip":"Choose the Color Palette","place":"Default","group":"b32c84f8.f27068","order":2,"width":0,"height":0,"passthru":true,"options":[{"label":"Default","value":0,"type":"num"},{"label":"Random Cycle","value":1,"type":"num"},{"label":"Primary color","value":2,"type":"num"},{"label":"Based on primary","value":3,"type":"num"},{"label":"Set colors","value":4,"type":"num"},{"label":"Based on set","value":5,"type":"num"},{"label":"Party","value":6,"type":"num"},{"label":"Cloud","value":7,"type":"num"},{"label":"Lava","value":8,"type":"num"},{"label":"Ocean","value":9,"type":"num"},{"label":"Forest","value":10,"type":"num"},{"label":"Rainbow","value":11,"type":"num"},{"label":"Rainbow bands","value":12,"type":"num"},{"label":"Sunset","value":13,"type":"num"},{"label":"Rivendell","value":14,"type":"num"},{"label":"Breeze","value":15,"type":"num"},{"label":"Red & Blue","value":16,"type":"num"},{"label":"Yellowout","value":17,"type":"num"},{"label":"Analoguous","value":18,"type":"num"},{"label":"Splash","value":19,"type":"num"},{"label":"Pastel","value":20,"type":"num"},{"label":"Sunset 2","value":21,"type":"num"},{"label":"Beech","value":22,"type":"num"},{"label":"Vintage","value":23,"type":"num"},{"label":"Departure","value":24,"type":"num"},{"label":"Landscape","value":25,"type":"num"},{"label":"Beach","value":26,"type":"num"},{"label":"Sherbet","value":27,"type":"num"},{"label":"Hult","value":28,"type":"num"},{"label":"Hult 64","value":29,"type":"num"},{"label":"Drywet","value":30,"type":"num"},{"label":"Jul","value":31,"type":"num"},{"label":"Grintage","value":32,"type":"num"},{"label":"Rewhi","value":33,"type":"num"},{"label":"Tertiary","value":34,"type":"num"},{"label":"Fire","value":35,"type":"num"},{"label":"Icefire","value":36,"type":"num"},{"label":"Cyane","value":37,"type":"num"},{"label":"Light Pink","value":38,"type":"num"},{"label":"Autumn","value":39,"type":"num"},{"label":"Magenta","value":40,"type":"num"},{"label":"Magred","value":41,"type":"num"},{"label":"Yelmag","value":42,"type":"num"},{"label":"Yelblu","value":43,"type":"num"},{"label":"Orange & Teal","value":44,"type":"num"},{"label":"Tiamat","value":45,"type":"num"},{"label":"April Night","value":46,"type":"num"}],"payload":"","topic":"","x":400,"y":360,"wires":[["15d73d9d.f1df8a"]]},{"id":"c583b443.d8dfe","type":"ui_colour_picker","z":"effe3391.1f5438","name":"","label":"Secondary Color","group":"40a83076.892118","format":"hex","outformat":"string","showSwatch":true,"showPicker":true,"showValue":true,"showHue":true,"showAlpha":false,"showLightness":false,"square":"false","dynOutput":"false","order":2,"width":0,"height":0,"passthru":true,"topic":"","x":130,"y":840,"wires":[["c113f9ed.a8da48"]]},{"id":"c25c59e2.473128","type":"mqtt out","z":"effe3391.1f5438","name":"","topic":"wled/all/api","qos":"1","retain":"false","broker":"b5a5da99.d05b48","x":530,"y":600,"wires":[]},{"id":"721f93b5.6b69ec","type":"inject","z":"effe3391.1f5438","name":"POWER ON","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":540,"wires":[["542b68b8.515e6"]]},{"id":"bc632566.3a17","type":"inject","z":"effe3391.1f5438","name":"POWER OFF","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":580,"wires":[["542b68b8.515e6"]]},{"id":"bd6c8957.6e7808","type":"ui_button","z":"effe3391.1f5438","name":"Power","group":"aa33085.6e462f8","order":1,"width":"6","height":"1","passthru":false,"label":"Power not working","tooltip":"","color":"{{msg.color}}","bgcolor":"{{msg.background}}","icon":"","payload":"{\"data\":{\"entity_id\": \"light.wled_light\"},\"service\":\"toggle\"}","payloadType":"str","topic":"","x":590,"y":540,"wires":[["5b725dea.f7869c"]]},{"id":"542b68b8.515e6","type":"change","z":"effe3391.1f5438","name":"Change","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"win&T=0","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"win&T=1","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"2","fromt":"num","to":"win&T=2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":600,"wires":[["c25c59e2.473128"]]},{"id":"4cb0fbcd.06072c","type":"inject","z":"effe3391.1f5438","name":"POWER TOGGLE","topic":"","payload":"2","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":620,"wires":[["542b68b8.515e6"]]},{"id":"eed634b9.abbe18","type":"function","z":"effe3391.1f5438","name":"Primary","func":"var str = msg.payload;\nmsg.payload = \"win&CL=#\"+str\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":800,"wires":[["fd5ca117.c2aa38"]]},{"id":"c113f9ed.a8da48","type":"function","z":"effe3391.1f5438","name":"secondary","func":"var str = msg.payload;\nmsg.payload = \"win&C2=#\"+str\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":840,"wires":[["fd5ca117.c2aa38"]]},{"id":"f47c367f.e34bf8","type":"comment","z":"effe3391.1f5438","name":"Colors Primary and Secondary","info":"","x":130,"y":760,"wires":[]},{"id":"fd5ca117.c2aa38","type":"mqtt out","z":"effe3391.1f5438","name":"","topic":"wled/all/api","qos":"1","retain":"false","broker":"b5a5da99.d05b48","x":510,"y":800,"wires":[]},{"id":"489ecef9.c20928","type":"comment","z":"effe3391.1f5438","name":"Power Toggle","info":"","x":70,"y":500,"wires":[]},{"id":"bf4401ff.a355f","type":"comment","z":"effe3391.1f5438","name":"Presets","info":"","x":850,"y":20,"wires":[]},{"id":"bbed3aaf.b18ac8","type":"mqtt out","z":"effe3391.1f5438","name":"","topic":"wled/all/api","qos":"0","retain":"","broker":"b5a5da99.d05b48","x":610,"y":340,"wires":[]},{"id":"f5c7ce26.cadd3","type":"mqtt out","z":"effe3391.1f5438","name":"","topic":"wled/all/api","qos":"0","retain":"","broker":"b5a5da99.d05b48","x":1050,"y":360,"wires":[]},{"id":"4a8d1fec.d8279","type":"comment","z":"effe3391.1f5438","name":"Speed and Intensity","info":"","x":90,"y":20,"wires":[]},{"id":"430c45ef.820be4","type":"comment","z":"effe3391.1f5438","name":"Palette and Effect Settings","info":"","x":110,"y":280,"wires":[]},{"id":"e1ff815e.a32a58","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":11,"width":0,"height":0,"name":"","label":"Effect speed","format":"{{payload.vs.sx[0]}}","layout":"row-spread","x":490,"y":1480,"wires":[]},{"id":"a841e447.7cb37","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":12,"width":0,"height":0,"name":"","label":"Effect intensity","format":"{{payload.vs.ix[0]}}","layout":"row-spread","x":500,"y":1520,"wires":[]},{"id":"a8c3abd3.e5e948","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":1,"width":0,"height":0,"name":"","label":"Master Brightness","format":"{{payload.vs.ac[0]}}","layout":"row-spread","x":510,"y":1080,"wires":[]},{"id":"96ed0226.ce84e","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":2,"width":0,"height":0,"name":"","label":"Primary Color RGB","format":"{{payload.vs.cl[0]}},{{payload.vs.cl[1]}},{{payload.vs.cl[2]}}","layout":"row-spread","x":510,"y":1120,"wires":[]},{"id":"af2cd986.97954","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":3,"width":0,"height":0,"name":"","label":"Secondary Color RGB","format":"{{payload.vs.cs[0]}},{{payload.vs.cs[1]}},{{payload.vs.cs[2]}}","layout":"row-spread","x":520,"y":1160,"wires":[]},{"id":"bd684e72.f42b98","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":4,"width":0,"height":0,"name":"","label":"Nightlight active","format":"{{payload.vs.nl[0]}}","layout":"row-spread","x":500,"y":1200,"wires":[]},{"id":"4480d46c.8c9884","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":5,"width":0,"height":0,"name":"","label":"Nightlight Fade on","format":"{{payload.vs.nf[0]}}","layout":"row-spread","x":510,"y":1240,"wires":[]},{"id":"b987e302.39968","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":6,"width":0,"height":0,"name":"","label":"Nightlight delay","format":"{{payload.vs.nd[0]}}","layout":"row-spread","x":500,"y":1280,"wires":[]},{"id":"c78750e3.5be2c8","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":9,"width":0,"height":0,"name":"","label":"Effect index","format":"{{payload.vs.fx[0]}}","layout":"row-spread","x":490,"y":1320,"wires":[]},{"id":"8d1d2520.c8a808","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":10,"width":0,"height":0,"name":"","label":"Palette Index","format":"{{payload.vs.fp[0]}}","layout":"row-spread","x":490,"y":1360,"wires":[]},{"id":"558ba440.90fa44","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":13,"width":0,"height":0,"name":"","label":"Server description","format":"{{payload.vs.ds[0]}}","layout":"row-spread","x":510,"y":1560,"wires":[]},{"id":"65a8d3b5.35ec44","type":"comment","z":"effe3391.1f5438","name":"Info Screen","info":"","x":90,"y":1180,"wires":[]},{"id":"7e7b986c.74854","type":"function","z":"effe3391.1f5438","name":"","func":"var message = msg.payload\nvar effects = [\"Solid\", \"Blink\", \"Breathe\", \"Wipe\", \"Wipe Random\", \"Random Colors\", \"Sweep\", \"Dynamic\", \"Colorloop\", \"Rainbow\",\"Scan\", \"Dual Scan\", \"Fade\", \"Chase\", \"Chase Rainbow\", \"Running\", \"Saw\", \"Twinkle\", \"Dissolve\", \"Dissolve Rnd\",\"Sparkle\", \"Dark Sparkle\", \"Sparkle+\", \"Strobe\", \"Strobe Rainbow\", \"Mega Strobe\", \"Blink Rainbow\", \"Android\", \"Chase\", \"Chase Random\",\"Chase Rainbow\", \"Chase Flash\", \"Chase Flash Rnd\", \"Rainbow Runner\", \"Colorful\", \"Traffic Light\", \"Sweep Random\", \"Running 2\", \"Red & Blue\", \"Stream\",    \"Scanner\", \"Lighthouse\", \"Fireworks\", \"Rain\", \"Merry Christmas\", \"Fire Flicker\", \"Gradient\", \"Loading\", \"In Out\", \"In In\",    \"Out Out\", \"Out In\", \"Circus\", \"Halloween\", \"Tri Chase\", \"Tri Wipe\", \"Tri Fade\", \"Lightning\", \"ICU\", \"Multi Comet\",    \"Dual Scanner\", \"Stream 2\", \"Oscillate\", \"Pride 2015\", \"Juggle\", \"Palette\", \"Fire 2012\", \"Colorwaves\", \"BPM\", \"Fill Noise\", \"Noise 1\",    \"Noise 2\", \"Noise 3\", \"Noise 4\", \"Colortwinkle\", \"Lake\", \"Meteor\", \"Smooth Meteor\", \"Railway\", \"Ripple\"]\nmsg.payload = effects[message.vs.fx[0]]\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1360,"wires":[["fdb99bfa.47df1"]]},{"id":"fdb99bfa.47df1","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":7,"width":0,"height":0,"name":"","label":"Effect Name","format":"{{payload}}","layout":"row-spread","x":490,"y":1400,"wires":[]},{"id":"a861fb38.b2dde8","type":"function","z":"effe3391.1f5438","name":"","func":"var message = msg.payload\nvar palette=[\"Default\", \"Random Cycle\", \"Primary Color\", \"Based on Primary\", \"Set Colors\", \"Based on Set\", \"Party\", \"Cloud\", \"Lava\", \"Ocean\",\"Forest\", \"Rainbow\", \"Rainbow Bands\", \"Sunset\", \"Rivendell\", \"Breeze\", \"Red & Blue\", \"Yellowout\", \"Analogous\", \"Splash\",\"Pastel\", \"Sunset 2\", \"Beech\", \"Vintage\", \"Departure\", \"Landscape\", \"Beach\", \"Sherbet\", \"Hult\", \"Hult 64\",\"Drywet\", \"Jul\", \"Grintage\", \"Rewhi\", \"Tertiary\", \"Fire\", \"Icefire\", \"Cyane\", \"Light Pink\", \"Autumn\",\"Magenta\", \"Magred\", \"Yelmag\", \"Yelblu\", \"Orange & Teal\", \"Tiamat\", \"April Night\"]\nmsg.payload = palette[message.vs.fp[0]]\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1400,"wires":[["b77bad2b.15ea1"]]},{"id":"b77bad2b.15ea1","type":"ui_text","z":"effe3391.1f5438","group":"f4b4a6be.c69f38","order":8,"width":0,"height":0,"name":"","label":"Palette Name","format":"{{payload}}","layout":"row-spread","x":500,"y":1440,"wires":[]},{"id":"aff64e69.15d69","type":"debug","z":"effe3391.1f5438","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":150,"y":1320,"wires":[]},{"id":"81a0ebec.f92d9","type":"inject","z":"effe3391.1f5438","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":430,"y":20,"wires":[["4f93625e.41532c"]]},{"id":"4f93625e.41532c","type":"function","z":"effe3391.1f5438","name":"Variables","func":"var wledname = \"wled/holidaylights/api\"\nflow.set(\"wledname\", wledname);\n\n//Button ON Colors\nvar ON_foreground = \"black\";\nvar ON_Background = \"lime\";\n\n//Button OFF Colors\nvar OFF_foreground = \"white\";\nvar OFF_Background = \"grey\";\n//--------------------------------------------\nflow.set(\"ON_foreground\", ON_foreground);\nflow.set(\"OFF_foreground\", OFF_foreground);\nflow.set(\"ON_Background\", ON_Background);\nflow.set(\"OFF_Background\", OFF_Background);\nreturn msg;\n\n\n\n","outputs":1,"noerr":0,"x":600,"y":20,"wires":[[]]},{"id":"dbe27fb.a118a8","type":"poll-state","z":"effe3391.1f5438","name":"wled_light","server":"36e34f8c.02bee","version":1,"updateinterval":"10","updateIntervalUnits":"seconds","outputinitially":true,"outputonchanged":true,"entity_id":"light.wled_light","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":280,"y":540,"wires":[["b3b4b55b.06fe4"]]},{"id":"b3b4b55b.06fe4","type":"function","z":"effe3391.1f5438","name":"Set Button Color","func":"//Button Text\nvar entity = \"wled_light\";\n\nON_foreground =  flow.get(\"ON_foreground\");\nON_Background =  flow.get(\"ON_Background\");\nOFF_foreground = flow.get(\"OFF_foreground\");\nOFF_Background = flow.get(\"OFF_Background\");\n\nmsg.topic = (msg.payload === \"on\")?entity + \" On\":entity + \" Off\";\nmsg.color = (msg.payload === \"on\")?ON_foreground:OFF_foreground;\nmsg.background = (msg.payload === \"on\")?ON_Background:OFF_Background;\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":540,"wires":[["bd6c8957.6e7808"]]},{"id":"5b725dea.f7869c","type":"api-call-service","z":"effe3391.1f5438","name":"Entity","server":"36e34f8c.02bee","version":1,"service_domain":"homeassistant","service":"{ }","entityId":"{}","data":"{ }","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":710,"y":540,"wires":[[]]},{"id":"fc19f45b.199f38","type":"ui_button","z":"effe3391.1f5438","name":"","group":"cf0b0799.ae4248","order":17,"width":"3","height":"1","passthru":false,"label":"save preset","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":1110,"y":480,"wires":[["b333930a.e1a058"]]},{"id":"acabc3ab.b0dde8","type":"mqtt out","z":"effe3391.1f5438","name":"","topic":"wled/all/api","qos":"1","retain":"false","broker":"b5a5da99.d05b48","x":890,"y":780,"wires":[]},{"id":"7c1c4356.2940a4","type":"debug","z":"effe3391.1f5438","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1110,"y":600,"wires":[]},{"id":"b333930a.e1a058","type":"ui_numeric","z":"effe3391.1f5438","name":"","label":"numeric","tooltip":"","group":"cf0b0799.ae4248","order":18,"width":"3","height":"1","passthru":true,"topic":"","format":"{{value}}","min":"1","max":"16","step":1,"x":1120,"y":540,"wires":[["7c1c4356.2940a4"]]},{"id":"a0164299.b19ee","type":"alexa-local","z":"ab8451a6.1fc278","devicename":"Preset-1","inputtrigger":true,"x":80,"y":40,"wires":[[]]},{"id":"fb858c99.50c648","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"effect","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_select.effect_list","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":70,"y":100,"wires":[["f1ba804d.8fa708"]]},{"id":"cff83400.b0c9f8","type":"mqtt out","z":"ed91e3e9.60bbe8","name":"","topic":"wled/all/api","qos":"0","retain":"","broker":"79d48640.3119d8","x":750,"y":140,"wires":[]},{"id":"9a96480b.ca1258","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"speed","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_number.ledspeed","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":70,"y":160,"wires":[["cab6a40f.c42ec8"]]},{"id":"cab6a40f.c42ec8","type":"template","z":"ed91e3e9.60bbe8","name":"Speed","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SX={{payload}}","output":"str","x":230,"y":160,"wires":[["cff83400.b0c9f8","a7c13350.5bf69"]]},{"id":"2a8da5c7.5b9e7a","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"intensity","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_number.ledintensity","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":60,"y":220,"wires":[["675cd701.f9eed"]]},{"id":"675cd701.f9eed","type":"template","z":"ed91e3e9.60bbe8","name":"Intensity","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"IX={{payload}}","output":"str","x":240,"y":220,"wires":[["cff83400.b0c9f8","a7c13350.5bf69"]]},{"id":"ccd881b9.98e8d","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"brightness","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_select.ledpaletttelist","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":1040,"y":420,"wires":[["64565a7e.824534"]]},{"id":"17f2a622.bc16ca","type":"template","z":"ed91e3e9.60bbe8","name":"palette","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"FP={{payload}}","output":"str","x":550,"y":40,"wires":[["7628a9f7.6ecad","cff83400.b0c9f8"]]},{"id":"35bcb4ac.db141c","type":"mqtt in","z":"ed91e3e9.60bbe8","name":"","topic":"wled/all/v","qos":"2","datatype":"auto","broker":"79d48640.3119d8","x":840,"y":360,"wires":[["b62acf6b.99963","2ad61e6c.f9b282"]]},{"id":"2ad61e6c.f9b282","type":"debug","z":"ed91e3e9.60bbe8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1210,"y":360,"wires":[]},{"id":"b62acf6b.99963","type":"xml","z":"ed91e3e9.60bbe8","name":"","property":"payload","attr":"","chr":"","x":890,"y":420,"wires":[["6475870a.6e12f8","ec361400.518c3"]]},{"id":"6475870a.6e12f8","type":"change","z":"ed91e3e9.60bbe8","name":"Speed","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.vs.sx[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":480,"wires":[["57e2ce33.4677a"]]},{"id":"ec361400.518c3","type":"change","z":"ed91e3e9.60bbe8","name":"Intensity","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.vs.ix[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":540,"wires":[["e532dc72.e8daa8"]]},{"id":"57e2ce33.4677a","type":"api-call-service","z":"ed91e3e9.60bbe8","name":"speed","server":"b7a2558e.8e59d","version":1,"service_domain":"input_number","service":"set_value","entityId":"input_number.ledspeed","data":"{\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1030,"y":480,"wires":[["64565a7e.824534"]]},{"id":"e532dc72.e8daa8","type":"api-call-service","z":"ed91e3e9.60bbe8","name":"intensity","server":"b7a2558e.8e59d","version":1,"service_domain":"input_number","service":"set_value","entityId":"input_number.ledintensity","data":"{\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1040,"y":540,"wires":[["64565a7e.824534"]]},{"id":"3063658.9f9dd1a","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL={{payload}}","output":"str","x":230,"y":260,"wires":[["a7c13350.5bf69","cff83400.b0c9f8"]]},{"id":"a7c13350.5bf69","type":"debug","z":"ed91e3e9.60bbe8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":200,"wires":[]},{"id":"41d67c03.554ad4","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":320,"wires":[["3063658.9f9dd1a"]]},{"id":"804e196f.0d49f8","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"2","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":360,"wires":[["3063658.9f9dd1a"]]},{"id":"3f34a2ff.e26f0e","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"preset_1","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_1","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":240,"y":340,"wires":[["86b45028.410488"]]},{"id":"3687a91c.9f7296","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":400,"wires":[["cf09af53.75687"]]},{"id":"86b45028.410488","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=1","output":"str","x":570,"y":340,"wires":[["cff83400.b0c9f8"]]},{"id":"cf09af53.75687","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=2","output":"str","x":570,"y":400,"wires":[["cff83400.b0c9f8"]]},{"id":"3d4d58b0.4fbd38","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_3","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":460,"wires":[["47cf248f.ed773c"]]},{"id":"a441d52f.c40e78","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_4","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":520,"wires":[["c428f885.1a9438"]]},{"id":"47cf248f.ed773c","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=3","output":"str","x":570,"y":460,"wires":[["cff83400.b0c9f8"]]},{"id":"c428f885.1a9438","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=4","output":"str","x":570,"y":520,"wires":[["cff83400.b0c9f8"]]},{"id":"cace89f6.00428","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_5","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":580,"wires":[["ec944e86.975da"]]},{"id":"c48f275a.277e3","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_6","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":640,"wires":[["8b41d9de.5e8da8"]]},{"id":"ec944e86.975da","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=5","output":"str","x":570,"y":580,"wires":[["cff83400.b0c9f8"]]},{"id":"8b41d9de.5e8da8","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=6","output":"str","x":570,"y":640,"wires":[["cff83400.b0c9f8"]]},{"id":"e986e64d.794ac","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_7","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":700,"wires":[["ded9f3be.1505"]]},{"id":"90494947.d36188","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_8","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":760,"wires":[["50d15815.677e68"]]},{"id":"ded9f3be.1505","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=7","output":"str","x":570,"y":700,"wires":[["cff83400.b0c9f8"]]},{"id":"50d15815.677e68","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=8","output":"str","x":570,"y":760,"wires":[["cff83400.b0c9f8"]]},{"id":"96036f81.5486c8","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_9","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":820,"wires":[["8577b2dc.26761"]]},{"id":"f484871c.f6013","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_10","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":340,"y":880,"wires":[["de188246.9d6108"]]},{"id":"8577b2dc.26761","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=9","output":"str","x":570,"y":820,"wires":[["cff83400.b0c9f8"]]},{"id":"de188246.9d6108","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=10","output":"str","x":570,"y":880,"wires":[["cff83400.b0c9f8"]]},{"id":"e6088b7a.f38a7","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_11","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":340,"y":940,"wires":[["273860f5.0efa4"]]},{"id":"4be1e36b.a779ec","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_12","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":340,"y":1000,"wires":[["985a2e31.550538"]]},{"id":"273860f5.0efa4","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=11","output":"str","x":570,"y":940,"wires":[["cff83400.b0c9f8"]]},{"id":"985a2e31.550538","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=12","output":"str","x":570,"y":1000,"wires":[["cff83400.b0c9f8"]]},{"id":"ea0e8bb4.35da88","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_13","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":340,"y":1060,"wires":[["ac8fa476.13b168"]]},{"id":"69adaeb6.d78b8","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_14","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":340,"y":1120,"wires":[["6e59439d.8e3b2c"]]},{"id":"ac8fa476.13b168","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=13","output":"str","x":570,"y":1060,"wires":[["cff83400.b0c9f8"]]},{"id":"6e59439d.8e3b2c","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=14","output":"str","x":570,"y":1120,"wires":[["cff83400.b0c9f8"]]},{"id":"8e72dc25.f8dad8","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_15","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":340,"y":1180,"wires":[["14180f23.3eae39"]]},{"id":"ee546816.751b8","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_boolean.preset_16","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":340,"y":1240,"wires":[["e21bf006.ef0c18"]]},{"id":"14180f23.3eae39","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=15","output":"str","x":570,"y":1180,"wires":[["cff83400.b0c9f8"]]},{"id":"e21bf006.ef0c18","type":"template","z":"ed91e3e9.60bbe8","name":"Preset","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"PL=16","output":"str","x":570,"y":1240,"wires":[["cff83400.b0c9f8"]]},{"id":"5d5f3938.045ae","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"3","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":400,"wires":[["3063658.9f9dd1a"]]},{"id":"604206c3.aaa05","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"4","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":440,"wires":[["3063658.9f9dd1a"]]},{"id":"91d55ef6.33699","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"5","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":480,"wires":[["3063658.9f9dd1a"]]},{"id":"6a3a5f57.717208","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"6","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":520,"wires":[["3063658.9f9dd1a"]]},{"id":"1ae1ae88.0c47e1","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"7","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":560,"wires":[["3063658.9f9dd1a"]]},{"id":"5d015905.22155","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"8","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":600,"wires":[["3063658.9f9dd1a"]]},{"id":"17721fe3.00fbe8","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"9","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":640,"wires":[["3063658.9f9dd1a"]]},{"id":"d61ba9a6.d9658","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"10","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":680,"wires":[["3063658.9f9dd1a"]]},{"id":"ed180dcb.312cb8","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"11","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":720,"wires":[["3063658.9f9dd1a"]]},{"id":"a10b1c3b.b69768","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"12","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":760,"wires":[["3063658.9f9dd1a"]]},{"id":"dae20a28.b565c8","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"13","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":800,"wires":[["3063658.9f9dd1a"]]},{"id":"1ccd6b7c.99da05","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"14","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":840,"wires":[["3063658.9f9dd1a"]]},{"id":"78907ed7.ed349","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"15","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":880,"wires":[["3063658.9f9dd1a"]]},{"id":"bcc07a7e.a9851","type":"inject","z":"ed91e3e9.60bbe8","name":"","topic":"","payload":"16","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":70,"y":920,"wires":[["3063658.9f9dd1a"]]},{"id":"7628a9f7.6ecad","type":"debug","z":"ed91e3e9.60bbe8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":770,"y":40,"wires":[]},{"id":"64565a7e.824534","type":"debug","z":"ed91e3e9.60bbe8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1210,"y":440,"wires":[]},{"id":"f1ba804d.8fa708","type":"function","z":"ed91e3e9.60bbe8","name":"Parse EffectList","func":"var str = msg.payload;\nmsg.payload = str[0].split(\" \");\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":100,"wires":[["7ea00936.47162"]]},{"id":"4d1b0c26.db2464","type":"change","z":"ed91e3e9.60bbe8","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"Solid","fromt":"str","to":"0","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Blink","fromt":"str","to":"1","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Breathe","fromt":"str","to":"2","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Wipe","fromt":"str","to":"3","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Wipe Random","fromt":"str","to":"4","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Random Colors","fromt":"str","to":"5","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Sweep","fromt":"str","to":"6","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Dynamic","fromt":"str","to":"7","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Colorloop","fromt":"str","to":"8","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Rainbow","fromt":"str","to":"9","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Scan","fromt":"str","to":"10","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Dual Scan","fromt":"str","to":"11","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Fade","fromt":"str","to":"12","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Chase","fromt":"str","to":"13","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Chase Rainbow","fromt":"str","to":"14","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":640,"wires":[[]]},{"id":"7ea00936.47162","type":"template","z":"ed91e3e9.60bbe8","name":"effect","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"FX={{payload}}","output":"str","x":530,"y":100,"wires":[["7628a9f7.6ecad","cff83400.b0c9f8"]]},{"id":"3ea2c4b4.51100c","type":"server-state-changed","z":"ed91e3e9.60bbe8","name":"pallette","server":"b7a2558e.8e59d","version":1,"entityidfilter":"input_select.palette_list","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":70,"y":40,"wires":[["45247dc4.4bb934"]]},{"id":"45247dc4.4bb934","type":"function","z":"ed91e3e9.60bbe8","name":"Parse pallettelist","func":"var str = msg.payload;\nmsg.payload = str[0].split(\" \");\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":40,"wires":[["17f2a622.bc16ca"]]},{"id":"3f60147c.0394ac","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1500,"wires":[["cb7dd404.c62908"]]},{"id":"f1cba370.fe8d68","type":"delay","z":"754c564.7b83828","name":"15s","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1640,"wires":[["4ffaa679.9c6c78"]]},{"id":"26e74323.4a222c","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":355,"y":1460,"wires":[]},{"id":"5b33a563.305094","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":355,"y":1600,"wires":[]},{"id":"855b7fbe.5dd3d8","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":460,"y":1460,"wires":[]},{"id":"908e6ee7.1bdcc8","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":460,"y":1600,"wires":[]},{"id":"4a5f8b1f.c792cc","type":"comment","z":"754c564.7b83828","name":"notification_lights_restore","info":"","x":590,"y":1640,"wires":[]},{"id":"4ffaa679.9c6c78","type":"link out","z":"754c564.7b83828","name":"","links":["f7563356.ef229"],"x":455,"y":1640,"wires":[]},{"id":"cb7dd404.c62908","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"It's almost bed time Lucas. Wrap up your activities and be ready to head upstairs.\",\"media_player\":\"media_player.play_room\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":500,"y":1500,"wires":[[]]},{"id":"3fab9832.749898","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"Goodnight Lucas. It is time to go to bed.\",\"media_player\":\"media_player.play_room\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":500,"y":1680,"wires":[["ddea66d3.734568"]]},{"id":"93e67fdc.54196","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Bedtime\",\"message\":\"Start: Announce it almost bedtime\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":400,"y":1540,"wires":[[]]},{"id":"a222c565.831b3","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Bedtime\",\"message\":\"End: Announce time to go to bed\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":400,"y":1720,"wires":[[]]},{"id":"f816e649.8c7c8","type":"api-call-service","z":"754c564.7b83828","name":"iOS Notification","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"notify_mobile","entityId":"","data":"{\"title\":\"Bedtime\",\"message\":\"The boys were reminded to go to bed.\",\"who\":\"brian\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":420,"y":1760,"wires":[[]]},{"id":"bfdc6c1d.177ab8","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":4,\"mod\":1275},\"end\":{\"dow\":4,\"mod\":1290}},{\"start\":{\"dow\":0,\"mod\":1275},\"end\":{\"dow\":0,\"mod\":1290}},{\"start\":{\"dow\":1,\"mod\":1275},\"end\":{\"dow\":1,\"mod\":1290}},{\"start\":{\"dow\":2,\"mod\":1275},\"end\":{\"dow\":2,\"mod\":1290}},{\"start\":{\"dow\":3,\"mod\":1275},\"end\":{\"dow\":3,\"mod\":1290}}]","topic":"","name":"9:15","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":70,"y":1500,"wires":[["a9f1cd07.35706"]]},{"id":"13fb7e63.ca25b2","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":4,\"mod\":1290},\"end\":{\"dow\":4,\"mod\":1305}},{\"start\":{\"dow\":3,\"mod\":1290},\"end\":{\"dow\":3,\"mod\":1305}},{\"start\":{\"dow\":2,\"mod\":1290},\"end\":{\"dow\":2,\"mod\":1305}},{\"start\":{\"dow\":1,\"mod\":1290},\"end\":{\"dow\":1,\"mod\":1305}},{\"start\":{\"dow\":0,\"mod\":1290},\"end\":{\"dow\":0,\"mod\":1305}}]","topic":"","name":"9:30","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":70,"y":1680,"wires":[["21bf62e8.1e344e"]]},{"id":"41894e91.d45f4","type":"comment","z":"754c564.7b83828","name":"Bedtime: Weekday, Lucas","info":"","x":130,"y":1460,"wires":[]},{"id":"ddea66d3.734568","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":630,"y":1680,"wires":[["e457ff6c.8a53c8"]]},{"id":"e457ff6c.8a53c8","type":"api-call-service","z":"754c564.7b83828","name":"Goodbye Routine","server":"71cca0bd.6fe0a","version":"1","service_domain":"script","service":"goodbye_routine","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":770,"y":1680,"wires":[[]]},{"id":"2885fdd2.2aeb5a","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1680,"wires":[["3fab9832.749898"]]},{"id":"ab7e6bdf.75606","type":"api-render-template","z":"754c564.7b83828","name":"is_weekday_and_holiday?","server":"71cca0bd.6fe0a","template":"{{  states.binary_sensor.weekday.state \nand states.binary_sensor.holiday.state }}","x":130,"y":1600,"wires":[[]]},{"id":"a9f1cd07.35706","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":1500,"wires":[["26e74323.4a222c","3f60147c.0394ac","93e67fdc.54196"]]},{"id":"21bf62e8.1e344e","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":1680,"wires":[["5b33a563.305094","f1cba370.fe8d68","2885fdd2.2aeb5a","a222c565.831b3","f816e649.8c7c8"]]},{"id":"1bd0ed3d.d15713","type":"inject","z":"754c564.7b83828","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1740,"wires":[["21bf62e8.1e344e"]]},{"id":"a6a0cc6c.b83ac","type":"inject","z":"754c564.7b83828","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1560,"wires":[["a9f1cd07.35706"]]},{"id":"69954dc4.4614cc","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1860,"wires":[["178af6d2.dbcaa1"]]},{"id":"8d12f64b.674bd8","type":"delay","z":"754c564.7b83828","name":"15s","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":2000,"wires":[["5b57de32.eca4f8"]]},{"id":"b41cdf91.036fe","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":355,"y":1820,"wires":[]},{"id":"5384b2c3.2ff5b4","type":"link out","z":"754c564.7b83828","name":"","links":["8f1fda29.143998","c6f7fd73.d9dee"],"x":355,"y":1960,"wires":[]},{"id":"6e6c4e93.1029c","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":460,"y":1820,"wires":[]},{"id":"b674abf3.257f98","type":"comment","z":"754c564.7b83828","name":"notification_lights","info":"","x":460,"y":1960,"wires":[]},{"id":"872b65d.6f15598","type":"comment","z":"754c564.7b83828","name":"notification_lights_restore","info":"","x":590,"y":2000,"wires":[]},{"id":"5b57de32.eca4f8","type":"link out","z":"754c564.7b83828","name":"","links":["f7563356.ef229"],"x":455,"y":2000,"wires":[]},{"id":"178af6d2.dbcaa1","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"Lucas and Kyle, it's almost bed time. Wrap up your activities and be ready to head upstairs.\",\"media_player\":\"media_player.play_room\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":500,"y":1860,"wires":[[]]},{"id":"a1ebec17.fd989","type":"api-call-service","z":"754c564.7b83828","name":"Announce","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"notify_speech","entityId":"","data":"{\"message\":\"Goodnight boys. It is time to go to bed.\",\"media_player\":\"media_player.play_room\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":500,"y":2040,"wires":[["f8e1f201.1d7408"]]},{"id":"72c17344.1462a4","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Bedtime\",\"message\":\"Start: Announce it almost bedtime\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":400,"y":1900,"wires":[[]]},{"id":"5b3c9006.20d6a8","type":"api-call-service","z":"754c564.7b83828","name":"logbook","server":"71cca0bd.6fe0a","version":"1","service_domain":"logbook","service":"log","entityId":"","data":"{\"name\":\"Node-RED > Bedtime\",\"message\":\"End: Announce time to go to bed\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":400,"y":2080,"wires":[[]]},{"id":"d4bca33e.48b8f8","type":"api-call-service","z":"754c564.7b83828","name":"iOS Notification","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"notify_mobile","entityId":"","data":"{\"title\":\"Bedtime\",\"message\":\"The boys were reminded to go to bed.\",\"who\":\"brian\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":420,"y":2120,"wires":[[]]},{"id":"76101f52.8d5da","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":5,\"mod\":1275},\"end\":{\"dow\":5,\"mod\":1290}},{\"start\":{\"dow\":6,\"mod\":1275},\"end\":{\"dow\":6,\"mod\":1290}}]","topic":"","name":"9:15","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":70,"y":1860,"wires":[["3da7fe9d.6d68aa"]]},{"id":"4256e28c.1891a4","type":"light-scheduler","z":"754c564.7b83828","settings":"70840d2c.2700ac","events":"[{\"start\":{\"dow\":5,\"mod\":1290},\"end\":{\"dow\":5,\"mod\":1305}},{\"start\":{\"dow\":6,\"mod\":1290},\"end\":{\"dow\":6,\"mod\":1305}}]","topic":"","name":"9:30","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":70,"y":2040,"wires":[["803aa504.500b8"]]},{"id":"80aaaefc.5bfe88","type":"comment","z":"754c564.7b83828","name":"Bedtime: Weekend","info":"","x":110,"y":1820,"wires":[]},{"id":"f8e1f201.1d7408","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":630,"y":2040,"wires":[["eabeb7a7.e8355"]]},{"id":"eabeb7a7.e8355","type":"api-call-service","z":"754c564.7b83828","name":"Goodbye Routine","server":"71cca0bd.6fe0a","version":1,"service_domain":"script","service":"goodbye_routine","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":770,"y":2040,"wires":[[]]},{"id":"ecbc110.9a227f","type":"delay","z":"754c564.7b83828","name":"10s","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":2040,"wires":[["a1ebec17.fd989"]]},{"id":"c2fcb734.774548","type":"api-render-template","z":"754c564.7b83828","name":"is_weekday_and_holiday?","server":"71cca0bd.6fe0a","template":"{{  states.binary_sensor.weekday.state \nand states.binary_sensor.holiday.state }}","x":130,"y":1960,"wires":[[]]},{"id":"3da7fe9d.6d68aa","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":1860,"wires":[["b41cdf91.036fe","69954dc4.4614cc","72c17344.1462a4"]]},{"id":"803aa504.500b8","type":"switch","z":"754c564.7b83828","name":"warn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":2040,"wires":[["5384b2c3.2ff5b4","8d12f64b.674bd8","ecbc110.9a227f","5b3c9006.20d6a8","d4bca33e.48b8f8"]]},{"id":"f4960e7b.1bbc5","type":"inject","z":"754c564.7b83828","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":2100,"wires":[["803aa504.500b8"]]},{"id":"f1c7840d.0fbfe","type":"inject","z":"754c564.7b83828","name":"","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":1920,"wires":[["3da7fe9d.6d68aa"]]}]