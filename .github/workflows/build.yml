---
## Source: https://github.com/frenck/home-assistant-config/tree/master/.github/workflows
name: build

# yamllint disable-line rule:truthy
on:
  push:
  # pull_request:

  # schedule:
  #   - cron: 0 12 * * *

jobs:
  home_assistant:
    name: "Home Assistant Core ${{ matrix.version }} Configuration Check"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        version: ["stable", "beta"]
        #version: ["stable", "beta", "dev"]
    steps:
      - name: ‚§µÔ∏è Check out configuration from GitHub
        uses: actions/checkout@v2
      # - name: "Disable troublesome default integrations (as they do not run on GitHub)"
      #   run:  rm -f ./integrations/home_assistant/stream.yaml;
      - name: "Disable custom components (as they do not exist on GitHub)"
        run:  rm -f ./integrations/*.yaml;
              rm -rf ./integrations/devices;
              rm -rf ./integration_entities/cameras;
              rm -f ./integration_entities/calendars/z_holiday.yaml;
              rm -rf ./integration_entities/image_processing;
              rm -rf ./integration_entities/notify/platforms;
              rm -rf ./integration_entities/sensors/climate;
              rm -rf ./integration_entities/sensors/integrations/;
              rm -f ./integration_entities/sensors/power/power_use.yaml;
              rm -f ./integration_entities/sensors/weather/ha-illuminance.yaml;
              rm -f ./integration_entities/sensors/weather/sun2.yaml; 
              rm -f ./integration_entities/sensors/weather/weatheralerts.yaml;
              rm -rf ./integration_entities/sensors/youtube;
#              rm -rf ./integration_entities/switches/circadian_lighting;
      - name: "Disable rest sensors (as their urls are scrambled in secrets)"
        run:  rm -rf ./integration_entities/sensors/updates;
              rm -rf ./integration_entities/sensors/datetime;
              rm ./integration_entities/sensors/system/tablet_kitchen.yaml;
      # - name: Activate dummy secrets.yaml
      #   run:  mv ./tests/fake_secrets.yaml ./secrets.yaml
      - name: Home Assistant Version
        uses: "docker://homeassistant/home-assistant:stable"
        with:
          args: |
            python -m homeassistant --version
      - name: üöÄ Run Home Assistant Configuration Check
        uses: frenck/action-home-assistant@v1.0.0
        with:
          path: "./"
          secrets: ./tests/fake_secrets.yaml
          version: "${{ matrix.version }}"
