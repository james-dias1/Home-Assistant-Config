---
## Source: https://github.com/frenck/home-assistant-config/tree/master/.github/workflows
name: build

# yamllint disable-line rule:truthy
on:
  push:
  # pull_request:
  # schedule:
  #   - cron: 0 12 * * *

jobs:
  home_assistant_stable:
    runs-on: ubuntu-latest
    steps:
      - name: Getting your configuration from GitHub
        uses: actions/checkout@v1
      - name: Correct /config path
        run: find /github/workspace/ -type f -name "*.yaml" -print0 | xargs -0 sed -i '' -e 's/\/config\//\/github\/workspace\//g'
      - name: Activate dummy secrets.yaml
        run: mv ./test_secrets.yaml ./secrets.yaml
      - name: "Disable troublesome component: notify.alexa_media"
        run: rm -rf ./integration_components/notify/platforms/
      - name: "Disable troublesome component: Stream"
        run: rm -f ./integrations/stream.yaml
      - name: "Disable troublesome component: Breaking Changes"
        run: rm -f ./integrations/breaking_changes.yaml
      - name: Home Assistant Version
        uses: "docker://homeassistant/home-assistant:stable"
        with:
          args: |
            python -m homeassistant --version
      - name: Home Assistant Check
        uses: "docker://homeassistant/home-assistant:stable"
        with:
          args: python -m homeassistant --config ./ --script check_config --info all
#   home_assistant_beta:
#     runs-on: ubuntu-latest
#     needs: [yamllint, remarklint]
#     steps:
#       - name: Getting your configuration from GitHub
#         uses: actions/checkout@v1
#       - name: Place dummy secrets.yaml
#         run: mv ./travis_secrets.yaml ./secrets.yaml
#       - name: Disable breaking_changes custom component
#         run: rm -f ./integrations/breaking_changes.yaml
#       - name: Disable stream integration
#         run: rm -f ./integrations/stream.yaml
#       - name: Home Assistant Version
#         uses: "docker://homeassistant/home-assistant:beta"
#         with:
#           args: |
#             python -m homeassistant --version
#       - name: Home Assistant Check
#         uses: "docker://homeassistant/home-assistant:beta"
#         with:
#           args: python -m homeassistant --config ./ --script check_config --info all
#   home_assistant_dev:
#     runs-on: ubuntu-latest
#     needs: [yamllint, remarklint]
#     steps:
#       - name: Getting your configuration from GitHub
#         uses: actions/checkout@v1
#       - name: Place dummy secrets.yaml
#         run: mv ./travis_secrets.yaml ./secrets.yaml
#       - name: Disable breaking_changes custom component
#         run: rm -f ./integrations/breaking_changes.yaml
#       - name: Disable stream integration
#         run: rm -f ./integrations/stream.yaml
#       - name: Home Assistant Version
#         uses: "docker://homeassistant/home-assistant:dev"
#         with:
#           args: |
#             python -m homeassistant --version
#       - name: Home Assistant Check
#         uses: "docker://homeassistant/home-assistant:dev"
#         with:
#           args: python -m homeassistant --config ./ --script check_config --info all
