---
# Define Anchors
blank-button: &blank-button
- type: "custom:button-card"
  color_type: blank-card

# - type: entity-button
#   entity: input_boolean.blank
#   icon: mdi:circle-small
#   name: "."
#   #theme: Dark-Nightz
#   tap_action:
#     action: none
#   hold_action:
#     action: none

compact-header: &compact-header
- type: custom:compact-custom-header
  clock_format: 24
  menu: false

title: Control Panel
path: home
#icon: mdi:apps
icon: fas:th
popup_cards:
  light.nerenes_light:
    title: Bedroom
    large: false
    card:
      type: entities
      entities:
        - type: custom:slider-entity-row
          entity: light.nerenes_light
          icon: mdi:light-switch
          name: Nerene
          toggle: true
        - type: custom:slider-entity-row
          entity: light.brians_light
          icon: mdi:floor-lamp
          name: Brian
          toggle: true
        - type: divider
        - entity: switch.sound_machine
          icon: mdi:weather-windy-variant
        - entity: switch.bedroom_fan
          icon: mdi:fan
  
  light.entry_light:
    title: Entry / Porch
    large: false
    card:
      type: entities
      entities:
        - type: custom:slider-entity-row
          entity: light.entry_light
          icon: mdi:light-switch
          name: Entry
          toggle: true
        - entity: switch.landscape_lights
          icon: mdi:tree
        - type: divider
        - type: custom:light-entity-row
          entity: light.porch_light
          icon: mdi:ceiling-light
          name: Porch Light
          showColorPicker: true
          #showColorSliders: true
        # - type: custom:slider-entity-row
        #   entity: light.porch_light
        #   icon: mdi:ceiling-light
        #   name: Porch
        #   toggle: true

  light.family_room_light:
    title: Family Room
    large: false
    card:
      type: entities
      entities:
        - type: custom:slider-entity-row
          entity: light.family_room_light
          icon: mdi:light-switch
          name: Switch
          toggle: true
        - type: custom:slider-entity-row
          entity: light.family_room_floor_lamp
          icon: fas:sun
          name: Floor
          toggle: true
        - type: divider
        - entity: switch.family_room_fan
          icon: mdi:fan
        - type: divider
        - type: custom:light-entity-row
          entity: light.family_room_table_lamp
          icon: mdi:lamp
          name: Table
          toggle: true
          showColorPicker: true
          showColorSliders: true
          buttons:
            - name: Red
              service_data:
                color_name: red
            - name: Blue
              service_data:
                color_name: blue
            - name: Teal
              service_data:
                color_name: teal
            - name: Voilet
              service_data:
                color_name: violet

  switch.kitchen_light:
    title: Kitchen
    large: false
    card:
      type: entities
      entities:
        - entity: switch.kitchen_light
          icon: mdi:wall-sconce-flat
        - entity: switch.kitchen_prep_light
          icon: mdi:wall-sconce-flat
        - entity: light.kitchen_undercabinet
          icon: mdi:led-strip
          name: Cabinet

  light.play_room_light:
    title: Play Room
    large: false
    card:
      type: entities
      entities:
        - type: custom:slider-entity-row
          entity: light.play_room_light
          icon: mdi:floor-lamp
          name: Lamp
          toggle: true
        - type: divider
        - entity: switch.play_room_fan
          icon: mdi:fan

  climate.home:
    title: Thermostats
    large: false
    card:
      type: vertical-stack
      cards:
        # - type: custom:ecobee-card
        #   entity: climate.home
        # - type: custom:ecobee-card
        #   entity: climate.goez
        - type: thermostat
          entity: climate.home
        - type: thermostat
          entity: climate.goez

  script.tv_family_room_off:
    title: TV Controls
    large: false
    card:
      type: vertical-stack
      cards:
        - type: markdown
          content: >
            ## Family Room TV
        - type: horizontal-stack
          cards:
            - type: entity-button
              entity: script.tv_family_room_off
              icon: mdi:blank
              name: "Off"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_family_room_off
            - type: entity-button
              entity: script.tv_family_room_apple_tv
              icon: mdi:blank
              name: "Apple TV"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_family_room_apple_tv
            - type: entity-button
              entity: script.tv_family_room_computer
              icon: mdi:blank
              name: "Computer"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_family_room_computer
            - type: entity-button
              entity: script.tv_family_room_bluray
              icon: mdi:blank
              name: "Movie Disc"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_family_room_bluray
        - type: horizontal-stack
          cards:
            - <<: *blank-button
            - type: entity-button
              entity: remote.family_room_hub
              icon: mdi:blank
              name: Mute
              tap_action:
                action: call-service
                service: remote.send_command
                service_data: 
                  command: Mute
                  device: 33992719
            - type: entity-button
              entity: remote.family_room_hub
              icon: mdi:blank
              name: "-"
              tap_action:
                action: call-service
                service: remote.send_command
                service_data: 
                  command: VolumeDown
                  device: 33992719
            - type: entity-button
              entity: remote.family_room_hub
              icon: mdi:blank
              name: +
              tap_action:
                action: call-service
                service: remote.send_command
                service_data: 
                  command: VolumeUp
                  device: 33992719
            - <<: *blank-button

        - type: markdown
          content: >
            ## Play Room TV
        - type: horizontal-stack
          cards:
            - type: entity-button
              entity: script.tv_play_room_off
              icon: mdi:blank
              name: "Off"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_play_room_off
            - type: entity-button
              entity: script.tv_play_room_apple_tv
              icon: mdi:blank
              name: "Apple TV"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_play_room_apple_tv
            - type: entity-button
              entity: script.tv_play_room_computer
              icon: mdi:blank
              name: "Computer"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_play_room_computer
            - type: entity-button
              entity: script.tv_play_room_dvr
              icon: mdi:blank
              name: "DVR"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_play_room_dvr
        - type: horizontal-stack
          cards:
            - type: entity-button
              entity: script.tv_play_room_switch
              icon: mdi:blank
              name: "Switch"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_play_room_switch
            - type: entity-button
              entity: script.tv_play_room_wii
              icon: mdi:blank
              name: "Wii"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_play_room_wii
            - type: entity-button
              entity: script.tv_play_room_wii_u
              icon: mdi:blank
              name: "Wii U"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_play_room_wii_u
            - type: entity-button
              entity: script.tv_play_room_xbox
              icon: mdi:blank
              name: "Xbox"
              tap_action:
                action: call-service
                service: script.turn_on
                service_data:
                  entity_id: script.tv_play_room_xbox
        - type: horizontal-stack
          cards:
            - <<: *blank-button
            - type: entity-button
              entity: remote.play_room_hub
              icon: mdi:blank
              name: Mute
              tap_action:
                action: call-service
                service: remote.send_command
                service_data: 
                  command: Mute
                  device: 33992719
            - type: entity-button
              entity: remote.play_room_hub
              icon: mdi:blank
              name: "-"
              tap_action:
                action: call-service
                service: remote.send_command
                service_data: 
                  command: VolumeDown
                  device: 33992719
            - type: entity-button
              entity: remote.play_room_hub
              icon: mdi:blank
              name: +
              tap_action:
                action: call-service
                service: remote.send_command
                service_data: 
                  command: VolumeUp
                  device: 33992719
            - <<: *blank-button

cards:
  - type: entity-filter
    entities:
      - binary_sensor.front_door
      - cover.garage_door
      - binary_sensor.shoe_closet_door
    state_filter:
      - 'on'
      - open
      # - 'off'
      # - closed
    show_empty: false
    card:
      type: custom:card-modder
      style:
        "background-color": "#F9C536"
        "color": black
        "--paper-item-icon-color": black
        "--paper-item-icon-active-color": black
      card:
        type: glance
        columns: 4
        show_state: false
        title: Open Doors + Windows

  - type: entity-filter
    entities:
      # Melnor RainCloud / AquaTimer
      - binary_sensor.aquatimer_control_unit_status
      - binary_sensor.side_yard_status

      # ESPHome Devices
      - binary_sensor.ble_hub_status
      - binary_sensor.plug01_status
      - binary_sensor.plug02_status
      - binary_sensor.plug03_status
      - binary_sensor.plug05_status
      - binary_sensor.plug06_status
      # - binary_sensor.plug07_status
      # - binary_sensor.plug08_status
      # - binary_sensor.sonoff_s31_01_status
      - binary_sensor.sonoff_s31_02_status
      # - binary_sensor.sonoff_s31_03_status
      # - binary_sensor.sonoff_s31_04_status
      # - binary_sensor.sonoff_s31_05_status
      # - binary_sensor.sonoff_s31_06_status

      # Harmony Hubs
      - sensor.harmony_hub_family_room_status
      - sensor.harmony_hub_play_room_status
    state_filter:
      - Offline
      - Unknown
      - 'off'
    show_empty: false
    card:
      type: custom:card-modder
      style:
        "background-color": "#F9C536"
        "color": black
        "--paper-item-icon-color": black
        "--paper-item-icon-active-color": black
      card:
        type: glance
        columns: 4
        show_state: false
        title: Devices Offline

  - type: custom:auto-entities
    filter:
      include:
        - entity_id: "sensor.*_battery"
          attributes:
            battery_level: "<= 20"
      exclude:
        - entity_id: "*phone*"
        - entity_id: "*brightness*" # *motion* = state for same device
        - entity_id: "*left_button*"
        - entity_id: "*right_button*"
    show_empty: false
    card:
      type: custom:card-modder
      style:
        background-color: "#F9C536"
        color: black
        --paper-item-icon-color: black
        --paper-item-icon-active-color: black
      card:
        type: entities
        title: Low Batteries
        show_header_toggle: false

  - type: entity-filter
    entities:
      - binary_sensor.alarm_smoke_detected
      - binary_sensor.alarm_co_detected
    state_filter:
      - 'on'
      # - 'off'
    show_empty: false
    card:
      type: custom:card-modder
      style:
        "background-color": "#E45E65"
        "color": white
        "--paper-item-icon-color": white
        "--paper-item-icon-active-color": white
      card:
        type: glance
        columns: 2
        show_state: false
        title: SAFTEY ALERT

  - type: vertical-stack
    cards:
      - type: markdown
        content: >
          ## Lights
      - type: horizontal-stack
        cards:
          - type: entity-button
            entity: light.nerenes_light
            icon: mdi:hotel
            name: Bed Room
            tap_action:
            #   action: call-service
            #   service: script.turn_on
            #   service_data:
            #     entity_id: script.toggle_bedroom_lights
            # hold_action:
              action: more-info
          - type: entity-button
            entity: light.dining_room_light
            icon: mdi:food
            name: Dining
            tap_action:
            #   action: toggle
            # hold_action:
              action: more-info
          - type: entity-button
            entity: light.entry_light
            icon: mdi:door
            name: Entry
            tap_action:
            #   action: toggle
            # hold_action:
              action: more-info
      - type: horizontal-stack
        cards:
          - type: entity-button
            entity: light.family_room_light
            icon: mdi:television
            name: Family
            tap_action:
            #   action: toggle
            # hold_action:
              action: more-info
          - type: entity-button
            entity: switch.kitchen_light
            icon: mdi:stove
            name: Kitchen
            tap_action:
            #   action: call-service
            #   service: script.turn_on
            #   service_data:
            #     entity_id: script.toggle_kitchen_lights
            # hold_action:
              action: more-info
          - type: entity-button
            entity: light.play_room_light
            icon: mdi:gamepad-variant
            name: Play Room
            tap_action:
            #   action: toggle
            # hold_action:
              action: more-info
      # - type: horizontal-stack
      #   cards:
      #     - type: entity-button
      #       entity: switch.landscape_lights
      #       icon: mdi:tree
      #       name: Outdoor
      #       tap_action:
      #         action: call-service
      #         service: script.turn_on
      #         service_data:
      #           entity_id: script.toggle_outdoor_lights

  - type: vertical-stack
    cards:
      - type: markdown
        content: >
          ## Devices
      - type: horizontal-stack
        cards:
          - type: entity-button
            entity: switch.bedroom_fan
            icon: mdi:fan 
            name: Bed Room
            tap_action:
              action: toggle
          - type: entity-button
            entity: switch.family_room_fan
            icon: mdi:fan
            name: Family
            tap_action:
              action: toggle
          - type: entity-button
            entity: switch.play_room_fan
            icon: mdi:fan
            name: Play Room
            tap_action:
              action: toggle
      - type: horizontal-stack
        cards:
          - type: entity-button
            entity: switch.hot_water_pump
            icon: mdi:hot-tub
            name: Hot Water
            tap_action:
              action: toggle
          - type: entity-button
            entity: switch.toggle_front
            name: Front Door
            tap_action:
              action: toggle
          - type: entity-button
            entity: switch.toggle_garage
            name: Garage Door
            tap_action:
              action: toggle
      - type: horizontal-stack
        cards:
          - type: entity-button
            entity: switch.printers
            icon: mdi:printer
            name: Printers
            tap_action:
              action: toggle
          - type: entity-button
            entity: climate.home
            icon: mdi:thermostat
            name: Thermostats
            tap_action:
              action: more-info
          - type: entity-button
            entity: script.tv_family_room_off
            icon: mdi:television
            name: TV Controls
            tap_action:
              action: more-info

      # - type: horizontal-stack
      #   cards:
      #     - type: entities
      #       entities:
      #         - type: thermostat
      #           entity: climate.home
      #         - type: thermostat
      #           entity: climate.goez
      #           name: Goez

  - type: vertical-stack
    cards:
      - type: markdown
        content: >
          ## Routines
      - type: horizontal-stack
        cards:
          - <<: *blank-button
          - type: entity-button
            entity: script.goodbye_routine
            icon: mdi:exit-run
            name: Bye
            tap_action:
              action: call-service
              service: script.turn_on
              service_data:
                entity_id: script.goodbye_routine
          - type: entity-button
            entity: script.goodnight_routine
            icon: mdi:weather-night
            name: Night
            tap_action:
              action: call-service
              service: script.turn_on
              service_data:
                entity_id: script.goodnight_routine
          - <<: *blank-button

  - type: vertical-stack
    cards:
      - type: markdown
        content: >
          ## Sensors
      - type: horizontal-stack
        cards:
          - type: custom:mini-graph-card
            animate: true
            entities:
              - entity: sensor.home_temperature
                name: Downstairs
              - entity: sensor.bedroom_temperature
                name: Bedroom
              - entity: sensor.boys_bedroom_temperature
                name: Boys
              - entity: sensor.upstairs_bathroom_temperature
                name: Bath
              - entity: sensor.goez_temperature
                name: Goez
            font_size: 75
            height: 150
            line_width: 3
            name: Temperature
            show:
              labels: false
              
      - type: horizontal-stack
        cards:
          - type: entities
            entities:
              - entity: sensor.medicine_buddy_given_today
                icon: mdi:pill
                name: Buddy's Medicine Last Given
              #- binary_sensor.dog_water_bowl
              - entity: variable.last_motion
                icon: mdi:motion-sensor
                name: Last Motion
              - entity: binary_sensor.sleeping
                icon: mdi:hotel
                name: Sleeping, Brian & Nerene
              #- binary_sensor.washer_running
              - sensor.washing_machine_status

  - <<: *compact-header