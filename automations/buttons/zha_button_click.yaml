---
alias: zha_button_click
initial_state: true
mode: parallel
trigger:
  platform: event
  event_type: zha_event
condition:
  # Ignore button release events.
  - condition: template
    value_template: '{{ trigger.event.data.args.value != false }}'
action:
  - choose:
      # Printer Power Button
      - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.device_ieee == "00:15:8d:00:01:2d:d7:c3" }}'
        sequence:
          - service: switch.toggle
            entity_id: switch.printers

      # Xiaomi Mini Switch
      - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.device_ieee == "00:15:8d:00:02:05:bf:0f" }}'
        sequence:
          - service: persistent_notification.create
            data_template:
              title: "test_switch_button"
              message: "Button pressed"

      # Bedroom Double Switch
      - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.device_ieee == "00:15:8d:00:02:83:e2:b6" }}'
        sequence:
          choose:
            # Single Click: Left
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "left_single" }}'
              sequence:
                - service: light.toggle
                  entity_id: light.bedroom
            # Single Click: Right
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "right_single" }}'
              sequence:
                - service: light.toggle
                  entity_id: light.brian
            # Single Click: Both
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "both_single" }}'
              sequence:
                - service: light.toggle
                  entity_id: light.glowforge
            # Double Click: Left
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "left_double" }}'
              sequence:
                - service: switch.toggle
                  entity_id: switch.sound_machine
            # Double Click: Right
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "right_double" }}'
              sequence:
                - service: switch.toggle
                  entity_id: switch.bedroom_fan
            # Double Click: Both
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "both_double" }}'
              sequence:
                - service: switch.toggle
                  entity_id:
                    - switch.sound_machine
                    - switch.bedroom_fan

      # IDEA: If we setup a wait_template with a 1 seconds timeout, would we be able to detect double-clicks?
      # Downside: This would delay all single click actions by 1 second.
      # Upside: 5 more commands are possible.

      # Brian's Ikea 5 button remote
      - conditions:
          - condition: template
            value_template: '{{ trigger.event.data.device_ieee == "ec:1b:bd:ff:fe:23:9c:ee" }}'
        sequence:
          choose:
            # Single Click: Power (middle)
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "toggle" }}'
              sequence:
                - service: switch.toggle
                  entity_id: switch.family_room_fan
            # Single Click: Brightness Up (top)
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "step_with_on_off" }}'
              sequence:
                - service: light.turn_on
                  data:
                    entity_id:
                      - light.family_room
                      - light.table_lamp
                      brightness_pct: 100
            # Single Click: Brightness down (bottom)
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "step" }}'
              sequence:
                - service: light.turn_off
                  entity_id:
                    - light.family_room
                    - light.table_lamp
            # Single Click: Arrow left (left)
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "press"
                                  and trigger.event.data.args[0]|int == 256 }}'
              sequence:
                - service: light.turn_on
                  data:
                    entity_id: light.family_room_floor_lamp
                    brightness_pct: 100
            # Single Click: Arrow right (right)
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "press"
                                    and trigger.event.data.args[0]|int == 257 }}'
              sequence:
                - service: light.turn_off
                  entity_id: light.family_room_floor_lamp

            # Hold: Brightness Up (top)
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "move" }}'
              sequence:
                - service: light.turn_on
                  data:
                    entity_id:
                      - light.family_room
                      - light.table_lamp
                    brightness_step_pct: "-20"
            # Hold: Brightness down (bottom)
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "move_with_on_off" }}'
              sequence:
                - service: light.turn_on
                  data:
                    entity_id:
                      - light.family_room
                      - light.table_lamp
                    brightness_step_pct: "20"
            # Hold: Arrow left (left)
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "hold"
                                  and trigger.event.data.args[0]|int == 3329 }}'
              sequence:
                - service: light.turn_on
                  data:
                    entity_id: light.family_room_floor_lamp
                    brightness_step_pct: "-20"
            # Hold: Arrow right (right)
            - conditions:
                - condition: template
                  value_template: '{{ trigger.event.data.command == "hold"
                                    and trigger.event.data.args[0]|int == 3328 }}'
              sequence:
                - service: light.turn_on
                  data:
                    entity_id: light.family_room_floor_lamp
                    brightness_step_pct: "20"
