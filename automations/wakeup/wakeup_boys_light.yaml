---
alias: wakeup_boys_light
#initial_state: true
trigger:
  platform: template
  value_template: >
    {%- set next_alarm = states("sensor.boys_room_next_alarm") -%}
    {%- if next_alarm != "unknown" -%}
      {%- set wakeup_date = next_alarm.split("T")[0] -%}
    {%- else -%}
      {%- set wakeup_date = states('sensor.date') -%}
    {%- endif -%}
    {%- set start_time = states("sensor.wakeup_boys_light") -%}

    {%- if next_alarm != "unknown" -%}
      {{ wakeup_date == states('sensor.date') and start_time == states('sensor.time') }}
    {%- else -%}
      false
    {%- endif -%}
action:
  # - service: persistent_notification.create
  #   data_template:
  #     title: "DEBUG"
  #     message: "automation.wakeup_boys_light"

  # Time to turn on the lights!
  # - service: script.turn_on
  #   entity_id: script.wakeup_boys_light_start

  - service: script.turn_on
    data_template:
      entity_id: >
        {% if is_state('input_boolean.wakeup_boys_skipnext', 'on') %}
          script.wakeup_boys_skipnext
        {% else %}
          script.wakeup_boys_light_start
        {% endif %}
