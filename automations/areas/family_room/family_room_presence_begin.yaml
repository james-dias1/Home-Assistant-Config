---
# Family Room Light Presence Trigger
alias: "Family Room Presence Begin"
id: family_room_presence_begin
initial_state: true
mode: single
trigger:
  # Trigger if either motion sensor is on.
  - platform: state
    entity_id:
      - binary_sensor.family_room_1_motion
      - binary_sensor.family_room_2_motion
    to: "on"
condition:
  # Skip when the light is already on.
  - condition: state
    entity_id: light.family_room
    state: "off"

  # Skip turning on the lights in the middle of the day.
  - condition: state
    entity_id: binary_sensor.dark_outside
    state: "on"

  # We don't need to turn on the light when the dogs are alone.
  # - condition: state
  #   entity_id: input_boolean.away_mode
  #   state: "off"
action:
  # - service: persistent_notification.create
  #   data_template:
  #     title: "family_room_presence_start"
  #     message: "Triggered by: {{ trigger.to_state.attributes.friendly_name }}\nto_state: {{ trigger.to_state.state }}\nfrom_state: {{ trigger.from_state.state }}"

  # Stop if the presence lights mode is disabled.
  - condition: state
    entity_id: input_boolean.presence_lights_family_room
    state: "on"

  # Family Room Presence Light(s) On
  - service: light.turn_on
    data:
      entity_id:
        - light.family_room
        - light.table_lamp
      brightness: 255
      kelvin: 5000
      transition: 0

  # Cool down timer. When "mode: single" this stops this automation from running more often than this.
  - delay:
      minutes: 10
