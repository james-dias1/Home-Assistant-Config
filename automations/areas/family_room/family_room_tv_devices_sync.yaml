---
alias: Family Room TV Device Sync
id: family_room_tv_device_sync
description: Show Apple TV home screen when the TV turns on.
initial_state: true
mode: single
trigger:
  # Samsung TV
  - platform: state
    entity_id:
      - media_player.tv_family_room
      - switch.tv_family_room

variables:
  old_state: '{{ trigger.from_state.state }}'
  new_state: '{{ trigger.to_state.state }}'

  #entity_id: '{{ trigger.to_state.entity_id }}'
  #source: '{{ trigger.to_state.attributes.source }}'
action:
  # - service: script.debug
  #   data:
  #     message: |
  #       old_state: {{ old_state }}
  #       new_state: {{ new_state }}
  #       entity_id: {{ entity_id }}
  ##       source: {{ source }}

  - choose:
      # Samsung TV
      #- conditions: '{{ new_state == "on" and source = "HDMI 1" }}'
      - conditions: '{{ new_state == "on" }}'
        sequence:
          - service: remote.turn_on
            entity_id: remote.apple_tv_family_room

          # Apple TV: let us know the TV is on by putting something on the screen.
          - delay:
              seconds: 2

          - service: remote.send_command
            data:
              entity_id: remote.apple_tv_family_room
              command:
                - home

  # Cool down timer. When "mode: single" this stops this automation from running more often than this.
  - delay:
    minutes: 1
