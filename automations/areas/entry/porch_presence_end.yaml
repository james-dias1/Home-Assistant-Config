---
##############################################
###  Porch
##############################################
# Porch Presence: Timeout
alias: Porch Presence End
id: porch_presence_end
initial_state: true
mode: single
trigger:
  - platform: state
    entity_id: binary_sensor.doorbell_presence
    #from: 'on'
    to: 'off'
    # for:
    #   minutes: 2
    #   seconds: 00
action:
  - choose:
      - conditions:
          # Only activate the lights after sunset.
          - condition: sun
            after: sunset
        sequence:
          # Restore the previous state of the porch light.
          - service: scene.turn_on
            data:
              entity_id: scene.doorbell_presence_lights_snapshot
              transition: 5

          # Cool down timer. When "mode: single" this stops this automation from running more often than this.
          - delay:
              minutes: 5
