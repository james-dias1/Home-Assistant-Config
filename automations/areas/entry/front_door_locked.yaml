---
alias: front_door_locked
initial_state: true
trigger:
  - platform: state
    entity_id: lock.front_door
    from: 'unlocked'
    to: 'locked'

  # - platform: state
  #   entity_id: lock.test_door
  #   from: 'unlocked'
  #   to: 'locked'
action:
  # Cancel and reset the unlocked timer.
  - service: timer.cancel
    entity_id: timer.front_door_unlocked

  # Disable Leave Unlocked mode.
  - service: input_boolean.turn_off
    entity_id: input_boolean.leave_unlocked

  ## ================================================================================================= ##

  # Skip turning on the entry lights in the middle of the day.
  - choose:
      - conditions: "{{ states('sensor.outdoor_illuminance')|int < 2000 }}"
        sequence:
          # Restore Adaptive Lighting automated control.
          - service: adaptive_lighting.set_manual_control
            data:
              entity_id:
                - switch.adaptive_lighting_home_entry
                - switch.adaptive_lighting_porch
              manual_control: false

          # Restore the previous state of the porch + entry lights.
          - service: scene.turn_on
            data:
              entity_id: scene.front_door_locked_lights_snapshot
              transition: 5

  ## ================================================================================================= ##

  # Update Light Switch LED Status Color.
  - service: script.inovelli_led_off
    data:
      entity_id: light.family_room
