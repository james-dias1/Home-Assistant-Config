---
##############################################
###  Porch
##############################################
# Porch Presence: Start
alias: Porch Presence Begin
id: porch_presence_begin
initial_state: true
mode: single
trigger:
  - platform: state
    entity_id:
      - binary_sensor.front_door_motion
      - binary_sensor.doorbell_motion
    to: 'on'
action:
  - choose:
      - conditions:
          # Only activate the lights after sunset.
          - condition: sun
            after: sunset
        sequence:
          # Store the current state of the porch light.
          - service: scene.create
            data:
              scene_id: doorbell_presence_lights_snapshot
              snapshot_entities:
                - light.home_entry
                - light.porch

          # Disable circadian lighting
          - service: switch.turn_off
            entity_id:
              - switch.circadian_lighting_porch
              - switch.circadian_lighting_entry

          # Full brightness!
          - service: light.turn_on
            data:
              entity_id: light.porch
              kelvin: 3500
              brightness: 255

          - service: light.turn_on
            data:
              entity_id: light.home_entry
              brightness: 255

          # Cool down timer. When "mode: single" this stops this automation from running more often than this.
          - delay:
              minutes: 10
