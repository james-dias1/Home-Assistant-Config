---
##############################################
###  Porch
##############################################
# Porch Presence: Start
alias: Porch Presence Begin
id: porch_presence_begin
initial_state: true
mode: single
trigger:
  - platform: state
    entity_id:
      - binary_sensor.front_door_motion
      #- binary_sensor.doorbell_motion
    from: 'off'
    to: 'on'
action:
  # Skip turning on the entry lights in the middle of the day.
  - choose:
    - conditions: "{{ states('sensor.outdoor_illuminance')|int < 2000 }}"
      sequence:
          # Store the current state of the porch light.
          - service: scene.create
            data:
              scene_id: doorbell_presence_lights_snapshot
              snapshot_entities:
                - light.home_entry
                - light.porch

          # Disable Adaptive Lighting automated control.
          - service: adaptive_lighting.set_manual_control
            data:
              entity_id: switch.adaptive_lighting_porch
              manual_control: true

          # Full brightness!
          - service: light.turn_on
            data:
              entity_id: light.porch
              kelvin: 3500
              brightness: 255

          # Cool down timer. When "mode: single" this stops this automation from running more often than this.
          - delay:
              minutes: 5 #10
