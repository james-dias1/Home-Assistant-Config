---
alias: front_door_unlocked
initial_state: true
trigger:
  - platform: state
    entity_id: lock.front_door
    from: 'locked'
    to: 'unlocked'
action:
  # Update Light Switch LED Status Color.
  - service: script.inovelli_led
    data:
      entity_id: zwave.dimmer_family_room
      color: cyan
      effect: chase
      duration: 15 seconds
      level: 4

  - delay:
      seconds: 14
  - condition: state
    entity_id: lock.front_door
    state: 'unlocked'
  - service: script.inovelli_led
    data:
      entity_id: zwave.dimmer_family_room
      color: cyan
      duration: indefinitely
      effect: pulse
      level: 4

  # Skip turning on the entry lights in the middle of the day.
  - condition: numeric_state
    entity_id: sensor.outside_illuminance
    below: 5000
  # Store the current state of the porch + entry lights.
  - service: scene.create
    data:
      scene_id: front_door_locked_lights_snapshot
      snapshot_entities:
        - light.entry
        - light.porch

  # Full brightness!
  - service: light.turn_on
    entity_id:
      - light.entry
      - light.porch
    data:
      brightness: 255

  # Start a timer to relock the front door after the timer finishes.
  - service: timer.start
    data_template:
      entity_id: "timer.front_door_unlocked"
