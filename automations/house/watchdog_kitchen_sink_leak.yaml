---
# Warns us of a possible leak under the kitchen sink!
#
alias: watchdog_kitchen_sink_leak
initial_state: on
trigger:
  platform: state
  entity_id: binary_sensor.kitchen_leak
  to: "on"
action:
  - service: script.notify_speech
    data_template:
      media_player: >-
        "media_player.master_bedroom,
         media_player.granny_flat,
         media_player.living_room,
         media_player.kitchen,
         media_player.family_room"
      message: "A leak has been detected in the kitchen!"

  - service: script.notify_ios
    data_template:
      title: "LEAK DETECTED!"
      message: "Kitchen Sink {{ as_timestamp(now()) | timestamp_custom('%I:%M:%S %p %d %b %Y', true) }}"
      who: "parents"

  - service: persistent_notification.create
    data:
      title: "LEAK DETECTED!"
      message: "Kitchen Sink - {{ as_timestamp(now()) | timestamp_custom('%I:%M:%S %p %d%b%Y', true) }}"