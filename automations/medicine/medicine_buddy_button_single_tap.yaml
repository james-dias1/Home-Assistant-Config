---
## Store the medicine_buddy date on single tap.
alias: medicine_buddy_button_single_tap
initial_state: on
trigger:
  - platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.medicine_buddy_button
      click_type: single
  - platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.medicine_buddy_button
      click_type: hold
action:
  - service: logbook.log
    data:
      name: "Buddy's Medicine"
      message: "was given"
  - service: mqtt.publish
    data_template:
      topic: "medicine/buddy/last_given"
      payload: "{{ as_timestamp(now())|timestamp_custom('%Y-%m-%d') }}"
      retain: true