---
variables:
  media_player: !include ../../templates/speech/media_player_rooms.yaml
  selected_phrase: |
    {%- if selected_phrase|trim not in ("None","") %}
      {{ selected_phrase|trim }}
    {%- endif %}
  text_phrase: |
    {%- set text_phrase = states("input_text.tts_phrase")|trim %}
    {%- if text_phrase|trim != "" %}
      {{ text_phrase|trim }}
    {%- endif %}
  voice: '{{ states("input_select.tts_voices")|trim }}'
  message: |
    {%- if selected_phrase|trim != "" %}
      {%- set phrase = selected_phrase %}
    {%- elif text_phrase|trim != "" %}
      {% set phrase = text_phrase %}
    {%- endif %}
    {%- if voice not in ("Alexa","") %}
      <voice name="{{ voice }}">{{ phrase }}</voice>
    {%- else -%}
      {{ phrase }}
    {%- endif -%}
sequence:
  # - service: script.debug
  #   data:
  #     message: |
  #       selected_phrase: {{ selected_phrase }}
  #       text_phrase: {{ text_phrase }}
  #       message: {{ message }}

  - service: script.notify_speech
    data_template:
      media_player: '{{ media_player }}'
      message: '{{ message }}'
      voice: '{{ voice }}'
