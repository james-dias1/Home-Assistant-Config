---
variables:
  speakers: '{{ expand(media_player) | map(attribute="entity_id") | list }}'
  speaker_count: '{{ speakers | count }}'
sequence:
  # - service: script.debug
  #   data:
  #     title: 'Smart Speaker "Say" Service'
  #     message: 'Speakers: "{{ speaker_count }}".'

  - repeat:
      count: "{{ speaker_count|int }}"
      sequence:
        - variables:
            speaker: '{{ speakers[repeat.index-1] }}'
            tts_service: '{{ "alexa" if "alexa" in speaker else "google" }}'

        - service: 'script.say_{{ tts_service }}'
          data:
            media_player: '{{ speaker }}'
            title: '{{ title }}'
            message: '{{ message }}'
