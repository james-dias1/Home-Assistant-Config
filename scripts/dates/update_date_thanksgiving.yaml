---
# Only update the day after the event (or the event date is unknown).
update_date_thanksgiving:
  sequence:
    - service: persistent_notification.create
      data:
        title: "update_date_thanksgiving"
        message: "Start - {{ as_timestamp(now()) | timestamp_custom('%I:%M:%S %p %d%b%Y', true) }}"

    - condition: template
      value_template: >
        {%- set today = states('sensor.date') -%}
        {%- set event = states('sensor.date_thanksgiving') -%}
        {%- set date_parts = event.split('-') -%}
        {%- set day_after_event = date_parts[0] ~'-'~ date_parts[1] ~'-'~ (date_parts[2]|int+1) %}
        {{ today == day_after_event
        or event == 'unknown' }}

    - service: persistent_notification.create
      data:
        title: "update_date_thanksgiving"
        message: "Updating sensor.date_thanksgiving."

    - service: homeassistant.update_entity
      entity_id: sensor.date_thanksgiving

    - delay:
        seconds: 15
    - service: persistent_notification.create
      data:
        title: "update_date_thanksgiving"
        message: >
          End - {{ as_timestamp(now()) | timestamp_custom('%I:%M:%S %p %d%b%Y', true) }}
          sensor.date_thanksgiving: {{ states('sensor.date_thanksgiving') }}
