---
lights_on_update:
  sequence:
    # - service: group.set
    #   data_template:
    #     object_id: "lights_on"
    #     entities: >-
    service: variable.set_variable
    data:
      variable: lights_on
      value_template: >
        {% set group_id = 'group.all_lights' %}
        {% set on_states = ['on'] %}
        {% set ignore_list = ['light.dummy','light.garage_entry_light','light.hue','light.play_room','light.kitchen_cabinet','light.porch','light.network_closet_light','light.plug01_red_led','light.plug02_red_led','light.plug03_red_led','light.plug04_red_led','light.plug05_blue_led','light.plug06_blue_led','light.plug07_blue_led','light.plug08_blue_led','light.sonoff_pow_01_green_led','light.sonoff_pow_02_green_led', 'light.sonoff_s31_01_green_led','light.sonoff_s31_02_green_led','light.upstairs_bathroom_nightlight'] %}
        {{ states | rejectattr('entity_id','in',ignore_list) | selectattr('entity_id','in', state_attr(group_id, 'entity_id')) | selectattr('state','in',on_states) | map(attribute='entity_id') | join(', ') }}
