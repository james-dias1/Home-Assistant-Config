---
##########################
# START  | END    | BRI  #
# ------ | ------ | ---- #
# 5am    | 8am    |  60% #
# 8am    | 7pm    | 100% #
# 7pm    | 7:30pm |  80% #
# 7:30pm | 8pm    |  60% #
# 8pm    | 8:30pm |  50% #
# 8:30pm | 9pm    |  40% #
# 9pm    | 5am    |  30% #
##########################
lights_on_update:
  #alias: "Update lights_on variable"
  sequence:
    service: variable.set_variable
    data:
      variable: lights_on
      value_template: >
        {% macro get_lights_on() -%}
          {%- for group in states.light|groupby('state') -%}
            {%- for entity in group.list -%}
              {%- if entity.state == 'on'
                  and entity.entity_id|lower != 'light.dummy'
                  and entity.entity_id|lower != 'light.entry'
                  and entity.entity_id|lower != 'light.hue'
                  and entity.entity_id|lower != 'light.living_room'
                  and not ('garage_entry'  in entity.entity_id|lower)
                  and not ('gateway_light' in entity.entity_id|lower)
                  and not ('shoe_closet'   in entity.entity_id|lower)
                  and not (entity.entity_id|lower).endswith('_led')
                  and not (entity.entity_id|lower).endswith('_group')
                  and not (entity.entity_id|lower).endswith('nightlight')
                  and not (entity.entity_id|lower).startswith('light.3a') -%}
                {{ entity.entity_id }}{{ ' ' }}
              {%- endif -%}
            {%- endfor -%}
          {%- endfor -%}
        {%- endmacro %}
        {{ get_lights_on()|trim|replace(' ', ',') }}