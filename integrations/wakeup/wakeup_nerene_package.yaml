---
script:
  wakeup_nerene:
    variables:
      light: light.bedroom
    sequence:
      # - service: script.debug
      #   data:
      #     message: |
      #       light: {{ light }}

      - service: scene.apply
        data:
          entities:
            fan.bedroom: off
            switch.sound_machine: off
            light.home_entry:
              state: on
              brightness_pct: '40'
            light.garage_entry:
              state: on
              brightness_pct: '25'

      - service: script.wakeup_light_start
        data:
          light: '{{ light }}'

  wakeup_nerene_timeout:
    sequence:
      - service: homeassistant.turn_off
        data:
          entity_id: light.bedroom

input_boolean:
  wakeup_nerene_status:
    name: Activate Alarm
    icon: mdi:alarm-check
  wakeup_nerene_skipnext:
    name: Skip Next Alarm
    icon: mdi:alarm-check
  wakeup_nerene_sun:
    name: Sunday
    icon: mdi:checkbox-marked-circle
  wakeup_nerene_mon:
    name: Monday
    icon: mdi:checkbox-marked-circle
  wakeup_nerene_tue:
    name: Tuesday
    icon: mdi:checkbox-marked-circle
  wakeup_nerene_wed:
    name: Wednesday
    icon: mdi:checkbox-marked-circle
  wakeup_nerene_thu:
    name: Thursday
    icon: mdi:checkbox-marked-circle
  wakeup_nerene_fri:
    name: Friday
    icon: mdi:checkbox-marked-circle
  wakeup_nerene_sat:
    name: Saturday
    icon: mdi:checkbox-marked-circle

input_datetime:
  wakeup_nerene_time:
    name: Wakeup Time
    has_date: false
    has_time: true

sensor:
  - platform: template
    sensors:
      wakeup_nerene_start:
        friendly_name: Light Fade-in Start
        icon_template: mdi:lightbulb-on-outline
        value_template: >-
          {% set wakeup_time = states('input_datetime.wakeup_nerene_time').split(':') %}
          {%- if (wakeup_time[1]|int >= 10) -%}
            {{ "%0.02d:%0.02d"|format(wakeup_time[0]|int, wakeup_time[1]|int -10) }}
          {%- else -%}
            {{ "%0.02d:%0.02d"|format(wakeup_time[0]|int -1, wakeup_time[1]|int +50) }}
          {%- endif -%}

timer:
  wakeup_timeout_nerene:
    duration: "01:00:00"
